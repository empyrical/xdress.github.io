


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>xdress.typesystem &mdash; xdress 0.4-dev documentation</title>
    
    <link rel="stylesheet" href="../../_static/numpy_friendly.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Noticia+Text|Open+Sans|Droid+Sans+Mono" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.4-dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/jquery.cookie.js"></script>
    <script type="text/javascript" src="../../_static/cloud.js"></script>
    <link rel="top" title="xdress 0.4-dev documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
        <meta name="viewport" content="width=device-width, initial-scale=1"><script type="text/javascript">
var ga_enabled = !$.cookie('disable-ga');
if(ga_enabled){
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-41934829-1']);
  _gaq.push(['_setCookiePath', '/']);
  _gaq.push(['_setDetectFlash', false]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
}
</script>
  </head>
  <body>
    <div class="relbar-top">
        
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="../../np-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
    <li><a href="../../index.html">xdress 0.4-dev documentation</a> &raquo;</li>

          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for xdress.typesystem</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;Implements a simple, dynamic type system for API generation.</span>

<span class="sd">:author: Anthony Scopatz &lt;scopatz@gmail.com&gt;</span>

<span class="sd">Introduction</span>
<span class="sd">============</span>

<span class="sd">This module provides a suite of tools for denoting, describing, and converting</span>
<span class="sd">between various data types and the types coming from various systems.  This is</span>
<span class="sd">achieved by providing canonical abstractions of various kinds of types:</span>

<span class="sd">* Base types (int, str, float, non-templated classes)</span>
<span class="sd">* Refined types (even or odd ints, strings containing the letter &#39;a&#39;)</span>
<span class="sd">* Dependent types (templates such arrays, maps, sets, vectors)</span>

<span class="sd">All types are known by their name (a string identifier) and may be aliased with</span>
<span class="sd">other names.  However, the string id of a type is not sufficient to fully describe</span>
<span class="sd">most types.  The system here implements a canonical form for all kinds of types.</span>
<span class="sd">This canonical form is itself hashable, being comprised only of strings, ints,</span>
<span class="sd">and tuples.</span>

<span class="sd">Canonical Forms</span>
<span class="sd">---------------</span>
<span class="sd">First, let us examine the base types and the forms that they may take.  Base types</span>
<span class="sd">are fiducial.  The type system itself may not make any changes (refinements,</span>
<span class="sd">template filling) to types of this kind.  They are basically a collection of bits.</span>
<span class="sd">(The job of ascribing meaning to these bits falls on someone else.)  Thus base types</span>
<span class="sd">may be referred to simply by their string identifier.  For example::</span>

<span class="sd">    &#39;str&#39;</span>
<span class="sd">    &#39;int32&#39;</span>
<span class="sd">    &#39;float64&#39;</span>
<span class="sd">    &#39;MyClass&#39;</span>

<span class="sd">Aliases to these -- or any -- type names are given in the type_aliases dictionary::</span>

<span class="sd">    type_aliases = {</span>
<span class="sd">        &#39;i&#39;: &#39;int32&#39;,</span>
<span class="sd">        &#39;i4&#39;: &#39;int32&#39;,</span>
<span class="sd">        &#39;int&#39;: &#39;int32&#39;,</span>
<span class="sd">        &#39;complex&#39;: &#39;complex128&#39;,</span>
<span class="sd">        &#39;b&#39;: &#39;bool&#39;,</span>
<span class="sd">        }</span>

<span class="sd">Furthermore, length-2 tuples are used to denote a type and the name or flag of its</span>
<span class="sd">predicate.  A predicate is a function or transformation that may be applied to</span>
<span class="sd">verify, validate, cast, coerce, or extend a variable of the given type.  A common</span>
<span class="sd">usage is to declare a pointer or reference of the underlying type.  This is done with</span>
<span class="sd">the string flags &#39;*&#39; and &#39;&amp;&#39;::</span>

<span class="sd">    (&#39;char&#39;, &#39;*&#39;)</span>
<span class="sd">    (&#39;float64&#39;, &#39;&amp;&#39;)</span>

<span class="sd">If the predicate is a positive integer, then this is interpreted as a</span>
<span class="sd">homogeneous array of the underlying type with the given length.  If this length</span>
<span class="sd">is zero, then the tuple is often interpreted as a scalar of this type, equivalent</span>
<span class="sd">to the type itself.  The length-0 scalar interpretation depends on context.  Here</span>
<span class="sd">are some examples of array types::</span>

<span class="sd">    (&#39;char&#39;, 42)  # length-42 character array</span>
<span class="sd">    (&#39;bool&#39;, 1)   # length-1 boolean array</span>
<span class="sd">    (&#39;f8&#39;, 0)     # scalar 64-bit float</span>

<span class="sd">.. note::</span>

<span class="sd">    length-1 tuples are converted to length-2 tuples with a 0 predicate,</span>
<span class="sd">    i.e. ``(&#39;char&#39;,)`` will become ``(&#39;char&#39;, 0)``.</span>

<span class="sd">The next kind of type are **refinement types** or **refined types**.  A refined type</span>
<span class="sd">is a sub-type of another type but restricts in some way what constitutes a valid</span>
<span class="sd">element.  For example, if we first take all integers, the set of all positive</span>
<span class="sd">integers is a refinement of the original.  Similarly, starting with all possible</span>
<span class="sd">strings the set of all strings starting with &#39;A&#39; is a refinement.</span>

<span class="sd">In the system here, refined types are given their own unique names (e.g. &#39;posint&#39;</span>
<span class="sd">and &#39;astr&#39;).  The type system has a mapping (``refined_types``) from all refinement</span>
<span class="sd">type names to the names of their super-type.  The user may refer to refinement types</span>
<span class="sd">simply by their string name.  However the canonical form refinement types is to use</span>
<span class="sd">the refinement as the predicate of the super-type in a length-2 tuple, as above::</span>

<span class="sd">    (&#39;int32&#39;, &#39;posint&#39;)  # refinement of integers to positive ints</span>
<span class="sd">    (&#39;str&#39;, &#39;astr&#39;)      # refinement of strings to str starting with &#39;A&#39;</span>

<span class="sd">It is these refinement types that give the second index in the tuple its &#39;predicate&#39;</span>
<span class="sd">name.  Additionally, the predicate is used to look up the converter and validation</span>
<span class="sd">functions when doing code generation or type verification.</span>

<span class="sd">The last kind of types are known as **dependent types** or **template types**,</span>
<span class="sd">similar in concept to C++ template classes.  These are meta-types whose</span>
<span class="sd">instantiation requires one or more parameters to be filled in by further values or</span>
<span class="sd">types. Dependent types may nest with themselves or other dependent types.  Fully</span>
<span class="sd">qualifying a template type requires the resolution of all dependencies.</span>

<span class="sd">Classic examples of dependent types include the C++ template classes.  These take</span>
<span class="sd">other types as their dependencies.  Other cases may require only values as</span>
<span class="sd">their dependencies.  For example, suppose we want to restrict integers to various</span>
<span class="sd">ranges.  Rather than creating a refinement type for every combination of integer</span>
<span class="sd">bounds, we can use a single &#39;intrange&#39; type that defines high and low dependencies.</span>

<span class="sd">The ``template_types`` mapping takes the dependent type names (e.g. &#39;map&#39;)</span>
<span class="sd">to a tuple of their dependency names (&#39;key&#39;, &#39;value&#39;).   The ``refined_types``</span>
<span class="sd">mapping also accepts keys that are tuples of the following form::</span>

<span class="sd">    (&#39;&lt;type name&gt;&#39;, &#39;&lt;dep0-name&gt;&#39;, (&#39;dep1-name&#39;, &#39;dep1-type&#39;), ...)</span>

<span class="sd">Note that template names may be reused as types of other template parameters::</span>

<span class="sd">    (&#39;name&#39;, &#39;dep0-name&#39;, (&#39;dep1-name&#39;, &#39;dep0-name&#39;))</span>

<span class="sd">As we have seen, dependent</span>
<span class="sd">types may either be base types (when based off of template classes), refined types,</span>
<span class="sd">or both.  Their canonical form thus follows the rules above with some additional</span>
<span class="sd">syntax.  The first element of the tuple is still the type name and the last</span>
<span class="sd">element is still the predicate (default 0).  However the type tuples now have a</span>
<span class="sd">length equal to 2 plus the number of dependencies.  These dependencies are</span>
<span class="sd">placed between the name and the predicate: ``(&#39;&lt;name&gt;&#39;, &lt;dep0&gt;, ..., &lt;predicate&gt;)``.</span>
<span class="sd">These dependencies, of course, may be other type names or tuples!  Let&#39;s see</span>
<span class="sd">some examples.</span>

<span class="sd">In the simplest case, take analogies to C++ template classes::</span>

<span class="sd">    (&#39;set&#39;, &#39;complex128&#39;, 0)</span>
<span class="sd">    (&#39;map&#39;, &#39;int32&#39;, &#39;float64&#39;, 0)</span>
<span class="sd">    (&#39;map&#39;, (&#39;int32&#39;, &#39;posint&#39;), &#39;float64&#39;, 0)</span>
<span class="sd">    (&#39;map&#39;, (&#39;int32&#39;, &#39;posint&#39;), (&#39;set&#39;, &#39;complex128&#39;, 0), 0)</span>

<span class="sd">Now consider the intrange type from above.  This has the following definition and</span>
<span class="sd">canonical form::</span>

<span class="sd">    refined_types = {(&#39;intrange&#39;, (&#39;low&#39;, &#39;int32&#39;), (&#39;high&#39;, &#39;int32&#39;)): &#39;int32&#39;}</span>

<span class="sd">    # range from 1 -&gt; 2</span>
<span class="sd">    (&#39;int32&#39;, (&#39;intrange&#39;, (&#39;low&#39;, &#39;int32&#39;, 1), (&#39;high&#39;, &#39;int32&#39;, 2)))</span>

<span class="sd">    # range from -42 -&gt; 42</span>
<span class="sd">    (&#39;int32&#39;, (&#39;intrange&#39;, (&#39;low&#39;, &#39;int32&#39;, -42), (&#39;high&#39;, &#39;int32&#39;, 42)))</span>

<span class="sd">Note that the low and high dependencies here are length three tuples of the form</span>
<span class="sd">``(&#39;&lt;dep-name&gt;&#39;, &lt;dep-type&gt;, &lt;dep-value&gt;)``.  How the dependency values end up</span>
<span class="sd">being used is solely at the discretion of the implementation.  These values may</span>
<span class="sd">be anything, though they are most useful when they are easily convertible into</span>
<span class="sd">strings in the target language.</span>

<span class="sd">.. warning::</span>

<span class="sd">    Do not confuse length-3 dependency tuples with length-3 type tuples!</span>
<span class="sd">    The last element here is a value, not a predicate.</span>

<span class="sd">Next, consider a &#39;range&#39; type which behaves similarly to &#39;intrange&#39; except that</span>
<span class="sd">it also accepts the type as dependency.  This has the following definition and</span>
<span class="sd">canonical form::</span>

<span class="sd">    refined_types = {(&#39;range&#39;, &#39;vtype&#39;, (&#39;low&#39;, &#39;vtype&#39;), (&#39;high&#39;, &#39;vtype&#39;)): &#39;vtype&#39;}</span>

<span class="sd">    # integer range from 1 -&gt; 2</span>
<span class="sd">    (&#39;int32&#39;, (&#39;range&#39;, &#39;int32&#39;, (&#39;low&#39;, &#39;int32&#39;, 1), (&#39;high&#39;, &#39;int32&#39;, 2)))</span>

<span class="sd">    # positive integer range from 42 -&gt; 65</span>
<span class="sd">    ((&#39;int32&#39;, &#39;posint&#39;), (&#39;range&#39;, (&#39;int32&#39;, &#39;posint&#39;),</span>
<span class="sd">                                    (&#39;low&#39;, (&#39;int32&#39;, &#39;posint&#39;), 42),</span>
<span class="sd">                                    (&#39;high&#39;, (&#39;int32&#39;, &#39;posint&#39;), 65)))</span>

<span class="sd">Shorthand Forms</span>
<span class="sd">---------------</span>
<span class="sd">The canonical forms for types contain all the information needed to fully describe</span>
<span class="sd">different kinds of types.  However, as human-facing code, they can be exceedingly</span>
<span class="sd">verbose.  Therefore there are number of shorthand techniques that may be used to</span>
<span class="sd">also denote the various types.  Converting from these shorthands to the fully</span>
<span class="sd">expanded version may be done via the the ``canon(t)`` function.  This function</span>
<span class="sd">takes a single type and returns the canonical form of that type.  The following</span>
<span class="sd">are operations that ``canon()``  performs:</span>

<span class="sd">* Base type are returned as their name::</span>

<span class="sd">    canon(&#39;str&#39;) == &#39;str&#39;</span>

<span class="sd">* Aliases are resolved::</span>

<span class="sd">    canon(&#39;f4&#39;) == &#39;float32&#39;</span>

<span class="sd">* Expands length-1 tuples to scalar predicates::</span>

<span class="sd">    t = (&#39;int32&#39;,)</span>
<span class="sd">    canon(t) == (&#39;int32&#39;, 0)</span>

<span class="sd">* Determines the super-type of refinements::</span>

<span class="sd">    canon(&#39;posint&#39;) == (&#39;int32&#39;, &#39;posint&#39;)</span>

<span class="sd">* Applies templates::</span>

<span class="sd">    t = (&#39;set&#39;, &#39;float&#39;)</span>
<span class="sd">    canon(t) == (&#39;set&#39;, &#39;float64&#39;, 0)</span>

<span class="sd">* Applies dependencies::</span>

<span class="sd">    t = (&#39;intrange&#39;, 1, 2)</span>
<span class="sd">    canon(t) = (&#39;int32&#39;, (&#39;intrange&#39;, (&#39;low&#39;, &#39;int32&#39;, 1), (&#39;high&#39;, &#39;int32&#39;, 2)))</span>

<span class="sd">    t = (&#39;range&#39;, &#39;int32&#39;, 1, 2)</span>
<span class="sd">    canon(t) = (&#39;int32&#39;, (&#39;range&#39;, &#39;int32&#39;, (&#39;low&#39;, &#39;int32&#39;, 1), (&#39;high&#39;, &#39;int32&#39;, 2)))</span>

<span class="sd">* Performs all of the above recursively::</span>

<span class="sd">    t = ((&#39;map&#39;, &#39;posint&#39;, (&#39;set&#39;, (&#39;intrange&#39;, 1, 2))),)</span>
<span class="sd">    canon(t) == ((&#39;map&#39;,</span>
<span class="sd">                 (&#39;int32&#39;, &#39;posint&#39;),</span>
<span class="sd">                 (&#39;set&#39;, (&#39;int32&#39;,</span>
<span class="sd">                    (&#39;intrange&#39;, (&#39;low&#39;, &#39;int32&#39;, 1), (&#39;high&#39;, &#39;int32&#39;, 2))), 0)), 0)</span>

<span class="sd">These shorthands are thus far more useful and intuitive than canonical form described</span>
<span class="sd">above.  It is therefore recommended that users and developers write code that uses</span>
<span class="sd">the shorter versions, Note that ``canon()`` is guaranteed to return strings, tuples,</span>
<span class="sd">and integers only -- making the output of this function hashable.</span>

<span class="sd">Built-in Template Types</span>
<span class="sd">-----------------------</span>
<span class="sd">Template type definitions that come stock with xdress::</span>

<span class="sd">    template_types = {</span>
<span class="sd">        &#39;map&#39;: (&#39;key_type&#39;, &#39;value_type&#39;),</span>
<span class="sd">        &#39;dict&#39;: (&#39;key_type&#39;, &#39;value_type&#39;),</span>
<span class="sd">        &#39;pair&#39;: (&#39;key_type&#39;, &#39;value_type&#39;),</span>
<span class="sd">        &#39;set&#39;: (&#39;value_type&#39;,),</span>
<span class="sd">        &#39;list&#39;: (&#39;value_type&#39;,),</span>
<span class="sd">        &#39;tuple&#39;: (&#39;value_type&#39;,),</span>
<span class="sd">        &#39;vector&#39;: (&#39;value_type&#39;,),</span>
<span class="sd">        }</span>

<span class="sd">Built-in Refined Types</span>
<span class="sd">-----------------------</span>
<span class="sd">Refined type definitions that come stock with xdress::</span>

<span class="sd">    refined_types = {</span>
<span class="sd">        &#39;nucid&#39;: &#39;int32&#39;,</span>
<span class="sd">        &#39;nucname&#39;: &#39;str&#39;,</span>
<span class="sd">        (&#39;enum&#39;, (&#39;name&#39;, &#39;str&#39;), (&#39;aliases&#39;, (&#39;dict&#39;, &#39;str&#39;, &#39;int32&#39;, 0))): &#39;int32&#39;,</span>
<span class="sd">        (&#39;function&#39;, (&#39;arguments&#39;, (&#39;list&#39;, (&#39;pair&#39;, &#39;str&#39;, &#39;type&#39;))), (&#39;returns&#39;, &#39;type&#39;)): &#39;void&#39;,</span>
<span class="sd">        (&#39;function_pointer&#39;, (&#39;arguments&#39;, (&#39;list&#39;, (&#39;pair&#39;, &#39;str&#39;, &#39;type&#39;))), (&#39;returns&#39;, &#39;type&#39;)): (&#39;void&#39;, &#39;*&#39;),</span>
<span class="sd">        }</span>

<span class="sd">Major Classes Overview</span>
<span class="sd">----------------------</span>
<span class="sd">Holistically, the following classes are important to type system:</span>

<span class="sd">* ``TypeSystem``:  This *is* the type system.</span>
<span class="sd">* ``TypeMatcher``: An imutable type for matching types against a pattern.</span>
<span class="sd">* ``MatchAny``: A singleton used to denote patterns.</span>
<span class="sd">* ``typestr``: Various string representations of a type as properties.</span>

<span class="sd">Type System API</span>
<span class="sd">===============</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">contextmanager</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">Set</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">MutableMapping</span><span class="p">,</span> <span class="n">Mapping</span>
<span class="kn">from</span> <span class="nn">numbers</span> <span class="kn">import</span> <span class="n">Number</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span><span class="p">,</span> <span class="n">pformat</span>
<span class="kn">from</span> <span class="nn">warnings</span> <span class="kn">import</span> <span class="n">warn</span>
<span class="kn">import</span> <span class="nn">gzip</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">cPickle</span> <span class="kn">as</span> <span class="nn">pickle</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">pickle</span>

<span class="kn">from</span> <span class="nn">.utils</span> <span class="kn">import</span> <span class="n">Arg</span><span class="p">,</span> <span class="n">flatten</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">memoize_method</span><span class="p">,</span> <span class="n">infer_format</span>

<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
    <span class="nb">basestring</span> <span class="o">=</span> <span class="nb">str</span>

<div class="viewcode-block" id="TypeSystem"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.TypeSystem">[docs]</a><span class="k">class</span> <span class="nc">TypeSystem</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A class representing a type system.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">datafields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s">&#39;base_types&#39;</span><span class="p">,</span> <span class="s">&#39;template_types&#39;</span><span class="p">,</span> <span class="s">&#39;refined_types&#39;</span><span class="p">,</span> <span class="s">&#39;humannames&#39;</span><span class="p">,</span> 
        <span class="s">&#39;extra_types&#39;</span><span class="p">,</span> <span class="s">&#39;dtypes&#39;</span><span class="p">,</span> <span class="s">&#39;stlcontainers&#39;</span><span class="p">,</span> <span class="s">&#39;argument_kinds&#39;</span><span class="p">,</span> 
        <span class="s">&#39;variable_namespace&#39;</span><span class="p">,</span> <span class="s">&#39;type_aliases&#39;</span><span class="p">,</span> <span class="s">&#39;cpp_types&#39;</span><span class="p">,</span> 
        <span class="s">&#39;numpy_types&#39;</span><span class="p">,</span> <span class="s">&#39;from_pytypes&#39;</span><span class="p">,</span> <span class="s">&#39;cython_ctypes&#39;</span><span class="p">,</span> <span class="s">&#39;cython_cytypes&#39;</span><span class="p">,</span> 
        <span class="s">&#39;cython_pytypes&#39;</span><span class="p">,</span> <span class="s">&#39;cython_cimports&#39;</span><span class="p">,</span> <span class="s">&#39;cython_cyimports&#39;</span><span class="p">,</span> <span class="s">&#39;cython_pyimports&#39;</span><span class="p">,</span> 
        <span class="s">&#39;cython_functionnames&#39;</span><span class="p">,</span> <span class="s">&#39;cython_classnames&#39;</span><span class="p">,</span> <span class="s">&#39;cython_c2py_conv&#39;</span><span class="p">,</span> 
        <span class="s">&#39;cython_py2c_conv&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_types</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">template_types</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">refined_types</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
                 <span class="n">humannames</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">extra_types</span><span class="o">=</span><span class="s">&#39;xdress_extra_types&#39;</span><span class="p">,</span> <span class="n">dtypes</span><span class="o">=</span><span class="s">&#39;dtypes&#39;</span><span class="p">,</span>
                 <span class="n">stlcontainers</span><span class="o">=</span><span class="s">&#39;stlcontainers&#39;</span><span class="p">,</span> <span class="n">argument_kinds</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
                 <span class="n">variable_namespace</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">type_aliases</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">cpp_types</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
                 <span class="n">numpy_types</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">from_pytypes</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">cython_ctypes</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
                 <span class="n">cython_cytypes</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">cython_pytypes</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">cython_cimports</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
                 <span class="n">cython_cyimports</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">cython_pyimports</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
                 <span class="n">cython_functionnames</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">cython_classnames</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
                 <span class="n">cython_c2py_conv</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">cython_py2c_conv</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">typestring</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        base_types : set of str, optional</span>
<span class="sd">            The base or primitive types in the type system.</span>
<span class="sd">        template_types : dict, optional</span>
<span class="sd">            Template types are types whose instantiations are based on meta-types.</span>
<span class="sd">            this dict maps their names to meta-type names in order.</span>
<span class="sd">        refined_types : dict, optional </span>
<span class="sd">            This is a mapping from refinement type names to the parent types.</span>
<span class="sd">            The parent types may either be base types, compound types, template</span>
<span class="sd">            types, or other refined types!</span>
<span class="sd">        humannames : dict, optional</span>
<span class="sd">            The human readable names for types.</span>
<span class="sd">        extra_types : str, optional</span>
<span class="sd">            The name of the xdress extra types module.</span>
<span class="sd">        dtypes : str, optional</span>
<span class="sd">            The name of the xdress numpy dtypes wrapper module.</span>
<span class="sd">        stlcontainers : str, optional</span>
<span class="sd">            The name of the xdress C++ standard library containers wrapper module.</span>
<span class="sd">        argument_kinds : dict, optional</span>
<span class="sd">            Templates types have arguments. This is a mapping from type name to a </span>
<span class="sd">            tuple of utils.Arg kind flags.  The order in the tuple matches the value</span>
<span class="sd">            in template_types. This is only vaid for concrete types, ie </span>
<span class="sd">            (&#39;vector&#39;, &#39;int&#39;, 0) and not just &#39;vector&#39;.</span>
<span class="sd">        variable_namespace : dict, optional</span>
<span class="sd">            Templates arguments may be variables. These variables may live in a </span>
<span class="sd">            namespace which is required for specifiying the type.  This is a </span>
<span class="sd">            dictionary mapping variable names to thier namespace.</span>
<span class="sd">        type_aliases : dict, optional</span>
<span class="sd">            Aliases that may be used to substitute one type name for another.</span>
<span class="sd">        cpp_types : dict, optional</span>
<span class="sd">            The C/C++ representation of the types.</span>
<span class="sd">        numpy_types : dict, optional</span>
<span class="sd">            NumPy&#39;s Cython representation of the types.</span>
<span class="sd">        from_pytypes : dict, optional</span>
<span class="sd">            List of Python types which match may be converted to these types.</span>
<span class="sd">        cython_ctypes : dict, optional</span>
<span class="sd">            Cython&#39;s C/C++ representation of the types.</span>
<span class="sd">        cython_cytypes : dict, optional</span>
<span class="sd">            Cython&#39;s Cython representation of the types.</span>
<span class="sd">        cython_pytypes : dict, optional</span>
<span class="sd">            Cython&#39;s Python representation of the types.</span>
<span class="sd">        cython_cimports : dict, optional</span>
<span class="sd">            A sequence of tuples representing cimports that are needed for Cython</span>
<span class="sd">            to represent C/C++ types.</span>
<span class="sd">        cython_cyimports : dict, optional</span>
<span class="sd">            A sequence of tuples representing cimports that are needed for Cython</span>
<span class="sd">            to represent Cython types.</span>
<span class="sd">        cython_pyimports : dict, optional</span>
<span class="sd">            A sequence of tuples representing imports that are needed for Cython</span>
<span class="sd">            to represent Python types.</span>
<span class="sd">        cython_functionnames : dict, optional</span>
<span class="sd">            Cython alternate name fragments used for mangling function and </span>
<span class="sd">            variable names.  These should try to adhere to a lowercase_and_underscore</span>
<span class="sd">            convention.  These may contain template argument namess as part of a </span>
<span class="sd">            format string, ie ``{&#39;map&#39;: &#39;map_{key_type}_{value_type}&#39;}``.</span>
<span class="sd">        cython_classnames : dict, optional</span>
<span class="sd">            Cython alternate name fragments used for mangling class names.  </span>
<span class="sd">            These should try to adhere to a CapCase convention.  These may contain </span>
<span class="sd">            template argument namess as part of a format string, </span>
<span class="sd">            ie ``{&#39;map&#39;: &#39;Map{key_type}{value_type}&#39;}``.</span>
<span class="sd">        cython_c2py_conv : dict, optional</span>
<span class="sd">            Cython convertors from C/C++ types to the representative Python types.</span>
<span class="sd">        cython_py2c_conv : dict, optional</span>
<span class="sd">            Cython convertors from Python types to the representative C/C++ types.</span>
<span class="sd">            Valuse are tuples with the form of ``(body or return, return or False)``.</span>
<span class="sd">        typestring : typestr or None, optional</span>
<span class="sd">            An type that is used to format types to strings in conversion routines.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_types</span> <span class="o">=</span> <span class="n">base_types</span> <span class="k">if</span> <span class="n">base_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="nb">set</span><span class="p">([</span><span class="s">&#39;char&#39;</span><span class="p">,</span> 
            <span class="s">&#39;uchar&#39;</span><span class="p">,</span> <span class="s">&#39;str&#39;</span><span class="p">,</span> <span class="s">&#39;int16&#39;</span><span class="p">,</span> <span class="s">&#39;int32&#39;</span><span class="p">,</span> <span class="s">&#39;int64&#39;</span><span class="p">,</span> <span class="s">&#39;int128&#39;</span><span class="p">,</span> <span class="s">&#39;uint16&#39;</span><span class="p">,</span> <span class="s">&#39;uint32&#39;</span><span class="p">,</span> 
            <span class="s">&#39;uint64&#39;</span><span class="p">,</span> <span class="s">&#39;uint128&#39;</span><span class="p">,</span> <span class="s">&#39;float32&#39;</span><span class="p">,</span> <span class="s">&#39;float64&#39;</span><span class="p">,</span> <span class="s">&#39;float128&#39;</span><span class="p">,</span> <span class="s">&#39;complex128&#39;</span><span class="p">,</span> 
            <span class="s">&#39;void&#39;</span><span class="p">,</span> <span class="s">&#39;bool&#39;</span><span class="p">,</span> <span class="s">&#39;type&#39;</span><span class="p">,</span> <span class="s">&#39;file&#39;</span><span class="p">,</span> <span class="s">&#39;exception&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">template_types</span> <span class="o">=</span> <span class="n">template_types</span> <span class="k">if</span> <span class="n">template_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="p">{</span>
            <span class="s">&#39;map&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;key_type&#39;</span><span class="p">,</span> <span class="s">&#39;value_type&#39;</span><span class="p">),</span>
            <span class="s">&#39;dict&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;key_type&#39;</span><span class="p">,</span> <span class="s">&#39;value_type&#39;</span><span class="p">),</span>
            <span class="s">&#39;pair&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;key_type&#39;</span><span class="p">,</span> <span class="s">&#39;value_type&#39;</span><span class="p">),</span>
            <span class="s">&#39;set&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;value_type&#39;</span><span class="p">,),</span>
            <span class="s">&#39;list&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;value_type&#39;</span><span class="p">,),</span>
            <span class="s">&#39;tuple&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;value_type&#39;</span><span class="p">,),</span>
            <span class="s">&#39;vector&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;value_type&#39;</span><span class="p">,),</span>
            <span class="s">&#39;enum&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;aliases&#39;</span><span class="p">),</span>
            <span class="s">&#39;function&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;arguments&#39;</span><span class="p">,</span> <span class="s">&#39;returns&#39;</span><span class="p">),</span>
            <span class="s">&#39;function_pointer&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;arguments&#39;</span><span class="p">,</span> <span class="s">&#39;returns&#39;</span><span class="p">),</span>
            <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refined_types</span> <span class="o">=</span> <span class="n">refined_types</span> <span class="k">if</span> <span class="n">refined_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="p">{</span>
            <span class="s">&#39;nucid&#39;</span><span class="p">:</span> <span class="s">&#39;int32&#39;</span><span class="p">,</span>
            <span class="s">&#39;nucname&#39;</span><span class="p">:</span> <span class="s">&#39;str&#39;</span><span class="p">,</span>
            <span class="p">(</span><span class="s">&#39;enum&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;str&#39;</span><span class="p">),</span> 
                     <span class="p">(</span><span class="s">&#39;aliases&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;dict&#39;</span><span class="p">,</span> <span class="s">&#39;str&#39;</span><span class="p">,</span> <span class="s">&#39;int32&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))):</span> <span class="s">&#39;int32&#39;</span><span class="p">,</span>
            <span class="p">(</span><span class="s">&#39;function&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;arguments&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;list&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;pair&#39;</span><span class="p">,</span> <span class="s">&#39;str&#39;</span><span class="p">,</span> <span class="s">&#39;type&#39;</span><span class="p">))),</span>
                         <span class="p">(</span><span class="s">&#39;returns&#39;</span><span class="p">,</span> <span class="s">&#39;type&#39;</span><span class="p">)):</span> <span class="s">&#39;void&#39;</span><span class="p">,</span>
            <span class="p">(</span><span class="s">&#39;function_pointer&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;arguments&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;list&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;pair&#39;</span><span class="p">,</span> <span class="s">&#39;str&#39;</span><span class="p">,</span> <span class="s">&#39;type&#39;</span><span class="p">))),</span>
                                 <span class="p">(</span><span class="s">&#39;returns&#39;</span><span class="p">,</span> <span class="s">&#39;type&#39;</span><span class="p">)):</span> <span class="p">(</span><span class="s">&#39;void&#39;</span><span class="p">,</span> <span class="s">&#39;*&#39;</span><span class="p">),</span>
            <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">humannames</span> <span class="o">=</span> <span class="n">humannames</span> <span class="k">if</span> <span class="n">humannames</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="p">{</span>
            <span class="s">&#39;char&#39;</span><span class="p">:</span> <span class="s">&#39;character&#39;</span><span class="p">,</span>
            <span class="s">&#39;uchar&#39;</span><span class="p">:</span> <span class="s">&#39;unsigned character&#39;</span><span class="p">,</span>
            <span class="s">&#39;str&#39;</span><span class="p">:</span> <span class="s">&#39;string&#39;</span><span class="p">,</span>
            <span class="s">&#39;bool&#39;</span><span class="p">:</span> <span class="s">&#39;boolean&#39;</span><span class="p">,</span>
            <span class="s">&#39;int16&#39;</span><span class="p">:</span> <span class="s">&#39;short integer&#39;</span><span class="p">,</span>
            <span class="s">&#39;int32&#39;</span><span class="p">:</span> <span class="s">&#39;integer&#39;</span><span class="p">,</span>
            <span class="s">&#39;int64&#39;</span><span class="p">:</span> <span class="s">&#39;long integer&#39;</span><span class="p">,</span>
            <span class="s">&#39;int128&#39;</span><span class="p">:</span> <span class="s">&#39;very long integer&#39;</span><span class="p">,</span>
            <span class="s">&#39;uint16&#39;</span><span class="p">:</span> <span class="s">&#39;unsigned short integer&#39;</span><span class="p">,</span>
            <span class="s">&#39;uint32&#39;</span><span class="p">:</span> <span class="s">&#39;unsigned integer&#39;</span><span class="p">,</span>
            <span class="s">&#39;uint64&#39;</span><span class="p">:</span> <span class="s">&#39;unsigned long integer&#39;</span><span class="p">,</span>
            <span class="s">&#39;uint128&#39;</span><span class="p">:</span> <span class="s">&#39;unsigned very long integer&#39;</span><span class="p">,</span>
            <span class="s">&#39;float32&#39;</span><span class="p">:</span> <span class="s">&#39;float&#39;</span><span class="p">,</span>
            <span class="s">&#39;float64&#39;</span><span class="p">:</span> <span class="s">&#39;double&#39;</span><span class="p">,</span>
            <span class="s">&#39;float128&#39;</span><span class="p">:</span> <span class="s">&#39;long double&#39;</span><span class="p">,</span>
            <span class="s">&#39;complex128&#39;</span><span class="p">:</span> <span class="s">&#39;complex&#39;</span><span class="p">,</span>
            <span class="s">&#39;file&#39;</span><span class="p">:</span> <span class="s">&#39;file&#39;</span><span class="p">,</span>
            <span class="s">&#39;exception&#39;</span><span class="p">:</span> <span class="s">&#39;exception&#39;</span><span class="p">,</span>
            <span class="s">&#39;dict&#39;</span><span class="p">:</span> <span class="s">&#39;dict of ({key_type}, {value_type}) items&#39;</span><span class="p">,</span>
            <span class="s">&#39;map&#39;</span><span class="p">:</span> <span class="s">&#39;map of ({key_type}, {value_type}) items&#39;</span><span class="p">,</span>
            <span class="s">&#39;pair&#39;</span><span class="p">:</span> <span class="s">&#39;({key_type}, {value_type}) pair&#39;</span><span class="p">,</span>
            <span class="s">&#39;set&#39;</span><span class="p">:</span> <span class="s">&#39;set of {value_type}&#39;</span><span class="p">,</span>
            <span class="s">&#39;vector&#39;</span><span class="p">:</span> <span class="s">&#39;vector [ndarray] of {value_type}&#39;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extra_types</span> <span class="o">=</span> <span class="n">extra_types</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtypes</span> <span class="o">=</span> <span class="n">dtypes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stlcontainers</span> <span class="o">=</span> <span class="n">stlcontainers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">argument_kinds</span> <span class="o">=</span> <span class="n">argument_kinds</span> <span class="k">if</span> <span class="n">argument_kinds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="p">{</span>
            <span class="p">(</span><span class="s">&#39;vector&#39;</span><span class="p">,</span> <span class="s">&#39;bool&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="p">(</span><span class="n">Arg</span><span class="o">.</span><span class="n">TYPE</span><span class="p">,),</span>
            <span class="p">(</span><span class="s">&#39;vector&#39;</span><span class="p">,</span> <span class="s">&#39;char&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="p">(</span><span class="n">Arg</span><span class="o">.</span><span class="n">TYPE</span><span class="p">,),</span>
            <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variable_namespace</span> <span class="o">=</span> <span class="n">variable_namespace</span> <span class="k">if</span> \
                                  <span class="n">variable_namespace</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type_aliases</span> <span class="o">=</span> <span class="n">_LazyConfigDict</span><span class="p">(</span><span class="n">type_aliases</span> <span class="k">if</span> <span class="n">type_aliases</span> <span class="ow">is</span> <span class="ow">not</span> \
                                                                      <span class="bp">None</span> <span class="k">else</span> <span class="p">{</span>
            <span class="s">&#39;i&#39;</span><span class="p">:</span> <span class="s">&#39;int32&#39;</span><span class="p">,</span>
            <span class="s">&#39;i2&#39;</span><span class="p">:</span> <span class="s">&#39;int16&#39;</span><span class="p">,</span>
            <span class="s">&#39;i4&#39;</span><span class="p">:</span> <span class="s">&#39;int32&#39;</span><span class="p">,</span>
            <span class="s">&#39;i8&#39;</span><span class="p">:</span> <span class="s">&#39;int64&#39;</span><span class="p">,</span>
            <span class="s">&#39;i16&#39;</span><span class="p">:</span> <span class="s">&#39;int128&#39;</span><span class="p">,</span>
            <span class="s">&#39;int&#39;</span><span class="p">:</span> <span class="s">&#39;int32&#39;</span><span class="p">,</span>
            <span class="s">&#39;ui&#39;</span><span class="p">:</span> <span class="s">&#39;uint32&#39;</span><span class="p">,</span>
            <span class="s">&#39;ui2&#39;</span><span class="p">:</span> <span class="s">&#39;uint16&#39;</span><span class="p">,</span>
            <span class="s">&#39;ui4&#39;</span><span class="p">:</span> <span class="s">&#39;uint32&#39;</span><span class="p">,</span>
            <span class="s">&#39;ui8&#39;</span><span class="p">:</span> <span class="s">&#39;uint64&#39;</span><span class="p">,</span>
            <span class="s">&#39;ui16&#39;</span><span class="p">:</span> <span class="s">&#39;uint128&#39;</span><span class="p">,</span>
            <span class="s">&#39;uint&#39;</span><span class="p">:</span> <span class="s">&#39;uint32&#39;</span><span class="p">,</span>
            <span class="s">&#39;f&#39;</span><span class="p">:</span> <span class="s">&#39;float64&#39;</span><span class="p">,</span>
            <span class="s">&#39;f4&#39;</span><span class="p">:</span> <span class="s">&#39;float32&#39;</span><span class="p">,</span>
            <span class="s">&#39;f8&#39;</span><span class="p">:</span> <span class="s">&#39;float64&#39;</span><span class="p">,</span>
            <span class="s">&#39;f16&#39;</span><span class="p">:</span> <span class="s">&#39;float128&#39;</span><span class="p">,</span>
            <span class="s">&#39;float&#39;</span><span class="p">:</span> <span class="s">&#39;float64&#39;</span><span class="p">,</span>
            <span class="s">&#39;double&#39;</span><span class="p">:</span> <span class="s">&#39;float64&#39;</span><span class="p">,</span>
            <span class="s">&#39;complex&#39;</span><span class="p">:</span> <span class="s">&#39;complex128&#39;</span><span class="p">,</span>
            <span class="s">&#39;b&#39;</span><span class="p">:</span> <span class="s">&#39;bool&#39;</span><span class="p">,</span>
            <span class="s">&#39;v&#39;</span><span class="p">:</span> <span class="s">&#39;void&#39;</span><span class="p">,</span>
            <span class="s">&#39;s&#39;</span><span class="p">:</span> <span class="s">&#39;str&#39;</span><span class="p">,</span>
            <span class="s">&#39;string&#39;</span><span class="p">:</span> <span class="s">&#39;str&#39;</span><span class="p">,</span>
            <span class="s">&#39;FILE&#39;</span><span class="p">:</span> <span class="s">&#39;file&#39;</span><span class="p">,</span>
            <span class="s">&#39;_IO_FILE&#39;</span><span class="p">:</span> <span class="s">&#39;file&#39;</span><span class="p">,</span>
            <span class="c"># &#39;c&#39; has char / complex ambiguity, not included</span>
            <span class="s">&#39;NPY_BYTE&#39;</span><span class="p">:</span> <span class="s">&#39;char&#39;</span><span class="p">,</span>
            <span class="s">&#39;NPY_UBYTE&#39;</span><span class="p">:</span> <span class="s">&#39;uchar&#39;</span><span class="p">,</span>
            <span class="s">&#39;NPY_STRING&#39;</span><span class="p">:</span> <span class="s">&#39;str&#39;</span><span class="p">,</span>
            <span class="s">&#39;NPY_INT16&#39;</span><span class="p">:</span> <span class="s">&#39;int16&#39;</span><span class="p">,</span>
            <span class="s">&#39;NPY_INT32&#39;</span><span class="p">:</span> <span class="s">&#39;int32&#39;</span><span class="p">,</span>
            <span class="s">&#39;NPY_INT64&#39;</span><span class="p">:</span> <span class="s">&#39;int64&#39;</span><span class="p">,</span>
            <span class="s">&#39;NPY_UINT16&#39;</span><span class="p">:</span> <span class="s">&#39;uint16&#39;</span><span class="p">,</span>
            <span class="s">&#39;NPY_UINT32&#39;</span><span class="p">:</span> <span class="s">&#39;uint32&#39;</span><span class="p">,</span>
            <span class="s">&#39;NPY_UINT64&#39;</span><span class="p">:</span> <span class="s">&#39;uint64&#39;</span><span class="p">,</span>
            <span class="s">&#39;NPY_FLOAT32&#39;</span><span class="p">:</span> <span class="s">&#39;float32&#39;</span><span class="p">,</span>
            <span class="s">&#39;NPY_FLOAT64&#39;</span><span class="p">:</span> <span class="s">&#39;float64&#39;</span><span class="p">,</span>
            <span class="s">&#39;NPY_COMPLEX128&#39;</span><span class="p">:</span> <span class="s">&#39;complex128&#39;</span><span class="p">,</span>
            <span class="s">&#39;NPY_BOOL&#39;</span><span class="p">:</span> <span class="s">&#39;bool&#39;</span><span class="p">,</span>
            <span class="s">&#39;NPY_VOID&#39;</span><span class="p">:</span> <span class="s">&#39;void&#39;</span><span class="p">,</span>
            <span class="s">&#39;NPY_OBJECT&#39;</span><span class="p">:</span> <span class="s">&#39;void&#39;</span><span class="p">,</span>
            <span class="s">&#39;np.NPY_BYTE&#39;</span><span class="p">:</span> <span class="s">&#39;char&#39;</span><span class="p">,</span>
            <span class="s">&#39;np.NPY_UBYTE&#39;</span><span class="p">:</span> <span class="s">&#39;uchar&#39;</span><span class="p">,</span>
            <span class="s">&#39;np.NPY_STRING&#39;</span><span class="p">:</span> <span class="s">&#39;str&#39;</span><span class="p">,</span>
            <span class="s">&#39;np.NPY_INT16&#39;</span><span class="p">:</span> <span class="s">&#39;int16&#39;</span><span class="p">,</span>
            <span class="s">&#39;np.NPY_INT32&#39;</span><span class="p">:</span> <span class="s">&#39;int32&#39;</span><span class="p">,</span>
            <span class="s">&#39;np.NPY_INT64&#39;</span><span class="p">:</span> <span class="s">&#39;int64&#39;</span><span class="p">,</span>
            <span class="s">&#39;np.NPY_UINT16&#39;</span><span class="p">:</span> <span class="s">&#39;uint16&#39;</span><span class="p">,</span>
            <span class="s">&#39;np.NPY_UINT32&#39;</span><span class="p">:</span> <span class="s">&#39;uint32&#39;</span><span class="p">,</span>
            <span class="s">&#39;np.NPY_UINT64&#39;</span><span class="p">:</span> <span class="s">&#39;uint64&#39;</span><span class="p">,</span>
            <span class="s">&#39;np.NPY_FLOAT32&#39;</span><span class="p">:</span> <span class="s">&#39;float32&#39;</span><span class="p">,</span>
            <span class="s">&#39;np.NPY_FLOAT64&#39;</span><span class="p">:</span> <span class="s">&#39;float64&#39;</span><span class="p">,</span>
            <span class="s">&#39;np.NPY_COMPLEX128&#39;</span><span class="p">:</span> <span class="s">&#39;complex128&#39;</span><span class="p">,</span>
            <span class="s">&#39;np.NPY_BOOL&#39;</span><span class="p">:</span> <span class="s">&#39;bool&#39;</span><span class="p">,</span>
            <span class="s">&#39;np.NPY_VOID&#39;</span><span class="p">:</span> <span class="s">&#39;void&#39;</span><span class="p">,</span>
            <span class="s">&#39;np.NPY_OBJECT&#39;</span><span class="p">:</span> <span class="s">&#39;void&#39;</span><span class="p">,</span>
            <span class="p">},</span> <span class="bp">self</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">cpp_types_function</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">ts</span><span class="p">):</span>
            <span class="n">rtnct</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">cpp_type</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">argcts</span> <span class="o">=</span> <span class="p">[</span><span class="n">ts</span><span class="o">.</span><span class="n">cpp_type</span><span class="p">(</span><span class="n">argt</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">argt</span> <span class="ow">in</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]]</span>
            <span class="k">if</span> <span class="n">argcts</span> <span class="o">==</span> <span class="p">[</span><span class="s">&#39;void&#39;</span><span class="p">]:</span>
                <span class="n">argcts</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">return</span> <span class="n">rtnct</span> <span class="o">+</span> <span class="s">&quot; {type_name}(&quot;</span> <span class="o">+</span> <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">argcts</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span>

        <span class="k">def</span> <span class="nf">cpp_types_function_pointer</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">ts</span><span class="p">):</span>
            <span class="n">rtnct</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">cpp_type</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">argcts</span> <span class="o">=</span> <span class="p">[</span><span class="n">ts</span><span class="o">.</span><span class="n">cpp_type</span><span class="p">(</span><span class="n">argt</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">argt</span> <span class="ow">in</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]]</span>
            <span class="k">if</span> <span class="n">argcts</span> <span class="o">==</span> <span class="p">[</span><span class="s">&#39;void&#39;</span><span class="p">]:</span>
                <span class="n">argcts</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">return</span> <span class="n">rtnct</span> <span class="o">+</span> <span class="s">&quot; (*{type_name})(&quot;</span> <span class="o">+</span> <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">argcts</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cpp_types</span> <span class="o">=</span> <span class="n">_LazyConfigDict</span><span class="p">(</span><span class="n">cpp_types</span> <span class="k">if</span> <span class="n">cpp_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="p">{</span>
            <span class="s">&#39;char&#39;</span><span class="p">:</span> <span class="s">&#39;char&#39;</span><span class="p">,</span>
            <span class="s">&#39;uchar&#39;</span><span class="p">:</span> <span class="s">&#39;unsigned char&#39;</span><span class="p">,</span>
            <span class="s">&#39;str&#39;</span><span class="p">:</span> <span class="s">&#39;std::string&#39;</span><span class="p">,</span>
            <span class="s">&#39;int16&#39;</span><span class="p">:</span> <span class="s">&#39;short&#39;</span><span class="p">,</span>
            <span class="s">&#39;int32&#39;</span><span class="p">:</span> <span class="s">&#39;int&#39;</span><span class="p">,</span>
            <span class="s">&#39;int64&#39;</span><span class="p">:</span> <span class="s">&#39;long long&#39;</span><span class="p">,</span>
            <span class="s">&#39;uint16&#39;</span><span class="p">:</span> <span class="s">&#39;unsigned short&#39;</span><span class="p">,</span>
            <span class="s">&#39;uint32&#39;</span><span class="p">:</span> <span class="s">&#39;unsigned long&#39;</span><span class="p">,</span>
            <span class="s">&#39;uint64&#39;</span><span class="p">:</span> <span class="s">&#39;unsigned long long&#39;</span><span class="p">,</span>
            <span class="s">&#39;float32&#39;</span><span class="p">:</span> <span class="s">&#39;float&#39;</span><span class="p">,</span>
            <span class="s">&#39;float64&#39;</span><span class="p">:</span> <span class="s">&#39;double&#39;</span><span class="p">,</span>
            <span class="s">&#39;float128&#39;</span><span class="p">:</span> <span class="s">&#39;long double&#39;</span><span class="p">,</span>
            <span class="s">&#39;complex128&#39;</span><span class="p">:</span> <span class="s">&#39;{extra_types}complex_t&#39;</span><span class="p">,</span>
            <span class="s">&#39;bool&#39;</span><span class="p">:</span> <span class="s">&#39;bool&#39;</span><span class="p">,</span>
            <span class="s">&#39;void&#39;</span><span class="p">:</span> <span class="s">&#39;void&#39;</span><span class="p">,</span> 
            <span class="s">&#39;file&#39;</span><span class="p">:</span> <span class="s">&#39;FILE&#39;</span><span class="p">,</span>
            <span class="s">&#39;exception&#39;</span><span class="p">:</span> <span class="s">&#39;{extra_types}exception&#39;</span><span class="p">,</span>
            <span class="s">&#39;map&#39;</span><span class="p">:</span> <span class="s">&#39;std::map&#39;</span><span class="p">,</span>
            <span class="s">&#39;dict&#39;</span><span class="p">:</span> <span class="s">&#39;std::map&#39;</span><span class="p">,</span>
            <span class="s">&#39;pair&#39;</span><span class="p">:</span> <span class="s">&#39;std::pair&#39;</span><span class="p">,</span>
            <span class="s">&#39;set&#39;</span><span class="p">:</span> <span class="s">&#39;std::set&#39;</span><span class="p">,</span>
            <span class="s">&#39;vector&#39;</span><span class="p">:</span> <span class="s">&#39;std::vector&#39;</span><span class="p">,</span>
            <span class="bp">True</span><span class="p">:</span> <span class="s">&#39;true&#39;</span><span class="p">,</span>
            <span class="s">&#39;true&#39;</span><span class="p">:</span> <span class="s">&#39;true&#39;</span><span class="p">,</span>
            <span class="s">&#39;True&#39;</span><span class="p">:</span> <span class="s">&#39;true&#39;</span><span class="p">,</span>
            <span class="bp">False</span><span class="p">:</span> <span class="s">&#39;false&#39;</span><span class="p">,</span>
            <span class="s">&#39;false&#39;</span><span class="p">:</span> <span class="s">&#39;false&#39;</span><span class="p">,</span>
            <span class="s">&#39;False&#39;</span><span class="p">:</span> <span class="s">&#39;false&#39;</span><span class="p">,</span>
            <span class="s">&#39;function&#39;</span><span class="p">:</span> <span class="n">cpp_types_function</span><span class="p">,</span>
            <span class="s">&#39;function_pointer&#39;</span><span class="p">:</span> <span class="n">cpp_types_function_pointer</span><span class="p">,</span>
            <span class="p">},</span> <span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">numpy_types</span> <span class="o">=</span> <span class="n">_LazyConfigDict</span><span class="p">(</span><span class="n">numpy_types</span> <span class="k">if</span> <span class="n">numpy_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> \
                                                                             <span class="k">else</span> <span class="p">{</span>
            <span class="s">&#39;char&#39;</span><span class="p">:</span> <span class="s">&#39;np.NPY_BYTE&#39;</span><span class="p">,</span>
            <span class="s">&#39;uchar&#39;</span><span class="p">:</span> <span class="s">&#39;np.NPY_UBYTE&#39;</span><span class="p">,</span>
            <span class="c">#&#39;str&#39;: &#39;np.NPY_STRING&#39;,</span>
            <span class="s">&#39;int16&#39;</span><span class="p">:</span> <span class="s">&#39;np.NPY_INT16&#39;</span><span class="p">,</span>
            <span class="s">&#39;int32&#39;</span><span class="p">:</span> <span class="s">&#39;np.NPY_INT32&#39;</span><span class="p">,</span>
            <span class="s">&#39;int64&#39;</span><span class="p">:</span> <span class="s">&#39;np.NPY_INT64&#39;</span><span class="p">,</span>
            <span class="s">&#39;uint16&#39;</span><span class="p">:</span> <span class="s">&#39;np.NPY_UINT16&#39;</span><span class="p">,</span>
            <span class="s">&#39;uint32&#39;</span><span class="p">:</span> <span class="s">&#39;np.NPY_UINT32&#39;</span><span class="p">,</span>
            <span class="s">&#39;uint64&#39;</span><span class="p">:</span> <span class="s">&#39;np.NPY_UINT64&#39;</span><span class="p">,</span>
            <span class="s">&#39;float32&#39;</span><span class="p">:</span> <span class="s">&#39;np.NPY_FLOAT32&#39;</span><span class="p">,</span>
            <span class="s">&#39;float64&#39;</span><span class="p">:</span> <span class="s">&#39;np.NPY_FLOAT64&#39;</span><span class="p">,</span>
            <span class="s">&#39;float128&#39;</span><span class="p">:</span> <span class="s">&#39;np.NPY_FLOAT128&#39;</span><span class="p">,</span>
            <span class="s">&#39;complex128&#39;</span><span class="p">:</span> <span class="s">&#39;np.NPY_COMPLEX128&#39;</span><span class="p">,</span>
            <span class="s">&#39;bool&#39;</span><span class="p">:</span> <span class="s">&#39;np.NPY_BOOL&#39;</span><span class="p">,</span>
            <span class="s">&#39;void&#39;</span><span class="p">:</span> <span class="s">&#39;np.NPY_VOID&#39;</span><span class="p">,</span>
            <span class="p">},</span> <span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">from_pytypes</span> <span class="o">=</span> <span class="n">from_pytypes</span> <span class="k">if</span> <span class="n">from_pytypes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="p">{</span>
            <span class="s">&#39;str&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;basestring&#39;</span><span class="p">],</span>
            <span class="s">&#39;char&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;basestring&#39;</span><span class="p">],</span>
            <span class="s">&#39;uchar&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;basestring&#39;</span><span class="p">],</span>
            <span class="s">&#39;int16&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;int&#39;</span><span class="p">],</span>
            <span class="s">&#39;int32&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;int&#39;</span><span class="p">],</span>
            <span class="s">&#39;int64&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;int&#39;</span><span class="p">],</span>
            <span class="s">&#39;uint16&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;int&#39;</span><span class="p">],</span>
            <span class="s">&#39;uint32&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;int&#39;</span><span class="p">],</span>
            <span class="s">&#39;uint64&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;int&#39;</span><span class="p">],</span>
            <span class="s">&#39;float32&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;float&#39;</span><span class="p">,</span> <span class="s">&#39;int&#39;</span><span class="p">],</span>
            <span class="s">&#39;float64&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;float&#39;</span><span class="p">,</span> <span class="s">&#39;int&#39;</span><span class="p">],</span>
            <span class="s">&#39;complex128&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;complex&#39;</span><span class="p">,</span> <span class="s">&#39;float&#39;</span><span class="p">],</span>
            <span class="s">&#39;file&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;file&#39;</span><span class="p">],</span>
            <span class="p">(</span><span class="s">&#39;file&#39;</span><span class="p">,</span> <span class="s">&#39;*&#39;</span><span class="p">):</span> <span class="p">[</span><span class="s">&#39;file&#39;</span><span class="p">],</span>
            <span class="s">&#39;set&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;collections.Set&#39;</span><span class="p">,</span> <span class="s">&#39;list&#39;</span><span class="p">,</span> <span class="s">&#39;basestring&#39;</span><span class="p">,</span> <span class="s">&#39;tuple&#39;</span><span class="p">],</span>
            <span class="s">&#39;map&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;collections.Mapping&#39;</span><span class="p">,</span> <span class="s">&#39;list&#39;</span><span class="p">,</span> <span class="s">&#39;tuple&#39;</span><span class="p">],</span>
            <span class="s">&#39;vector&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;list&#39;</span><span class="p">,</span> <span class="s">&#39;tuple&#39;</span><span class="p">,</span> <span class="s">&#39;np.ndarray&#39;</span><span class="p">],</span>
            <span class="p">}</span>

        <span class="k">def</span> <span class="nf">cython_ctypes_function</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">ts</span><span class="p">):</span>
            <span class="n">rtnct</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">cython_ctype</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">argcts</span> <span class="o">=</span> <span class="p">[</span><span class="n">ts</span><span class="o">.</span><span class="n">cython_ctype</span><span class="p">(</span><span class="n">argt</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">argt</span> <span class="ow">in</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]]</span>
            <span class="k">if</span> <span class="n">argcts</span> <span class="o">==</span> <span class="p">[</span><span class="s">&#39;void&#39;</span><span class="p">]:</span>
                <span class="n">argcts</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">return</span> <span class="n">rtnct</span> <span class="o">+</span> <span class="s">&quot; {type_name}(&quot;</span> <span class="o">+</span> <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">argcts</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span>

        <span class="k">def</span> <span class="nf">cython_ctypes_function_pointer</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">ts</span><span class="p">):</span>
            <span class="n">rtnct</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">cython_ctype</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">argcts</span> <span class="o">=</span> <span class="p">[</span><span class="n">ts</span><span class="o">.</span><span class="n">cython_ctype</span><span class="p">(</span><span class="n">argt</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">argt</span> <span class="ow">in</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]]</span>
            <span class="k">if</span> <span class="n">argcts</span> <span class="o">==</span> <span class="p">[</span><span class="s">&#39;void&#39;</span><span class="p">]:</span>
                <span class="n">argcts</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">return</span> <span class="n">rtnct</span> <span class="o">+</span> <span class="s">&quot; (*{type_name})(&quot;</span> <span class="o">+</span> <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">argcts</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cython_ctypes</span> <span class="o">=</span> <span class="n">_LazyConfigDict</span><span class="p">(</span><span class="n">cython_ctypes</span> <span class="k">if</span> <span class="n">cython_ctypes</span> <span class="ow">is</span> <span class="ow">not</span> \
                                                                         <span class="bp">None</span> <span class="k">else</span> <span class="p">{</span>
            <span class="s">&#39;char&#39;</span><span class="p">:</span> <span class="s">&#39;char&#39;</span><span class="p">,</span>
            <span class="s">&#39;uchar&#39;</span><span class="p">:</span> <span class="s">&#39;{extra_types}uchar&#39;</span><span class="p">,</span>
            <span class="s">&#39;str&#39;</span><span class="p">:</span> <span class="s">&#39;std_string&#39;</span><span class="p">,</span>
            <span class="s">&#39;int16&#39;</span><span class="p">:</span> <span class="s">&#39;short&#39;</span><span class="p">,</span>
            <span class="s">&#39;int32&#39;</span><span class="p">:</span> <span class="s">&#39;int&#39;</span><span class="p">,</span>
            <span class="s">&#39;int64&#39;</span><span class="p">:</span> <span class="s">&#39;{extra_types}int64&#39;</span><span class="p">,</span>
            <span class="s">&#39;uint16&#39;</span><span class="p">:</span> <span class="s">&#39;{extra_types}uint16&#39;</span><span class="p">,</span>
            <span class="s">&#39;uint32&#39;</span><span class="p">:</span> <span class="s">&#39;{extra_types}uint32&#39;</span><span class="p">,</span>
            <span class="s">&#39;uint64&#39;</span><span class="p">:</span> <span class="s">&#39;{extra_types}uint64&#39;</span><span class="p">,</span>
            <span class="s">&#39;float32&#39;</span><span class="p">:</span> <span class="s">&#39;float&#39;</span><span class="p">,</span>
            <span class="s">&#39;float64&#39;</span><span class="p">:</span> <span class="s">&#39;double&#39;</span><span class="p">,</span>
            <span class="s">&#39;float128&#39;</span><span class="p">:</span> <span class="s">&#39;{extra_types}float128&#39;</span><span class="p">,</span>
            <span class="s">&#39;complex128&#39;</span><span class="p">:</span> <span class="s">&#39;{extra_types}complex_t&#39;</span><span class="p">,</span>
            <span class="s">&#39;bool&#39;</span><span class="p">:</span> <span class="s">&#39;bint&#39;</span><span class="p">,</span>
            <span class="s">&#39;void&#39;</span><span class="p">:</span> <span class="s">&#39;void&#39;</span><span class="p">,</span>
            <span class="s">&#39;file&#39;</span><span class="p">:</span> <span class="s">&#39;c_file&#39;</span><span class="p">,</span>
            <span class="s">&#39;exception&#39;</span><span class="p">:</span> <span class="s">&#39;{extra_types}exception&#39;</span><span class="p">,</span>
            <span class="s">&#39;map&#39;</span><span class="p">:</span> <span class="s">&#39;cpp_map&#39;</span><span class="p">,</span>
            <span class="s">&#39;dict&#39;</span><span class="p">:</span> <span class="s">&#39;dict&#39;</span><span class="p">,</span>
            <span class="s">&#39;pair&#39;</span><span class="p">:</span> <span class="s">&#39;cpp_pair&#39;</span><span class="p">,</span>
            <span class="s">&#39;set&#39;</span><span class="p">:</span> <span class="s">&#39;cpp_set&#39;</span><span class="p">,</span>
            <span class="s">&#39;vector&#39;</span><span class="p">:</span> <span class="s">&#39;cpp_vector&#39;</span><span class="p">,</span>
            <span class="s">&#39;function&#39;</span><span class="p">:</span> <span class="n">cython_ctypes_function</span><span class="p">,</span>
            <span class="s">&#39;function_pointer&#39;</span><span class="p">:</span> <span class="n">cython_ctypes_function_pointer</span><span class="p">,</span>
            <span class="p">},</span> <span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cython_cytypes</span> <span class="o">=</span> <span class="n">_LazyConfigDict</span><span class="p">(</span><span class="n">cython_cytypes</span> <span class="k">if</span> <span class="n">cython_cytypes</span> \
                                              <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="p">{</span>
            <span class="s">&#39;char&#39;</span><span class="p">:</span> <span class="s">&#39;char&#39;</span><span class="p">,</span>
            <span class="s">&#39;uchar&#39;</span><span class="p">:</span> <span class="s">&#39;unsigned char&#39;</span><span class="p">,</span>
            <span class="s">&#39;str&#39;</span><span class="p">:</span> <span class="s">&#39;char *&#39;</span><span class="p">,</span>
            <span class="s">&#39;int16&#39;</span><span class="p">:</span> <span class="s">&#39;short&#39;</span><span class="p">,</span>
            <span class="s">&#39;int32&#39;</span><span class="p">:</span> <span class="s">&#39;int&#39;</span><span class="p">,</span>
            <span class="p">(</span><span class="s">&#39;int32&#39;</span><span class="p">,</span> <span class="s">&#39;*&#39;</span><span class="p">):</span> <span class="s">&#39;int *&#39;</span><span class="p">,</span>
            <span class="s">&#39;int64&#39;</span><span class="p">:</span> <span class="s">&#39;long long&#39;</span><span class="p">,</span>
            <span class="s">&#39;uint16&#39;</span><span class="p">:</span> <span class="s">&#39;unsigned short&#39;</span><span class="p">,</span>
            <span class="s">&#39;uint32&#39;</span><span class="p">:</span> <span class="s">&#39;unsigned long&#39;</span><span class="p">,</span>  <span class="c"># &#39;unsigned int&#39;</span>
            <span class="s">&#39;uint64&#39;</span><span class="p">:</span> <span class="s">&#39;unsigned long long&#39;</span><span class="p">,</span>
            <span class="s">&#39;float32&#39;</span><span class="p">:</span> <span class="s">&#39;float&#39;</span><span class="p">,</span>
            <span class="s">&#39;float64&#39;</span><span class="p">:</span> <span class="s">&#39;float&#39;</span><span class="p">,</span>
            <span class="s">&#39;float128&#39;</span><span class="p">:</span> <span class="s">&#39;long double&#39;</span><span class="p">,</span>
            <span class="s">&#39;complex128&#39;</span><span class="p">:</span> <span class="s">&#39;object&#39;</span><span class="p">,</span>
            <span class="s">&#39;bool&#39;</span><span class="p">:</span> <span class="s">&#39;bint&#39;</span><span class="p">,</span>
            <span class="s">&#39;void&#39;</span><span class="p">:</span> <span class="s">&#39;void&#39;</span><span class="p">,</span>
            <span class="s">&#39;file&#39;</span><span class="p">:</span> <span class="s">&#39;c_file&#39;</span><span class="p">,</span>
            <span class="s">&#39;exception&#39;</span><span class="p">:</span> <span class="s">&#39;{extra_types}exception&#39;</span><span class="p">,</span>
            <span class="s">&#39;map&#39;</span><span class="p">:</span> <span class="s">&#39;{stlcontainers}_Map{key_type}{value_type}&#39;</span><span class="p">,</span>
            <span class="s">&#39;dict&#39;</span><span class="p">:</span> <span class="s">&#39;dict&#39;</span><span class="p">,</span>
            <span class="s">&#39;pair&#39;</span><span class="p">:</span> <span class="s">&#39;{stlcontainers}_Pair{value_type}&#39;</span><span class="p">,</span>
            <span class="s">&#39;set&#39;</span><span class="p">:</span> <span class="s">&#39;{stlcontainers}_Set{value_type}&#39;</span><span class="p">,</span>
            <span class="s">&#39;vector&#39;</span><span class="p">:</span> <span class="s">&#39;np.ndarray&#39;</span><span class="p">,</span>
            <span class="s">&#39;function&#39;</span><span class="p">:</span> <span class="s">&#39;object&#39;</span><span class="p">,</span>
            <span class="s">&#39;function_pointer&#39;</span><span class="p">:</span> <span class="s">&#39;object&#39;</span><span class="p">,</span>
            <span class="p">},</span> <span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cython_pytypes</span> <span class="o">=</span> <span class="n">_LazyConfigDict</span><span class="p">(</span><span class="n">cython_pytypes</span> <span class="k">if</span> <span class="n">cython_pytypes</span> \
                                              <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="p">{</span>
            <span class="s">&#39;char&#39;</span><span class="p">:</span> <span class="s">&#39;str&#39;</span><span class="p">,</span>
            <span class="s">&#39;uchar&#39;</span><span class="p">:</span> <span class="s">&#39;str&#39;</span><span class="p">,</span>
            <span class="s">&#39;str&#39;</span><span class="p">:</span> <span class="s">&#39;str&#39;</span><span class="p">,</span>
            <span class="s">&#39;int16&#39;</span><span class="p">:</span> <span class="s">&#39;int&#39;</span><span class="p">,</span>
            <span class="s">&#39;int32&#39;</span><span class="p">:</span> <span class="s">&#39;int&#39;</span><span class="p">,</span>
            <span class="s">&#39;int64&#39;</span><span class="p">:</span> <span class="s">&#39;int&#39;</span><span class="p">,</span>
            <span class="s">&#39;uint16&#39;</span><span class="p">:</span> <span class="s">&#39;int&#39;</span><span class="p">,</span>  <span class="c"># &#39;unsigned int&#39;</span>
            <span class="s">&#39;uint32&#39;</span><span class="p">:</span> <span class="s">&#39;int&#39;</span><span class="p">,</span>  <span class="c"># &#39;unsigned int&#39;</span>
            <span class="s">&#39;uint64&#39;</span><span class="p">:</span> <span class="s">&#39;int&#39;</span><span class="p">,</span>  <span class="c"># &#39;unsigned int&#39;</span>
            <span class="s">&#39;float32&#39;</span><span class="p">:</span> <span class="s">&#39;float&#39;</span><span class="p">,</span>
            <span class="s">&#39;float64&#39;</span><span class="p">:</span> <span class="s">&#39;float&#39;</span><span class="p">,</span>
            <span class="s">&#39;float128&#39;</span><span class="p">:</span> <span class="s">&#39;np.float128&#39;</span><span class="p">,</span>
            <span class="s">&#39;complex128&#39;</span><span class="p">:</span> <span class="s">&#39;object&#39;</span><span class="p">,</span>
            <span class="s">&#39;file&#39;</span><span class="p">:</span> <span class="s">&#39;file&#39;</span><span class="p">,</span>
            <span class="s">&#39;exception&#39;</span><span class="p">:</span> <span class="s">&#39;Exception&#39;</span><span class="p">,</span>
            <span class="s">&#39;bool&#39;</span><span class="p">:</span> <span class="s">&#39;bool&#39;</span><span class="p">,</span>
            <span class="s">&#39;void&#39;</span><span class="p">:</span> <span class="s">&#39;object&#39;</span><span class="p">,</span>
            <span class="s">&#39;map&#39;</span><span class="p">:</span> <span class="s">&#39;{stlcontainers}Map{key_type}{value_type}&#39;</span><span class="p">,</span>
            <span class="s">&#39;dict&#39;</span><span class="p">:</span> <span class="s">&#39;dict&#39;</span><span class="p">,</span>
            <span class="s">&#39;pair&#39;</span><span class="p">:</span> <span class="s">&#39;{stlcontainers}Pair{value_type}&#39;</span><span class="p">,</span>
            <span class="s">&#39;set&#39;</span><span class="p">:</span> <span class="s">&#39;{stlcontainers}Set{value_type}&#39;</span><span class="p">,</span>
            <span class="s">&#39;vector&#39;</span><span class="p">:</span> <span class="s">&#39;np.ndarray&#39;</span><span class="p">,</span>
            <span class="p">},</span> <span class="bp">self</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">cython_cimports_functionish</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="n">seen</span><span class="p">):</span>
            <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="s">&#39;cython.operator&#39;</span><span class="p">,</span> <span class="s">&#39;dereference&#39;</span><span class="p">,</span> <span class="s">&#39;deref&#39;</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">argt</span> <span class="ow">in</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]:</span>
                <span class="n">ts</span><span class="o">.</span><span class="n">cython_cimport_tuples</span><span class="p">(</span><span class="n">argt</span><span class="p">,</span> <span class="n">seen</span><span class="o">=</span><span class="n">seen</span><span class="p">,</span> <span class="n">inc</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;c&#39;</span><span class="p">,))</span>
            <span class="n">ts</span><span class="o">.</span><span class="n">cython_cimport_tuples</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">seen</span><span class="o">=</span><span class="n">seen</span><span class="p">,</span> <span class="n">inc</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;c&#39;</span><span class="p">,))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cython_cimports</span> <span class="o">=</span> <span class="n">_LazyImportDict</span><span class="p">(</span><span class="n">cython_cimports</span> <span class="k">if</span> <span class="n">cython_cimports</span> \
                                               <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="p">{</span>
            <span class="s">&#39;char&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">None</span><span class="p">,),</span>
            <span class="s">&#39;uchar&#39;</span><span class="p">:</span>  <span class="p">((</span><span class="s">&#39;{extra_types}&#39;</span><span class="p">,),),</span>
            <span class="s">&#39;str&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s">&#39;libcpp.string&#39;</span><span class="p">,</span> <span class="s">&#39;string&#39;</span><span class="p">,</span> <span class="s">&#39;std_string&#39;</span><span class="p">),),</span>
            <span class="s">&#39;int16&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">None</span><span class="p">,),</span>
            <span class="s">&#39;int32&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">None</span><span class="p">,),</span>
            <span class="p">(</span><span class="s">&#39;int32&#39;</span><span class="p">,</span> <span class="s">&#39;*&#39;</span><span class="p">):</span> <span class="s">&#39;int *&#39;</span><span class="p">,</span>
            <span class="s">&#39;int64&#39;</span><span class="p">:</span>  <span class="p">((</span><span class="s">&#39;{extra_types}&#39;</span><span class="p">,),),</span>
            <span class="s">&#39;uint16&#39;</span><span class="p">:</span>  <span class="p">((</span><span class="s">&#39;{extra_types}&#39;</span><span class="p">,),),</span>
            <span class="s">&#39;uint32&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s">&#39;{extra_types}&#39;</span><span class="p">,),),</span>
            <span class="s">&#39;uint64&#39;</span><span class="p">:</span>  <span class="p">((</span><span class="s">&#39;{extra_types}&#39;</span><span class="p">,),),</span>
            <span class="s">&#39;float32&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">None</span><span class="p">,),</span>
            <span class="s">&#39;float64&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">None</span><span class="p">,),</span>
            <span class="s">&#39;float128&#39;</span><span class="p">:</span>  <span class="p">((</span><span class="s">&#39;{extra_types}&#39;</span><span class="p">,),),</span>
            <span class="s">&#39;complex128&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s">&#39;{extra_types}&#39;</span><span class="p">,),),</span>
            <span class="s">&#39;bool&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">None</span><span class="p">,),</span>
            <span class="s">&#39;void&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">None</span><span class="p">,),</span>
            <span class="s">&#39;file&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s">&#39;libc.stdio&#39;</span><span class="p">,</span> <span class="s">&#39;FILE&#39;</span><span class="p">,</span> <span class="s">&#39;c_file&#39;</span><span class="p">),),</span>
            <span class="s">&#39;exception&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s">&#39;{extra_types}&#39;</span><span class="p">,),),</span>
            <span class="s">&#39;map&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s">&#39;libcpp.map&#39;</span><span class="p">,</span> <span class="s">&#39;map&#39;</span><span class="p">,</span> <span class="s">&#39;cpp_map&#39;</span><span class="p">),),</span>
            <span class="s">&#39;dict&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">None</span><span class="p">,),</span>
            <span class="s">&#39;pair&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s">&#39;libcpp.utility&#39;</span><span class="p">,</span> <span class="s">&#39;pair&#39;</span><span class="p">,</span> <span class="s">&#39;cpp_pair&#39;</span><span class="p">),),</span>
            <span class="s">&#39;set&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s">&#39;libcpp.set&#39;</span><span class="p">,</span> <span class="s">&#39;set&#39;</span><span class="p">,</span> <span class="s">&#39;cpp_set&#39;</span><span class="p">),),</span>
            <span class="s">&#39;vector&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s">&#39;libcpp.vector&#39;</span><span class="p">,</span> <span class="s">&#39;vector&#39;</span><span class="p">,</span> <span class="s">&#39;cpp_vector&#39;</span><span class="p">),),</span>
            <span class="s">&#39;nucid&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s">&#39;pyne&#39;</span><span class="p">,</span> <span class="s">&#39;cpp_nucname&#39;</span><span class="p">),),</span>
            <span class="s">&#39;nucname&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s">&#39;pyne&#39;</span><span class="p">,</span> <span class="s">&#39;cpp_nucname&#39;</span><span class="p">),</span> 
                        <span class="p">(</span><span class="s">&#39;libcpp.string&#39;</span><span class="p">,</span> <span class="s">&#39;string&#39;</span><span class="p">,</span> <span class="s">&#39;std_string&#39;</span><span class="p">)),</span>
            <span class="s">&#39;function&#39;</span><span class="p">:</span> <span class="n">cython_cimports_functionish</span><span class="p">,</span>
            <span class="s">&#39;function_pointer&#39;</span><span class="p">:</span> <span class="n">cython_cimports_functionish</span><span class="p">,</span>
            <span class="p">},</span> <span class="bp">self</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">cython_cyimports_functionish</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="n">seen</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">argt</span> <span class="ow">in</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]:</span>
                <span class="n">ts</span><span class="o">.</span><span class="n">cython_cimport_tuples</span><span class="p">(</span><span class="n">argt</span><span class="p">,</span> <span class="n">seen</span><span class="o">=</span><span class="n">seen</span><span class="p">,</span> <span class="n">inc</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;cy&#39;</span><span class="p">,))</span>
            <span class="n">ts</span><span class="o">.</span><span class="n">cython_cimport_tuples</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">seen</span><span class="o">=</span><span class="n">seen</span><span class="p">,</span> <span class="n">inc</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;cy&#39;</span><span class="p">,))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cython_cyimports</span> <span class="o">=</span> <span class="n">_LazyImportDict</span><span class="p">(</span><span class="n">cython_cyimports</span> <span class="k">if</span> \
                                    <span class="n">cython_cyimports</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="p">{</span>
            <span class="s">&#39;char&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">None</span><span class="p">,),</span>
            <span class="s">&#39;uchar&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">None</span><span class="p">,),</span>
            <span class="s">&#39;str&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">None</span><span class="p">,),</span>
            <span class="s">&#39;int16&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">None</span><span class="p">,),</span>
            <span class="s">&#39;int32&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">None</span><span class="p">,),</span>
            <span class="s">&#39;int64&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">None</span><span class="p">,),</span>
            <span class="s">&#39;uint16&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">None</span><span class="p">,),</span>
            <span class="s">&#39;uint32&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">None</span><span class="p">,),</span>
            <span class="s">&#39;uint64&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">None</span><span class="p">,),</span>
            <span class="s">&#39;float32&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">None</span><span class="p">,),</span>
            <span class="s">&#39;float64&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">None</span><span class="p">,),</span>
            <span class="s">&#39;float128&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">None</span><span class="p">,),</span>
            <span class="s">&#39;complex128&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s">&#39;{extra_types}&#39;</span><span class="p">,),),</span>  <span class="c"># for py2c_complex()</span>
            <span class="s">&#39;bool&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">None</span><span class="p">,),</span>
            <span class="s">&#39;void&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">None</span><span class="p">,),</span>
            <span class="s">&#39;file&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s">&#39;{extra_types}&#39;</span><span class="p">,),),</span>
            <span class="s">&#39;exception&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s">&#39;{extra_types}&#39;</span><span class="p">,),),</span>
            <span class="s">&#39;map&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s">&#39;{stlcontainers}&#39;</span><span class="p">,),),</span>
            <span class="s">&#39;dict&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">None</span><span class="p">,),</span>
            <span class="s">&#39;pair&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s">&#39;{stlcontainers}&#39;</span><span class="p">,),),</span>
            <span class="s">&#39;set&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s">&#39;{stlcontainers}&#39;</span><span class="p">,),),</span>
            <span class="s">&#39;vector&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s">&#39;numpy&#39;</span><span class="p">,</span> <span class="s">&#39;as&#39;</span><span class="p">,</span> <span class="s">&#39;np&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;{dtypes}&#39;</span><span class="p">,)),</span>
            <span class="s">&#39;nucid&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s">&#39;pyne&#39;</span><span class="p">,</span> <span class="s">&#39;nucname&#39;</span><span class="p">),),</span>
            <span class="s">&#39;nucname&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s">&#39;pyne&#39;</span><span class="p">,</span> <span class="s">&#39;nucname&#39;</span><span class="p">),),</span>
            <span class="s">&#39;function&#39;</span><span class="p">:</span> <span class="n">cython_cyimports_functionish</span><span class="p">,</span>
            <span class="s">&#39;function_pointer&#39;</span><span class="p">:</span> <span class="n">cython_cyimports_functionish</span><span class="p">,</span>
            <span class="p">},</span> <span class="bp">self</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">cython_pyimports_functionish</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="n">seen</span><span class="p">):</span>
            <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="s">&#39;warnings&#39;</span><span class="p">,))</span>
            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">argt</span> <span class="ow">in</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]:</span>
                <span class="n">ts</span><span class="o">.</span><span class="n">cython_import_tuples</span><span class="p">(</span><span class="n">argt</span><span class="p">,</span> <span class="n">seen</span><span class="o">=</span><span class="n">seen</span><span class="p">)</span>
            <span class="n">ts</span><span class="o">.</span><span class="n">cython_import_tuples</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">seen</span><span class="o">=</span><span class="n">seen</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cython_pyimports</span> <span class="o">=</span> <span class="n">_LazyImportDict</span><span class="p">(</span><span class="n">cython_pyimports</span> <span class="k">if</span> \
                                    <span class="n">cython_pyimports</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="p">{</span>
            <span class="s">&#39;char&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">None</span><span class="p">,),</span>
            <span class="s">&#39;uchar&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">None</span><span class="p">,),</span>
            <span class="s">&#39;str&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">None</span><span class="p">,),</span>
            <span class="s">&#39;int16&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">None</span><span class="p">,),</span>
            <span class="s">&#39;int32&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">None</span><span class="p">,),</span>
            <span class="s">&#39;int64&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">None</span><span class="p">,),</span>
            <span class="s">&#39;uint16&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">None</span><span class="p">,),</span>
            <span class="s">&#39;uint32&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">None</span><span class="p">,),</span>
            <span class="s">&#39;uint64&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">None</span><span class="p">,),</span>
            <span class="s">&#39;float32&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">None</span><span class="p">,),</span>
            <span class="s">&#39;float64&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">None</span><span class="p">,),</span>
            <span class="s">&#39;float128&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">None</span><span class="p">,),</span>
            <span class="s">&#39;complex128&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">None</span><span class="p">,),</span>
            <span class="s">&#39;bool&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">None</span><span class="p">,),</span>
            <span class="s">&#39;void&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">None</span><span class="p">,),</span>
            <span class="s">&#39;file&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">None</span><span class="p">,),</span>
            <span class="s">&#39;exception&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">None</span><span class="p">,),</span>
            <span class="s">&#39;map&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s">&#39;{stlcontainers}&#39;</span><span class="p">,),</span> <span class="p">(</span><span class="s">&#39;collections&#39;</span><span class="p">,)),</span>
            <span class="s">&#39;dict&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">None</span><span class="p">,),</span>
            <span class="s">&#39;pair&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s">&#39;{stlcontainers}&#39;</span><span class="p">,),),</span>
            <span class="s">&#39;set&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s">&#39;{stlcontainers}&#39;</span><span class="p">,),</span> <span class="p">(</span><span class="s">&#39;collections&#39;</span><span class="p">,)),</span>
            <span class="s">&#39;vector&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s">&#39;numpy&#39;</span><span class="p">,</span> <span class="s">&#39;as&#39;</span><span class="p">,</span> <span class="s">&#39;np&#39;</span><span class="p">),),</span>
            <span class="s">&#39;nucid&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s">&#39;pyne&#39;</span><span class="p">,</span> <span class="s">&#39;nucname&#39;</span><span class="p">),),</span>
            <span class="s">&#39;nucname&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s">&#39;pyne&#39;</span><span class="p">,</span> <span class="s">&#39;nucname&#39;</span><span class="p">),),</span>
            <span class="s">&#39;function&#39;</span><span class="p">:</span> <span class="n">cython_pyimports_functionish</span><span class="p">,</span>
            <span class="s">&#39;function_pointer&#39;</span><span class="p">:</span> <span class="n">cython_pyimports_functionish</span><span class="p">,</span>
            <span class="p">},</span> <span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cython_functionnames</span> <span class="o">=</span> <span class="n">_LazyConfigDict</span><span class="p">(</span><span class="n">cython_functionnames</span> <span class="k">if</span> \
                                        <span class="n">cython_functionnames</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c"># base types</span>
            <span class="s">&#39;char&#39;</span><span class="p">:</span> <span class="s">&#39;char&#39;</span><span class="p">,</span>
            <span class="s">&#39;uchar&#39;</span><span class="p">:</span> <span class="s">&#39;uchar&#39;</span><span class="p">,</span>
            <span class="s">&#39;str&#39;</span><span class="p">:</span> <span class="s">&#39;str&#39;</span><span class="p">,</span>
            <span class="s">&#39;int16&#39;</span><span class="p">:</span> <span class="s">&#39;short&#39;</span><span class="p">,</span>
            <span class="s">&#39;int32&#39;</span><span class="p">:</span> <span class="s">&#39;int&#39;</span><span class="p">,</span>
            <span class="s">&#39;int64&#39;</span><span class="p">:</span> <span class="s">&#39;long&#39;</span><span class="p">,</span>
            <span class="s">&#39;uint16&#39;</span><span class="p">:</span> <span class="s">&#39;ushort&#39;</span><span class="p">,</span>
            <span class="s">&#39;uint32&#39;</span><span class="p">:</span> <span class="s">&#39;uint&#39;</span><span class="p">,</span>
            <span class="s">&#39;uint64&#39;</span><span class="p">:</span> <span class="s">&#39;ulong&#39;</span><span class="p">,</span>
            <span class="s">&#39;float32&#39;</span><span class="p">:</span> <span class="s">&#39;float&#39;</span><span class="p">,</span>
            <span class="s">&#39;float64&#39;</span><span class="p">:</span> <span class="s">&#39;double&#39;</span><span class="p">,</span>
            <span class="s">&#39;float128&#39;</span><span class="p">:</span> <span class="s">&#39;longdouble&#39;</span><span class="p">,</span>
            <span class="s">&#39;complex128&#39;</span><span class="p">:</span> <span class="s">&#39;complex&#39;</span><span class="p">,</span>
            <span class="s">&#39;bool&#39;</span><span class="p">:</span> <span class="s">&#39;bool&#39;</span><span class="p">,</span>
            <span class="s">&#39;void&#39;</span><span class="p">:</span> <span class="s">&#39;void&#39;</span><span class="p">,</span>
            <span class="s">&#39;file&#39;</span><span class="p">:</span> <span class="s">&#39;file&#39;</span><span class="p">,</span>
            <span class="s">&#39;exception&#39;</span><span class="p">:</span> <span class="s">&#39;exception&#39;</span><span class="p">,</span>
            <span class="c"># template types</span>
            <span class="s">&#39;map&#39;</span><span class="p">:</span> <span class="s">&#39;map_{key_type}_{value_type}&#39;</span><span class="p">,</span>
            <span class="s">&#39;dict&#39;</span><span class="p">:</span> <span class="s">&#39;dict&#39;</span><span class="p">,</span>
            <span class="s">&#39;pair&#39;</span><span class="p">:</span> <span class="s">&#39;pair_{key_type}_{value_type}&#39;</span><span class="p">,</span>
            <span class="s">&#39;set&#39;</span><span class="p">:</span> <span class="s">&#39;set_{value_type}&#39;</span><span class="p">,</span>
            <span class="s">&#39;vector&#39;</span><span class="p">:</span> <span class="s">&#39;vector_{value_type}&#39;</span><span class="p">,</span>
            <span class="s">&#39;nucid&#39;</span><span class="p">:</span> <span class="s">&#39;nucid&#39;</span><span class="p">,</span>
            <span class="s">&#39;nucname&#39;</span><span class="p">:</span> <span class="s">&#39;nucname&#39;</span><span class="p">,</span>
            <span class="s">&#39;function&#39;</span><span class="p">:</span> <span class="s">&#39;function&#39;</span><span class="p">,</span>
            <span class="s">&#39;function_pointer&#39;</span><span class="p">:</span> <span class="s">&#39;functionpointer&#39;</span><span class="p">,</span>
            <span class="p">},</span> <span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cython_classnames</span> <span class="o">=</span> <span class="n">_LazyConfigDict</span><span class="p">(</span><span class="n">cython_classnames</span> <span class="k">if</span> \
                                                 <span class="n">cython_classnames</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c"># base types</span>
            <span class="s">&#39;char&#39;</span><span class="p">:</span> <span class="s">&#39;Char&#39;</span><span class="p">,</span>
            <span class="s">&#39;uchar&#39;</span><span class="p">:</span> <span class="s">&#39;UChar&#39;</span><span class="p">,</span>
            <span class="s">&#39;str&#39;</span><span class="p">:</span> <span class="s">&#39;Str&#39;</span><span class="p">,</span>
            <span class="s">&#39;int32&#39;</span><span class="p">:</span> <span class="s">&#39;Short&#39;</span><span class="p">,</span>
            <span class="s">&#39;int32&#39;</span><span class="p">:</span> <span class="s">&#39;Int&#39;</span><span class="p">,</span>
            <span class="s">&#39;int64&#39;</span><span class="p">:</span> <span class="s">&#39;Long&#39;</span><span class="p">,</span>
            <span class="s">&#39;uint16&#39;</span><span class="p">:</span> <span class="s">&#39;UShort&#39;</span><span class="p">,</span>
            <span class="s">&#39;uint32&#39;</span><span class="p">:</span> <span class="s">&#39;UInt&#39;</span><span class="p">,</span>
            <span class="s">&#39;uint64&#39;</span><span class="p">:</span> <span class="s">&#39;ULong&#39;</span><span class="p">,</span>
            <span class="s">&#39;float32&#39;</span><span class="p">:</span> <span class="s">&#39;Float&#39;</span><span class="p">,</span>
            <span class="s">&#39;float64&#39;</span><span class="p">:</span> <span class="s">&#39;Double&#39;</span><span class="p">,</span>
            <span class="s">&#39;float128&#39;</span><span class="p">:</span> <span class="s">&#39;Longdouble&#39;</span><span class="p">,</span>
            <span class="s">&#39;complex128&#39;</span><span class="p">:</span> <span class="s">&#39;Complex&#39;</span><span class="p">,</span>
            <span class="s">&#39;bool&#39;</span><span class="p">:</span> <span class="s">&#39;Bool&#39;</span><span class="p">,</span>
            <span class="s">&#39;void&#39;</span><span class="p">:</span> <span class="s">&#39;Void&#39;</span><span class="p">,</span>
            <span class="s">&#39;file&#39;</span><span class="p">:</span> <span class="s">&#39;File&#39;</span><span class="p">,</span>
            <span class="s">&#39;exception&#39;</span><span class="p">:</span> <span class="s">&#39;Exception&#39;</span><span class="p">,</span>
            <span class="c"># template types</span>
            <span class="s">&#39;map&#39;</span><span class="p">:</span> <span class="s">&#39;Map{key_type}{value_type}&#39;</span><span class="p">,</span>
            <span class="s">&#39;dict&#39;</span><span class="p">:</span> <span class="s">&#39;Dict&#39;</span><span class="p">,</span>
            <span class="s">&#39;pair&#39;</span><span class="p">:</span> <span class="s">&#39;Pair{key_type}{value_type}&#39;</span><span class="p">,</span>
            <span class="s">&#39;set&#39;</span><span class="p">:</span> <span class="s">&#39;Set{value_type}&#39;</span><span class="p">,</span>
            <span class="s">&#39;vector&#39;</span><span class="p">:</span> <span class="s">&#39;Vector{value_type}&#39;</span><span class="p">,</span>
            <span class="s">&#39;nucid&#39;</span><span class="p">:</span> <span class="s">&#39;Nucid&#39;</span><span class="p">,</span>
            <span class="s">&#39;nucname&#39;</span><span class="p">:</span> <span class="s">&#39;Nucname&#39;</span><span class="p">,</span>
            <span class="p">},</span> <span class="bp">self</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">cython_c2py_conv_function_pointer</span><span class="p">(</span><span class="n">t_</span><span class="p">,</span> <span class="n">ts</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Wrap function pointers in C/C++ to Python functions.&quot;&quot;&quot;</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">t_</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">argnames</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">argdecls</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">argbodys</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">argrtns</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">argt</span> <span class="ow">in</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]:</span>
                <span class="n">argnames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                <span class="n">decl</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">rtn</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">cython_py2c</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">argt</span><span class="p">,</span> <span class="n">proxy_name</span><span class="o">=</span><span class="s">&quot;c_&quot;</span> <span class="o">+</span> <span class="n">n</span><span class="p">)</span>
                <span class="n">argdecls</span> <span class="o">+=</span> <span class="n">decl</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">decl</span><span class="p">,</span><span class="nb">basestring</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">decl</span><span class="p">]</span>
                <span class="n">argbodys</span> <span class="o">+=</span> <span class="n">body</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">body</span><span class="p">,</span><span class="nb">basestring</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">body</span><span class="p">]</span>
                <span class="n">argrtns</span> <span class="o">+=</span> <span class="n">rtn</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rtn</span><span class="p">,</span><span class="nb">basestring</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">rtn</span><span class="p">]</span>
            <span class="n">rtnname</span> <span class="o">=</span> <span class="s">&#39;rtn&#39;</span>
            <span class="n">rtnprox</span> <span class="o">=</span> <span class="s">&#39;c_&#39;</span> <span class="o">+</span> <span class="n">rtnname</span>
            <span class="n">rtncall</span> <span class="o">=</span> <span class="s">&#39;c_call_&#39;</span> <span class="o">+</span> <span class="n">rtnname</span>
            <span class="k">while</span> <span class="n">rtnname</span> <span class="ow">in</span> <span class="n">argnames</span> <span class="ow">or</span> <span class="n">rtnprox</span> <span class="ow">in</span> <span class="n">argnames</span><span class="p">:</span>
                <span class="n">rtnname</span> <span class="o">+=</span> <span class="s">&#39;_&#39;</span>
                <span class="n">rtnprox</span> <span class="o">+=</span> <span class="s">&#39;_&#39;</span>
            <span class="n">argdecls</span> <span class="o">=</span> <span class="n">indent</span><span class="p">(</span><span class="n">argdecls</span><span class="p">)</span>
            <span class="n">argbodys</span> <span class="o">=</span> <span class="n">indent</span><span class="p">(</span><span class="n">argbodys</span><span class="p">)</span>
            <span class="n">rtndecl</span><span class="p">,</span> <span class="n">rtnbody</span><span class="p">,</span> <span class="n">rtnrtn</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">cython_c2py</span><span class="p">(</span><span class="n">rtncall</span><span class="p">,</span> <span class="n">t</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> 
                <span class="n">cached</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">proxy_name</span><span class="o">=</span><span class="n">rtnprox</span><span class="p">,</span> <span class="n">existing_name</span><span class="o">=</span><span class="n">rtncall</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rtndecl</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">rtnbody</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">rtnprox</span> <span class="o">=</span> <span class="n">rtnname</span>
            <span class="n">rtndecls</span> <span class="o">=</span> <span class="p">[</span><span class="n">rtndecl</span><span class="p">]</span>
            <span class="n">returns_void</span> <span class="o">=</span> <span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;void&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">returns_void</span><span class="p">:</span>
                 <span class="n">rtndecls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;cdef {0} {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">cython_ctype</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]),</span> 
                                                       <span class="n">rtncall</span><span class="p">))</span>
            <span class="n">rtndecl</span> <span class="o">=</span> <span class="n">indent</span><span class="p">(</span><span class="n">rtndecls</span><span class="p">)</span>
            <span class="n">rtnbody</span> <span class="o">=</span> <span class="n">indent</span><span class="p">(</span><span class="n">rtnbody</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;def {{proxy_name}}({arglist}):</span><span class="se">\n</span><span class="s">&#39;</span>
                 <span class="s">&#39;{argdecls}</span><span class="se">\n</span><span class="s">&#39;</span>
                 <span class="s">&#39;{rtndecl}</span><span class="se">\n</span><span class="s">&#39;</span>
                 <span class="s">&#39;    if {{var}} == NULL:</span><span class="se">\n</span><span class="s">&#39;</span>
                 <span class="s">&#39;        raise RuntimeError(&quot;{{var}} is NULL and may not be &#39;</span>
                                             <span class="s">&#39;safely called!&quot;)</span><span class="se">\n</span><span class="s">&#39;</span>
                 <span class="s">&#39;{argbodys}</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s">&#39;    {{var}}({carglist})</span><span class="se">\n</span><span class="s">&#39;</span> <span class="k">if</span> <span class="n">returns_void</span> <span class="k">else</span> \
                 <span class="s">&#39;    {rtncall} = {{var}}({carglist})</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s">&#39;{rtnbody}</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">arglist</span><span class="o">=</span><span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">argnames</span><span class="p">),</span> <span class="n">argdecls</span><span class="o">=</span><span class="n">argdecls</span><span class="p">,</span>
                         <span class="n">cvartypeptr</span><span class="o">=</span><span class="n">ts</span><span class="o">.</span><span class="n">cython_ctype</span><span class="p">(</span><span class="n">t_</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">type_name</span><span class="o">=</span><span class="s">&#39;cvartype&#39;</span><span class="p">),</span>
                         <span class="n">argbodys</span><span class="o">=</span><span class="n">argbodys</span><span class="p">,</span> <span class="n">rtndecl</span><span class="o">=</span><span class="n">rtndecl</span><span class="p">,</span> <span class="n">rtnprox</span><span class="o">=</span><span class="n">rtnprox</span><span class="p">,</span> 
                         <span class="n">rtncall</span><span class="o">=</span><span class="n">rtncall</span><span class="p">,</span> <span class="n">carglist</span><span class="o">=</span><span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">argrtns</span><span class="p">),</span> <span class="n">rtnbody</span><span class="o">=</span><span class="n">rtnbody</span><span class="p">)</span>
            <span class="n">caches</span> <span class="o">=</span> <span class="s">&#39;if {cache_name} is None:</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">indent</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">returns_void</span><span class="p">:</span>
                <span class="n">caches</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">        return {rtnrtn}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rtnrtn</span><span class="o">=</span><span class="n">rtnrtn</span><span class="p">)</span>
                <span class="n">caches</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">    {cache_name} = {proxy_name}</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="k">return</span> <span class="n">s</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">caches</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cython_c2py_conv</span> <span class="o">=</span> <span class="n">_LazyConverterDict</span><span class="p">(</span><span class="n">cython_c2py_conv</span> <span class="k">if</span> \
                                     <span class="n">cython_c2py_conv</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c"># Has tuple form of (copy, [view, [cached_view]])</span>
            <span class="c"># base types</span>
            <span class="s">&#39;char&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;chr(&lt;int&gt; {var})&#39;</span><span class="p">,),</span>
            <span class="p">(</span><span class="s">&#39;char&#39;</span><span class="p">,</span> <span class="s">&#39;*&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s">&#39;bytes({var}).decode()&#39;</span><span class="p">,),</span>
            <span class="s">&#39;uchar&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;chr(&lt;unsigned int&gt; {var})&#39;</span><span class="p">,),</span>
            <span class="p">(</span><span class="s">&#39;uchar&#39;</span><span class="p">,</span> <span class="s">&#39;*&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s">&#39;bytes(&lt;char *&gt; {var}).decode()&#39;</span><span class="p">,),</span>
            <span class="s">&#39;str&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;bytes(&lt;char *&gt; {var}.c_str()).decode()&#39;</span><span class="p">,),</span>
            <span class="p">(</span><span class="s">&#39;str&#39;</span><span class="p">,</span> <span class="s">&#39;*&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s">&#39;bytes(&lt;char *&gt; {var}[0].c_str()).decode()&#39;</span><span class="p">,),</span>
            <span class="s">&#39;int16&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;int({var})&#39;</span><span class="p">,),</span>
            <span class="p">(</span><span class="s">&#39;int16&#39;</span><span class="p">,</span> <span class="s">&#39;*&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s">&#39;int({var}[0])&#39;</span><span class="p">,),</span>
            <span class="s">&#39;int32&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;int({var})&#39;</span><span class="p">,),</span>
            <span class="p">(</span><span class="s">&#39;int32&#39;</span><span class="p">,</span> <span class="s">&#39;*&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s">&#39;int({var}[0])&#39;</span><span class="p">,),</span>
            <span class="s">&#39;int64&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;int({var})&#39;</span><span class="p">,),</span>
            <span class="p">(</span><span class="s">&#39;int64&#39;</span><span class="p">,</span> <span class="s">&#39;*&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s">&#39;int({var}[0])&#39;</span><span class="p">,),</span>
            <span class="s">&#39;uint16&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;int({var})&#39;</span><span class="p">,),</span>
            <span class="p">(</span><span class="s">&#39;uint16&#39;</span><span class="p">,</span> <span class="s">&#39;*&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s">&#39;int({var}[0])&#39;</span><span class="p">,),</span>
            <span class="s">&#39;uint32&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;int({var})&#39;</span><span class="p">,),</span>
            <span class="p">(</span><span class="s">&#39;uint32&#39;</span><span class="p">,</span> <span class="s">&#39;*&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s">&#39;int({var}[0])&#39;</span><span class="p">,),</span>
            <span class="s">&#39;uint64&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;int({var})&#39;</span><span class="p">,),</span>
            <span class="s">&#39;float32&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;float({var})&#39;</span><span class="p">,),</span>
            <span class="p">(</span><span class="s">&#39;float32&#39;</span><span class="p">,</span> <span class="s">&#39;*&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s">&#39;float({var}[0])&#39;</span><span class="p">,),</span>
            <span class="s">&#39;float64&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;float({var})&#39;</span><span class="p">,),</span>
            <span class="p">(</span><span class="s">&#39;float64&#39;</span><span class="p">,</span> <span class="s">&#39;*&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s">&#39;float({var}[0])&#39;</span><span class="p">,),</span>
            <span class="s">&#39;float128&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;np.array({var}, dtype=np.float128)&#39;</span><span class="p">,),</span>
            <span class="p">(</span><span class="s">&#39;float128&#39;</span><span class="p">,</span> <span class="s">&#39;*&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s">&#39;np.array({var}[0], dtype=np.float128)&#39;</span><span class="p">,),</span>
            <span class="s">&#39;complex128&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;complex(float({var}.re), float({var}.im))&#39;</span><span class="p">,),</span>
            <span class="p">(</span><span class="s">&#39;complex128&#39;</span><span class="p">,</span> <span class="s">&#39;*&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s">&#39;complex(float({var}[0].re), float({var}[0].im))&#39;</span><span class="p">,),</span>
            <span class="s">&#39;bool&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;bool({var})&#39;</span><span class="p">,),</span>
            <span class="p">(</span><span class="s">&#39;bool&#39;</span><span class="p">,</span> <span class="s">&#39;*&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s">&#39;bool({var}[0])&#39;</span><span class="p">,),</span>
            <span class="s">&#39;void&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;None&#39;</span><span class="p">,),</span>
            <span class="s">&#39;file&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;{extra_types}PyFile_FromFile(&amp;{var}, &quot;{var}&quot;, &quot;r+&quot;, NULL)&#39;</span><span class="p">,),</span>
            <span class="p">(</span><span class="s">&#39;file&#39;</span><span class="p">,</span> <span class="s">&#39;*&#39;</span><span class="p">):</span> <span class="p">(</span>
                <span class="s">&#39;{extra_types}PyFile_FromFile({var}, &quot;{var}&quot;, &quot;r+&quot;, NULL)&#39;</span><span class="p">,),</span>
            <span class="c"># template types</span>
            <span class="s">&#39;map&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;{t.cython_pytype}({var})&#39;</span><span class="p">,</span>
                   <span class="p">(</span><span class="s">&#39;{proxy_name} = {t.cython_pytype}(False, False)</span><span class="se">\n</span><span class="s">&#39;</span>
                    <span class="s">&#39;{proxy_name}.map_ptr = &amp;{var}</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">),</span>
                   <span class="p">(</span><span class="s">&#39;if {cache_name} is None:</span><span class="se">\n</span><span class="s">&#39;</span>
                    <span class="s">&#39;    {proxy_name} = {t.cython_pytype}(False, False)</span><span class="se">\n</span><span class="s">&#39;</span>
                    <span class="s">&#39;    {proxy_name}.map_ptr = &amp;{var}</span><span class="se">\n</span><span class="s">&#39;</span>
                    <span class="s">&#39;    {cache_name} = {proxy_name}</span><span class="se">\n</span><span class="s">&#39;</span>
                    <span class="p">)),</span>
            <span class="s">&#39;dict&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;dict({var})&#39;</span><span class="p">,),</span>
            <span class="s">&#39;pair&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;{t.cython_pytype}({var})&#39;</span><span class="p">,</span>
                     <span class="p">(</span><span class="s">&#39;{proxy_name} = {t.cython_pytype}(False, False)</span><span class="se">\n</span><span class="s">&#39;</span>
                      <span class="s">&#39;{proxy_name}.pair_ptr = &amp;{var}</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s">&#39;if {cache_name} is None:</span><span class="se">\n</span><span class="s">&#39;</span>
                      <span class="s">&#39;    {proxy_name} = {t.cython_pytype}(False, False)</span><span class="se">\n</span><span class="s">&#39;</span>
                      <span class="s">&#39;    {proxy_name}.pair_ptr = &amp;{var}</span><span class="se">\n</span><span class="s">&#39;</span>
                      <span class="s">&#39;    {cache_name} = {proxy_name}</span><span class="se">\n</span><span class="s">&#39;</span>
                      <span class="p">)),</span>
            <span class="s">&#39;set&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;{t.cython_pytype}({var})&#39;</span><span class="p">,</span>
                   <span class="p">(</span><span class="s">&#39;{proxy_name} = {t.cython_pytype}(False, False)</span><span class="se">\n</span><span class="s">&#39;</span>
                    <span class="s">&#39;{proxy_name}.set_ptr = &amp;{var}</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">),</span>
                   <span class="p">(</span><span class="s">&#39;if {cache_name} is None:</span><span class="se">\n</span><span class="s">&#39;</span>
                    <span class="s">&#39;    {proxy_name} = {t.cython_pytype}(False, False)</span><span class="se">\n</span><span class="s">&#39;</span>
                    <span class="s">&#39;    {proxy_name}.set_ptr = &amp;{var}</span><span class="se">\n</span><span class="s">&#39;</span>
                    <span class="s">&#39;    {cache_name} = {proxy_name}</span><span class="se">\n</span><span class="s">&#39;</span>
                    <span class="p">)),</span>
            <span class="n">TypeMatcher</span><span class="p">((</span><span class="s">&#39;set&#39;</span><span class="p">,</span> <span class="n">MatchAny</span><span class="p">,</span> <span class="s">&#39;*&#39;</span><span class="p">)):</span> <span class="p">(</span><span class="s">&#39;{t.cython_pytype}(deref({var}))&#39;</span><span class="p">,</span>
                   <span class="p">(</span><span class="s">&#39;{proxy_name} = {t.cython_pytype}(False, False)</span><span class="se">\n</span><span class="s">&#39;</span>
                    <span class="s">&#39;{proxy_name}.set_ptr = {var}</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">),</span>
                   <span class="p">(</span><span class="s">&#39;if {cache_name} is None:</span><span class="se">\n</span><span class="s">&#39;</span>
                    <span class="s">&#39;    {proxy_name} = {t.cython_pytype}(False, False)</span><span class="se">\n</span><span class="s">&#39;</span>
                    <span class="s">&#39;    {proxy_name}.set_ptr = {var}</span><span class="se">\n</span><span class="s">&#39;</span>
                    <span class="s">&#39;    {cache_name} = {proxy_name}</span><span class="se">\n</span><span class="s">&#39;</span>
                    <span class="p">)),</span>
            <span class="s">&#39;vector&#39;</span><span class="p">:</span> <span class="p">(</span>
                <span class="p">(</span><span class="s">&#39;{proxy_name}_shape[0] = &lt;np.npy_intp&gt; {var}.size()</span><span class="se">\n</span><span class="s">&#39;</span>
                 <span class="s">&#39;{proxy_name} = np.PyArray_SimpleNewFromData(1, {var}_shape, {t.cython_nptypes[0]}, &amp;{var}[0])</span><span class="se">\n</span><span class="s">&#39;</span>
                 <span class="s">&#39;{proxy_name} = np.PyArray_Copy({proxy_name})</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s">&#39;{proxy_name}_shape[0] = &lt;np.npy_intp&gt; {var}.size()</span><span class="se">\n</span><span class="s">&#39;</span>
                 <span class="s">&#39;{proxy_name} = np.PyArray_SimpleNewFromData(1, {proxy_name}_shape, {t.cython_nptypes[0]}, &amp;{var}[0])</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s">&#39;if {cache_name} is None:</span><span class="se">\n</span><span class="s">&#39;</span>
                 <span class="s">&#39;    {proxy_name}_shape[0] = &lt;np.npy_intp&gt; {var}.size()</span><span class="se">\n</span><span class="s">&#39;</span>
                 <span class="s">&#39;    {proxy_name} = np.PyArray_SimpleNewFromData(1, {proxy_name}_shape, {t.cython_nptypes[0]}, &amp;{var}[0])</span><span class="se">\n</span><span class="s">&#39;</span>
                 <span class="s">&#39;    {cache_name} = {proxy_name}</span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="p">)),</span>
            <span class="p">(</span><span class="s">&#39;vector&#39;</span><span class="p">,</span> <span class="s">&#39;bool&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="p">(</span>  <span class="c"># C++ standard is silly here</span>
                <span class="p">(</span><span class="s">&#39;cdef int i</span><span class="se">\n</span><span class="s">&#39;</span>
                 <span class="s">&#39;{proxy_name}_shape[0] = &lt;np.npy_intp&gt; {var}.size()</span><span class="se">\n</span><span class="s">&#39;</span>
                 <span class="s">&#39;{proxy_name} = np.PyArray_SimpleNew(1, {proxy_name}_shape, {t.cython_nptypes[0]})</span><span class="se">\n</span><span class="s">&#39;</span>
                 <span class="s">&#39;for i in range({proxy_name}_shape[0]):</span><span class="se">\n</span><span class="s">&#39;</span>
                 <span class="s">&#39;    {proxy_name}[i] = {var}[i]</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s">&#39;cdef int i</span><span class="se">\n</span><span class="s">&#39;</span>
                 <span class="s">&#39;{proxy_name}_shape[0] = &lt;np.npy_intp&gt; {var}.size()</span><span class="se">\n</span><span class="s">&#39;</span>
                 <span class="s">&#39;{proxy_name} = np.PyArray_SimpleNew(1, {proxy_name}_shape, {t.cython_nptypes[0]})</span><span class="se">\n</span><span class="s">&#39;</span>
                 <span class="s">&#39;for i in range({proxy_name}_shape[0]):</span><span class="se">\n</span><span class="s">&#39;</span>
                 <span class="s">&#39;    {proxy_name}[i] = {var}[i]</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s">&#39;cdef int i</span><span class="se">\n</span><span class="s">&#39;</span>
                 <span class="s">&#39;if {cache_name} is None:</span><span class="se">\n</span><span class="s">&#39;</span>
                 <span class="s">&#39;    {proxy_name}_shape[0] = &lt;np.npy_intp&gt; {var}.size()</span><span class="se">\n</span><span class="s">&#39;</span>
                 <span class="s">&#39;    {proxy_name} = np.PyArray_SimpleNew(1, {proxy_name}_shape, {nptype[0]})</span><span class="se">\n</span><span class="s">&#39;</span>
                 <span class="s">&#39;    for i in range({proxy_name}_shape[0]):</span><span class="se">\n</span><span class="s">&#39;</span>
                 <span class="s">&#39;        {proxy_name}[i] = {var}[i]</span><span class="se">\n</span><span class="s">&#39;</span>
                 <span class="s">&#39;    {cache_name} = {proxy_name}</span><span class="se">\n</span><span class="s">&#39;</span>
                 <span class="p">)),</span>
            <span class="c"># C/C++ chars are ints while Python Chars are length-1 strings</span>
            <span class="p">(</span><span class="s">&#39;vector&#39;</span><span class="p">,</span> <span class="s">&#39;char&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="p">(</span>
                <span class="p">(</span><span class="s">&#39;cdef int i</span><span class="se">\n</span><span class="s">&#39;</span>
                 <span class="s">&#39;{proxy_name}_shape[0] = &lt;np.npy_intp&gt; {var}.size()</span><span class="se">\n</span><span class="s">&#39;</span>
                 <span class="s">&#39;{proxy_name} = np.empty({proxy_name}_shape[0], &quot;U1&quot;)</span><span class="se">\n</span><span class="s">&#39;</span>
                 <span class="s">&#39;for i in range({proxy_name}_shape[0]):</span><span class="se">\n</span><span class="s">&#39;</span>
                 <span class="s">&#39;    {proxy_name}[i] = chr(&lt;int&gt; {var}[i])</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s">&#39;cdef int i</span><span class="se">\n</span><span class="s">&#39;</span>
                 <span class="s">&#39;{proxy_name}_shape[0] = &lt;np.npy_intp&gt; {var}.size()</span><span class="se">\n</span><span class="s">&#39;</span>
                 <span class="s">&#39;{proxy_name} = np.empty({proxy_name}_shape[0], &quot;U1&quot;)</span><span class="se">\n</span><span class="s">&#39;</span>
                 <span class="s">&#39;for i in range({proxy_name}_shape[0]):</span><span class="se">\n</span><span class="s">&#39;</span>
                 <span class="s">&#39;    {proxy_name}[i] = chr(&lt;int&gt; {var}[i])</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s">&#39;cdef int i</span><span class="se">\n</span><span class="s">&#39;</span>
                 <span class="s">&#39;if {cache_name} is None:</span><span class="se">\n</span><span class="s">&#39;</span>
                 <span class="s">&#39;    {proxy_name}_shape[0] = &lt;np.npy_intp&gt; {var}.size()</span><span class="se">\n</span><span class="s">&#39;</span>
                 <span class="s">&#39;    for i in range({proxy_name}_shape[0]):</span><span class="se">\n</span><span class="s">&#39;</span>
                 <span class="s">&#39;        {proxy_name}[i] = chr(&lt;int&gt; {var}[i])</span><span class="se">\n</span><span class="s">&#39;</span>
                 <span class="s">&#39;    {cache_name} = {proxy_name}</span><span class="se">\n</span><span class="s">&#39;</span>
                 <span class="p">)),</span>
            <span class="s">&#39;nucid&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;nucname.zzaaam({var})&#39;</span><span class="p">,),</span>
            <span class="s">&#39;nucname&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;nucname.name({var})&#39;</span><span class="p">,),</span>
            <span class="n">TypeMatcher</span><span class="p">(((</span><span class="s">&#39;enum&#39;</span><span class="p">,</span> <span class="n">MatchAny</span><span class="p">,</span> <span class="n">MatchAny</span><span class="p">),</span> <span class="s">&#39;*&#39;</span><span class="p">)):</span> <span class="p">(</span><span class="s">&#39;int({var}[0])&#39;</span><span class="p">,),</span>
            <span class="n">TypeMatcher</span><span class="p">(((</span><span class="s">&#39;int32&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;enum&#39;</span><span class="p">,</span> <span class="n">MatchAny</span><span class="p">,</span> <span class="n">MatchAny</span><span class="p">)),</span> <span class="s">&#39;*&#39;</span><span class="p">)):</span> \
                                                                <span class="p">(</span><span class="s">&#39;int({var}[0])&#39;</span><span class="p">,),</span>
            <span class="c"># Strip const when going c -&gt; py </span>
            <span class="n">TypeMatcher</span><span class="p">((</span><span class="n">MatchAny</span><span class="p">,</span> <span class="s">&#39;const&#39;</span><span class="p">)):</span> <span class="p">(</span>
                <span class="k">lambda</span> <span class="n">t</span><span class="p">,</span> <span class="n">ts</span><span class="p">:</span> <span class="n">ts</span><span class="o">.</span><span class="n">cython_c2py_getitem</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span>
            <span class="n">TypeMatcher</span><span class="p">(((</span><span class="n">MatchAny</span><span class="p">,</span> <span class="s">&#39;const&#39;</span><span class="p">),</span> <span class="s">&#39;&amp;&#39;</span><span class="p">))</span> <span class="p">:</span> <span class="p">(</span>
                <span class="k">lambda</span> <span class="n">t</span><span class="p">,</span> <span class="n">ts</span><span class="p">:</span> <span class="n">ts</span><span class="o">.</span><span class="n">cython_c2py_getitem</span><span class="p">((</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="s">&#39;&amp;&#39;</span><span class="p">))),</span>
            <span class="n">TypeMatcher</span><span class="p">(((</span><span class="n">MatchAny</span><span class="p">,</span> <span class="s">&#39;const&#39;</span><span class="p">),</span> <span class="s">&#39;*&#39;</span><span class="p">)):</span> <span class="p">(</span>
                <span class="k">lambda</span> <span class="n">t</span><span class="p">,</span> <span class="n">ts</span><span class="p">:</span> <span class="n">ts</span><span class="o">.</span><span class="n">cython_c2py_getitem</span><span class="p">((</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="s">&#39;*&#39;</span><span class="p">))),</span>
            <span class="s">&#39;function_pointer&#39;</span><span class="p">:</span> <span class="n">cython_c2py_conv_function_pointer</span><span class="p">,</span>
            <span class="p">},</span> <span class="bp">self</span><span class="p">)</span>

        <span class="n">cython_py2c_conv_vector_ref</span> <span class="o">=</span> <span class="p">((</span>
            <span class="s">&#39;# {var} is a {t.type}</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="s">&#39;cdef int i{var}</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="s">&#39;cdef int {var}_size</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="s">&#39;cdef {t.cython_npctypes_nopred[0]} * {var}_data</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="s">&#39;{var}_size = len({var})</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="s">&#39;if isinstance({var}, np.ndarray) and (&lt;np.ndarray&gt; {var}).descr.type_num == {t.cython_nptype}:</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="s">&#39;    {var}_data = &lt;{t.cython_npctypes_nopred[0]} *&gt; np.PyArray_DATA(&lt;np.ndarray&gt; {var})</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="s">&#39;    {proxy_name} = {t.cython_ctype_nopred}(&lt;size_t&gt; {var}_size)</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="s">&#39;    for i{var} in range({var}_size):</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="s">&#39;        {proxy_name}[i{var}] = {var}_data[i{var}]</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="s">&#39;else:</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="s">&#39;    {proxy_name} = {t.cython_ctype_nopred}(&lt;size_t&gt; {var}_size)</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="s">&#39;    for i{var} in range({var}_size):</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="s">&#39;        {proxy_name}[i{var}] = &lt;{t.cython_npctypes_nopred[0]}&gt; {var}[i{var}]</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">),</span>
            <span class="s">&#39;{proxy_name}&#39;</span><span class="p">)</span>     <span class="c"># FIXME There might be improvements here...</span>

        <span class="k">def</span> <span class="nf">cython_py2c_conv_function_pointer</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">ts</span><span class="p">):</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">argnames</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">argcts</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">argdecls</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">argbodys</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">argrtns</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">argt</span> <span class="ow">in</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]:</span>
                <span class="n">argnames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                <span class="n">decl</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">rtn</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">cython_c2py</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">argt</span><span class="p">,</span> <span class="n">proxy_name</span><span class="o">=</span><span class="s">&quot;c_&quot;</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> 
                                                    <span class="n">cached</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                <span class="n">argdecls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">decl</span><span class="p">)</span>
                <span class="c">#argdecls.append(&quot;cdef {0} {1}&quot;.format(cython_pytype(argt), &quot;c_&quot; + n))</span>
                <span class="n">argbodys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
                <span class="n">argrtns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rtn</span><span class="p">)</span>
                <span class="n">argct</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">cython_ctype</span><span class="p">(</span><span class="n">argt</span><span class="p">)</span>
                <span class="n">argcts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">argct</span><span class="p">)</span>
            <span class="n">rtnname</span> <span class="o">=</span> <span class="s">&#39;rtn&#39;</span>
            <span class="n">rtnprox</span> <span class="o">=</span> <span class="s">&#39;c_&#39;</span> <span class="o">+</span> <span class="n">rtnname</span>
            <span class="n">rtncall</span> <span class="o">=</span> <span class="s">&#39;call_&#39;</span> <span class="o">+</span> <span class="n">rtnname</span>
            <span class="k">while</span> <span class="n">rtnname</span> <span class="ow">in</span> <span class="n">argnames</span> <span class="ow">or</span> <span class="n">rtnprox</span> <span class="ow">in</span> <span class="n">argnames</span><span class="p">:</span>
                <span class="n">rtnname</span> <span class="o">+=</span> <span class="s">&#39;_&#39;</span>
                <span class="n">rtnprox</span> <span class="o">+=</span> <span class="s">&#39;_&#39;</span>
            <span class="n">rtnct</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">cython_ctype</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">argdecls</span> <span class="o">=</span> <span class="n">indent</span><span class="p">(</span><span class="n">argdecls</span><span class="p">)</span>
            <span class="n">argbodys</span> <span class="o">=</span> <span class="n">indent</span><span class="p">(</span><span class="n">argbodys</span><span class="p">)</span>
            <span class="c">#rtndecl, rtnbody, rtnrtn = cython_py2c(rtnname, t[2][2], proxy_name=rtnprox)</span>
            <span class="c">#rtndecl, rtnbody, rtnrtn = cython_py2c(rtnname, t[2][2], proxy_name=rtncall)</span>
            <span class="n">rtndecl</span><span class="p">,</span> <span class="n">rtnbody</span><span class="p">,</span> <span class="n">rtnrtn</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">cython_py2c</span><span class="p">(</span><span class="n">rtncall</span><span class="p">,</span> <span class="n">t</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> 
                                                      <span class="n">proxy_name</span><span class="o">=</span><span class="n">rtnprox</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rtndecl</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">rtnbody</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">rtnprox</span> <span class="o">=</span> <span class="n">rtnname</span>
            <span class="n">rtndecl</span> <span class="o">=</span> <span class="n">indent</span><span class="p">([</span><span class="n">rtndecl</span><span class="p">])</span>
            <span class="n">rtnbody</span> <span class="o">=</span> <span class="n">indent</span><span class="p">([</span><span class="n">rtnbody</span><span class="p">])</span>
            <span class="n">returns_void</span> <span class="o">=</span> <span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;void&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">returns_void</span><span class="p">:</span>
                <span class="n">rtnrtn</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;cdef {rtnct} {{proxy_name}}({arglist}):</span><span class="se">\n</span><span class="s">&#39;</span>
                 <span class="s">&#39;{argdecls}</span><span class="se">\n</span><span class="s">&#39;</span>
                 <span class="s">&#39;{rtndecl}</span><span class="se">\n</span><span class="s">&#39;</span>
                 <span class="s">&#39;    global {{var}}</span><span class="se">\n</span><span class="s">&#39;</span>
                 <span class="s">&#39;{argbodys}</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s">&#39;    {{var}}({pyarglist})</span><span class="se">\n</span><span class="s">&#39;</span> <span class="k">if</span> <span class="n">returns_void</span> <span class="k">else</span> \
                 <span class="s">&#39;    {rtncall} = {{var}}({pyarglist})</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="p">(</span><span class="s">&#39;{rtnbody}</span><span class="se">\n</span><span class="s">&#39;</span>
                  <span class="s">&#39;    return {rtnrtn}</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">arglist</span> <span class="o">=</span> <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&quot;{0} {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">argcts</span><span class="p">,</span> <span class="n">argnames</span><span class="p">)])</span>
            <span class="n">pyarglist</span><span class="o">=</span><span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">argrtns</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rtnct</span><span class="o">=</span><span class="n">rtnct</span><span class="p">,</span> <span class="n">arglist</span><span class="o">=</span><span class="n">arglist</span><span class="p">,</span> <span class="n">argdecls</span><span class="o">=</span><span class="n">argdecls</span><span class="p">,</span> 
                         <span class="n">rtndecl</span><span class="o">=</span><span class="n">rtndecl</span><span class="p">,</span> <span class="n">argbodys</span><span class="o">=</span><span class="n">argbodys</span><span class="p">,</span> <span class="n">rtnprox</span><span class="o">=</span><span class="n">rtnprox</span><span class="p">,</span> 
                         <span class="n">pyarglist</span><span class="o">=</span><span class="n">pyarglist</span><span class="p">,</span> <span class="n">rtnbody</span><span class="o">=</span><span class="n">rtnbody</span><span class="p">,</span> <span class="n">rtnrtn</span><span class="o">=</span><span class="n">rtnrtn</span><span class="p">,</span> 
                         <span class="n">rtncall</span><span class="o">=</span><span class="n">rtncall</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">s</span><span class="p">,</span> <span class="bp">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cython_py2c_conv</span> <span class="o">=</span> <span class="n">_LazyConverterDict</span><span class="p">(</span><span class="n">cython_py2c_conv</span> <span class="k">if</span> \
                                    <span class="n">cython_py2c_conv</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c"># Has tuple form of (body or return,  return or False)</span>
            <span class="c"># base types</span>
            <span class="s">&#39;char&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;{var}_bytes = {var}.encode()&#39;</span><span class="p">,</span> <span class="s">&#39;(&lt;char *&gt; {var}_bytes)[0]&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;char&#39;</span><span class="p">,</span> <span class="s">&#39;*&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s">&#39;{var}_bytes = {var}.encode()&#39;</span><span class="p">,</span> <span class="s">&#39;&lt;char *&gt; {var}_bytes&#39;</span><span class="p">),</span>
            <span class="p">((</span><span class="s">&#39;char&#39;</span><span class="p">,</span> <span class="s">&#39;*&#39;</span><span class="p">),</span> <span class="s">&#39;*&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s">&#39;cdef char * {var}_bytes_</span><span class="se">\n</span><span class="s">&#39;</span>
                                   <span class="s">&#39;{var}_bytes = {var}[0].encode()</span><span class="se">\n</span><span class="s">&#39;</span>
                                   <span class="s">&#39;{var}_bytes_ = {var}_bytes</span><span class="se">\n</span><span class="s">&#39;</span>
                                   <span class="s">&#39;{proxy_name} = &amp;{var}_bytes_&#39;</span><span class="p">,</span> 
                                   <span class="s">&#39;{proxy_name}&#39;</span><span class="p">),</span>
            <span class="s">&#39;uchar&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;{var}_bytes = {var}.encode()&#39;</span><span class="p">,</span> <span class="s">&#39;(&lt;unsigned char *&gt; {var}_bytes)[0]&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;uchar&#39;</span><span class="p">,</span> <span class="s">&#39;*&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s">&#39;{var}_bytes = {var}.encode()&#39;</span><span class="p">,</span> <span class="s">&#39;&lt;unsigned char *&gt; {var}_bytes&#39;</span><span class="p">),</span>
            <span class="s">&#39;str&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;{var}_bytes = {var}.encode()&#39;</span><span class="p">,</span> <span class="s">&#39;std_string(&lt;char *&gt; {var}_bytes)&#39;</span><span class="p">),</span>
            <span class="s">&#39;int16&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;&lt;short&gt; {var}&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>
            <span class="s">&#39;int32&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;&lt;int&gt; {var}&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>
            <span class="c">#(&#39;int32&#39;, &#39;*&#39;): (&#39;&amp;(&lt;int&gt; {var})&#39;, False),</span>
            <span class="p">(</span><span class="s">&#39;int32&#39;</span><span class="p">,</span> <span class="s">&#39;*&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s">&#39;cdef int {proxy_name}_ = {var}&#39;</span><span class="p">,</span> <span class="s">&#39;&amp;{proxy_name}_&#39;</span><span class="p">),</span>
            <span class="s">&#39;int64&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;&lt;long long&gt; {var}&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>
            <span class="s">&#39;uint16&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;&lt;unsigned short&gt; {var}&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>
            <span class="s">&#39;uint32&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;&lt;{t.cython_ctype}&gt; long({var})&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>
            <span class="c">#&#39;uint32&#39;: (&#39;&lt;unsigned long&gt; {var}&#39;, False),</span>
            <span class="c">#(&#39;uint32&#39;, &#39;*&#39;): (&#39;cdef unsigned long {proxy_name}_ = {var}&#39;, &#39;&amp;{proxy_name}_&#39;),</span>
            <span class="p">(</span><span class="s">&#39;uint32&#39;</span><span class="p">,</span> <span class="s">&#39;*&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s">&#39;cdef unsigned int {proxy_name}_ = {var}&#39;</span><span class="p">,</span> <span class="s">&#39;&amp;{proxy_name}_&#39;</span><span class="p">),</span>
            <span class="s">&#39;uint64&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;&lt;unsigned long long&gt; {var}&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>
            <span class="s">&#39;float32&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;&lt;float&gt; {var}&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>
            <span class="s">&#39;float64&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;&lt;double&gt; {var}&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;float64&#39;</span><span class="p">,</span> <span class="s">&#39;*&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s">&#39;cdef double {proxy_name}_ = {var}&#39;</span><span class="p">,</span> <span class="s">&#39;&amp;{proxy_name}_&#39;</span><span class="p">),</span>
            <span class="s">&#39;float128&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;&lt;long double&gt; {var}&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>
            <span class="s">&#39;complex128&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;{extra_types}py2c_complex({var})&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>
            <span class="s">&#39;bool&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;&lt;bint&gt; {var}&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>
            <span class="s">&#39;void&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;NULL&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;void&#39;</span><span class="p">,</span> <span class="s">&#39;*&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s">&#39;NULL&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>
            <span class="s">&#39;file&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;{extra_types}PyFile_AsFile({var})[0]&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;file&#39;</span><span class="p">,</span> <span class="s">&#39;*&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s">&#39;{extra_types}PyFile_AsFile({var})&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>
            <span class="c"># template types</span>
            <span class="s">&#39;map&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;{proxy_name} = {t.cython_pytype}({var}, not isinstance({var}, {t.cython_cytype}))&#39;</span><span class="p">,</span>
                    <span class="s">&#39;{proxy_name}.map_ptr[0]&#39;</span><span class="p">),</span>
            <span class="s">&#39;dict&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;dict({var})&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>
            <span class="s">&#39;pair&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;{proxy_name} = {t.cython_pytype}({var}, not isinstance({var}, {t.cython_cytype}))&#39;</span><span class="p">,</span>
                     <span class="s">&#39;{proxy_name}.pair_ptr[0]&#39;</span><span class="p">),</span>
            <span class="s">&#39;set&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;{proxy_name} = {t.cython_pytype}({var}, not isinstance({var}, {t.cython_cytype}))&#39;</span><span class="p">,</span>
                    <span class="s">&#39;{proxy_name}.set_ptr[0]&#39;</span><span class="p">),</span>
            <span class="s">&#39;vector&#39;</span><span class="p">:</span> <span class="p">((</span>
                <span class="s">&#39;# {var} is a {t.type}</span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="s">&#39;cdef int i{var}</span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="s">&#39;cdef int {var}_size</span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="s">&#39;cdef {t.cython_npctypes[0]} * {var}_data</span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="s">&#39;{var}_size = len({var})</span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="s">&#39;if isinstance({var}, np.ndarray) and (&lt;np.ndarray&gt; {var}).descr.type_num == {t.cython_nptype}:</span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="s">&#39;    {var}_data = &lt;{t.cython_npctypes[0]} *&gt; np.PyArray_DATA(&lt;np.ndarray&gt; {var})</span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="s">&#39;    {proxy_name} = {t.cython_ctype}(&lt;size_t&gt; {var}_size)</span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="s">&#39;    for i{var} in range({var}_size):</span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="s">&#39;        {proxy_name}[i{var}] = {var}_data[i{var}]</span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="s">&#39;else:</span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="s">&#39;    {proxy_name} = {t.cython_ctype}(&lt;size_t&gt; {var}_size)</span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="s">&#39;    for i{var} in range({var}_size):</span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="s">&#39;        {proxy_name}[i{var}] = &lt;{t.cython_npctypes[0]}&gt; {var}[i{var}]</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">),</span>
                <span class="s">&#39;{proxy_name}&#39;</span><span class="p">),</span>     <span class="c"># FIXME There might be improvements here...</span>
            <span class="p">(</span><span class="s">&#39;vector&#39;</span><span class="p">,</span> <span class="s">&#39;char&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="p">((</span>
                <span class="s">&#39;# {var} is a {t.type}</span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="s">&#39;cdef int i{var}</span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="s">&#39;cdef int {var}_size</span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="s">&#39;cdef {t.cython_npctypes[0]} * {var}_data</span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="s">&#39;{var}_size = len({var})</span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="s">&#39;if isinstance({var}, np.ndarray) and (&lt;np.ndarray&gt; {var}).descr.type_num == &lt;int&gt; {t.cython_nptype}:</span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="s">&#39;    {var}_data = &lt;{t.cython_npctypes[0]} *&gt; np.PyArray_DATA(&lt;np.ndarray&gt; {var})</span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="s">&#39;    {proxy_name} = {t.cython_ctype}(&lt;size_t&gt; {var}_size)</span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="s">&#39;    for i{var} in range({var}_size):</span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="s">&#39;        {proxy_name}[i{var}] = {var}[i{var}]</span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="s">&#39;else:</span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="s">&#39;    {proxy_name} = {t.cython_ctype}(&lt;size_t&gt; {var}_size)</span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="s">&#39;    for i{var} in range({var}_size):</span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="s">&#39;        _ = {var}[i{var}].encode()</span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="s">&#39;        {proxy_name}[i{var}] = deref(&lt;char *&gt; _)</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">),</span>
                <span class="s">&#39;{proxy_name}&#39;</span><span class="p">),</span>
            <span class="n">TypeMatcher</span><span class="p">((</span><span class="s">&#39;vector&#39;</span><span class="p">,</span> <span class="n">MatchAny</span><span class="p">,</span> <span class="s">&#39;&amp;&#39;</span><span class="p">)):</span> <span class="n">cython_py2c_conv_vector_ref</span><span class="p">,</span>
            <span class="n">TypeMatcher</span><span class="p">(((</span><span class="s">&#39;vector&#39;</span><span class="p">,</span> <span class="n">MatchAny</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="s">&#39;&amp;&#39;</span><span class="p">)):</span> <span class="n">cython_py2c_conv_vector_ref</span><span class="p">,</span>
            <span class="n">TypeMatcher</span><span class="p">(((</span><span class="s">&#39;vector&#39;</span><span class="p">,</span> <span class="n">MatchAny</span><span class="p">,</span> <span class="s">&#39;&amp;&#39;</span><span class="p">),</span> <span class="mi">0</span><span class="p">)):</span> <span class="n">cython_py2c_conv_vector_ref</span><span class="p">,</span>
            <span class="n">TypeMatcher</span><span class="p">(((</span><span class="s">&#39;vector&#39;</span><span class="p">,</span> <span class="n">MatchAny</span><span class="p">,</span> <span class="s">&#39;&amp;&#39;</span><span class="p">),</span> <span class="s">&#39;const&#39;</span><span class="p">)):</span> <span class="n">cython_py2c_conv_vector_ref</span><span class="p">,</span>
            <span class="n">TypeMatcher</span><span class="p">(((</span><span class="s">&#39;vector&#39;</span><span class="p">,</span> <span class="n">MatchAny</span><span class="p">,</span> <span class="s">&#39;const&#39;</span><span class="p">),</span> <span class="s">&#39;&amp;&#39;</span><span class="p">)):</span> <span class="n">cython_py2c_conv_vector_ref</span><span class="p">,</span>
            <span class="n">TypeMatcher</span><span class="p">((((</span><span class="s">&#39;vector&#39;</span><span class="p">,</span> <span class="n">MatchAny</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="s">&#39;const&#39;</span><span class="p">),</span> <span class="s">&#39;&amp;&#39;</span><span class="p">)):</span> <span class="n">cython_py2c_conv_vector_ref</span><span class="p">,</span>
            <span class="n">TypeMatcher</span><span class="p">((((</span><span class="s">&#39;vector&#39;</span><span class="p">,</span> <span class="n">MatchAny</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="s">&#39;&amp;&#39;</span><span class="p">),</span> <span class="s">&#39;const&#39;</span><span class="p">)):</span> <span class="n">cython_py2c_conv_vector_ref</span><span class="p">,</span>
            <span class="c"># refinement types</span>
            <span class="s">&#39;nucid&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;nucname.zzaaam({var})&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>
            <span class="s">&#39;nucname&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;nucname.name({var})&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>
            <span class="n">TypeMatcher</span><span class="p">(((</span><span class="s">&#39;enum&#39;</span><span class="p">,</span> <span class="n">MatchAny</span><span class="p">,</span> <span class="n">MatchAny</span><span class="p">),</span> <span class="s">&#39;*&#39;</span><span class="p">)):</span> \
                <span class="p">(</span><span class="s">&#39;cdef int {proxy_name}_ = {var}&#39;</span><span class="p">,</span> <span class="s">&#39;&amp;{proxy_name}_&#39;</span><span class="p">),</span>
            <span class="n">TypeMatcher</span><span class="p">(((</span><span class="s">&#39;int32&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;enum&#39;</span><span class="p">,</span> <span class="n">MatchAny</span><span class="p">,</span> <span class="n">MatchAny</span><span class="p">)),</span> <span class="s">&#39;*&#39;</span><span class="p">)):</span> \
                <span class="p">(</span><span class="s">&#39;cdef int {proxy_name}_ = {var}&#39;</span><span class="p">,</span> <span class="s">&#39;&amp;{proxy_name}_&#39;</span><span class="p">),</span>
            <span class="s">&#39;function_pointer&#39;</span><span class="p">:</span> <span class="n">cython_py2c_conv_function_pointer</span><span class="p">,</span>
            <span class="p">},</span> <span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">typestr</span> <span class="o">=</span> <span class="n">typestring</span> <span class="ow">or</span> <span class="n">typestr</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="TypeSystem.empty"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.TypeSystem.empty">[docs]</a>    <span class="k">def</span> <span class="nf">empty</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This is a class method which returns an empty type system.&quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">cls</span><span class="p">(</span><span class="n">base_types</span><span class="o">=</span><span class="nb">set</span><span class="p">(),</span> <span class="n">template_types</span><span class="o">=</span><span class="p">{},</span> <span class="n">refined_types</span><span class="o">=</span><span class="p">{},</span> <span class="n">humannames</span><span class="o">=</span><span class="p">{},</span> 
                <span class="n">type_aliases</span><span class="o">=</span><span class="p">{},</span> <span class="n">cpp_types</span><span class="o">=</span><span class="p">{},</span> <span class="n">numpy_types</span><span class="o">=</span><span class="p">{},</span> <span class="n">from_pytypes</span><span class="o">=</span><span class="p">{},</span> 
                <span class="n">cython_ctypes</span><span class="o">=</span><span class="p">{},</span> <span class="n">cython_cytypes</span><span class="o">=</span><span class="p">{},</span> <span class="n">cython_pytypes</span><span class="o">=</span><span class="p">{},</span> 
                <span class="n">cython_cimports</span><span class="o">=</span><span class="p">{},</span> <span class="n">cython_cyimports</span><span class="o">=</span><span class="p">{},</span> <span class="n">cython_pyimports</span><span class="o">=</span><span class="p">{},</span> 
                <span class="n">cython_functionnames</span><span class="o">=</span><span class="p">{},</span> <span class="n">cython_classnames</span><span class="o">=</span><span class="p">{},</span> <span class="n">cython_c2py_conv</span><span class="o">=</span><span class="p">{},</span> 
                <span class="n">cython_py2c_conv</span><span class="o">=</span><span class="p">{})</span>
        <span class="k">del</span> <span class="n">x</span><span class="o">.</span><span class="n">extra_types</span>
        <span class="k">del</span> <span class="n">x</span><span class="o">.</span><span class="n">dtypes</span>
        <span class="k">del</span> <span class="n">x</span><span class="o">.</span><span class="n">stlcontainers</span>
        <span class="k">return</span> <span class="n">x</span>
</div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="TypeSystem.load"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.TypeSystem.load">[docs]</a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;rb&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Loads a type system from disk into a new type system instance.</span>
<span class="sd">        This is a class method.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str</span>
<span class="sd">            Path to file.</span>
<span class="sd">        format : str, optional</span>
<span class="sd">            The file format to save the type system as.  If this is not provided, </span>
<span class="sd">            it is infered from the filenme.  Options are:</span>

<span class="sd">            * pickle (&#39;.pkl&#39;)</span>
<span class="sd">            * gzipped pickle (&#39;.pkl.gz&#39;)</span>

<span class="sd">        mode : str, optional</span>
<span class="sd">            The mode to open the file with.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">format</span> <span class="o">=</span> <span class="n">infer_format</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">format</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;{0!r} not found.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">format</span> <span class="o">==</span> <span class="s">&#39;pkl.gz&#39;</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">format</span> <span class="o">==</span> <span class="s">&#39;pkl&#39;</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">cls</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span>
</div>
<div class="viewcode-block" id="TypeSystem.dump"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.TypeSystem.dump">[docs]</a>    <span class="k">def</span> <span class="nf">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;wb&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Saves a type system out to disk.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str</span>
<span class="sd">            Path to file.</span>
<span class="sd">        format : str, optional</span>
<span class="sd">            The file format to save the type system as.  If this is not provided, </span>
<span class="sd">            it is infered from the filenme.  Options are:</span>

<span class="sd">            * pickle (&#39;.pkl&#39;)</span>
<span class="sd">            * gzipped pickle (&#39;.pkl.gz&#39;)</span>

<span class="sd">        mode : str, optional</span>
<span class="sd">            The mode to open the file with.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">k</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datafields</span><span class="p">])</span>
        <span class="n">format</span> <span class="o">=</span> <span class="n">infer_format</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">format</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">format</span> <span class="o">==</span> <span class="s">&#39;pkl.gz&#39;</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pickle</span><span class="o">.</span><span class="n">HIGHEST_PROTOCOL</span><span class="p">))</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">format</span> <span class="o">==</span> <span class="s">&#39;pkl&#39;</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pickle</span><span class="o">.</span><span class="n">HIGHEST_PROTOCOL</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TypeSystem.update"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.TypeSystem.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Updates the type system in-place. Only updates the data attributes </span>
<span class="sd">        named in &#39;datafields&#39;.  This may be called with any of the following </span>
<span class="sd">        signatures::</span>

<span class="sd">            ts.update(&lt;TypeSystem&gt;)</span>
<span class="sd">            ts.update(&lt;dict-like&gt;)</span>
<span class="sd">            ts.update(key1=value1, key2=value2, ...)</span>

<span class="sd">        Valid keyword arguments are the same here as for the type system </span>
<span class="sd">        constructor.  See this documentation for more detail.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">datafields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datafields</span>
        <span class="c"># normalize arguments</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">toup</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">toup</span><span class="p">,</span> <span class="n">TypeSystem</span><span class="p">):</span>
                <span class="n">toup</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">k</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">toup</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">datafields</span> \
                              <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">toup</span><span class="p">,</span> <span class="n">k</span><span class="p">)])</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">toup</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">):</span>
                <span class="n">toup</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">toup</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">toup</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;invalid siganture: args={0!r}, kwargs={1!0}&quot;</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">fomat</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">))</span>
        <span class="c"># verify keys</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">toup</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">datafields</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;{0} is not a member of {1}&quot;</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">))</span>
        <span class="c"># perform the update</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">toup</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">):</span>
                <span class="n">x</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">Set</span><span class="p">):</span>
                <span class="n">x</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">pformat</span><span class="p">(</span><span class="nb">dict</span><span class="p">([(</span><span class="n">k</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> \
                                                      <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datafields</span><span class="p">)]))</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span> <span class="o">+</span> <span class="s">&quot;(&quot;</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&quot;{0}={1!r}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span> \
                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datafields</span><span class="p">)])</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s">&quot;)&quot;</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="c">#################### Important Methods below ###############################</span>

    <span class="nd">@memoize_method</span>
<div class="viewcode-block" id="TypeSystem.istemplate"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.TypeSystem.istemplate">[docs]</a>    <span class="k">def</span> <span class="nf">istemplate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns whether t is a template type or not.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">template_types</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">istemplate</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">False</span>
</div>
    <span class="nd">@memoize_method</span>
    <span class="k">def</span> <span class="nf">isenum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canon</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">)</span> <span class="ow">and</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;int32&#39;</span> <span class="ow">and</span> \
           <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">)</span> <span class="ow">and</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;enum&#39;</span>

    <span class="nd">@memoize_method</span>
    <span class="k">def</span> <span class="nf">isfunctionpointer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canon</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">)</span> <span class="ow">and</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="s">&#39;void&#39;</span><span class="p">,</span> <span class="s">&#39;*&#39;</span><span class="p">)</span> <span class="ow">and</span> \
               <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">)</span> <span class="ow">and</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;function_pointer&#39;</span>

    <span class="nd">@memoize_method</span>
<div class="viewcode-block" id="TypeSystem.humanname"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.TypeSystem.humanname">[docs]</a>    <span class="k">def</span> <span class="nf">humanname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">hnt</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Computes human names for types.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">hnt</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canon</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">humannames</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_types</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">humannames</span><span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">humanname</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">humannames</span><span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">template_types</span><span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
                <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">humannames</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">x</span>
            <span class="k">elif</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_types</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">humannames</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">val</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">humanname</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">humannames</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">return</span> <span class="n">t</span><span class="p">,</span> <span class="n">hnt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">d</span><span class="p">)</span>
</div>
    <span class="nd">@memoize_method</span>
<div class="viewcode-block" id="TypeSystem.isdependent"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.TypeSystem.isdependent">[docs]</a>    <span class="k">def</span> <span class="nf">isdependent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns whether t is a dependent type or not.&quot;&quot;&quot;</span>
        <span class="n">deptypes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">refined_types</span> \
                        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">)])</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">deptypes</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">isdependent</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">False</span>
</div>
    <span class="nd">@memoize_method</span>
<div class="viewcode-block" id="TypeSystem.isrefinement"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.TypeSystem.isrefinement">[docs]</a>    <span class="k">def</span> <span class="nf">isrefinement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns whether t is a refined type.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">refined_types</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">isdependent</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</div>
    <span class="nd">@memoize_method</span>
    <span class="k">def</span> <span class="nf">_resolve_dependent_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tname</span><span class="p">,</span> <span class="n">tinst</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">depkey</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">refined_types</span> <span class="k">if</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">tname</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">depval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refined_types</span><span class="p">[</span><span class="n">depkey</span><span class="p">]</span>
        <span class="n">istemplated</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">istemplate</span><span class="p">(</span><span class="n">depkey</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tinst</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">depkey</span>
        <span class="k">elif</span> <span class="n">istemplated</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">tinst</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">depkey</span><span class="p">)</span>
            <span class="n">typemap</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">k</span><span class="p">,</span> <span class="n">tinst</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">depkey</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="mi">1</span><span class="p">)</span> \
                                                   <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">)])</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">typemap</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">type_aliases</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;template type {0} already exists&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">type_aliases</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">typemap</span><span class="p">)</span>
            <span class="n">resotype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canon</span><span class="p">(</span><span class="n">depval</span><span class="p">),</span> <span class="p">(</span><span class="n">tname</span><span class="p">,)</span> <span class="o">+</span> \
                        <span class="nb">tuple</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">canon</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">depkey</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">typemap</span><span class="p">])</span> <span class="o">+</span> \
                        <span class="nb">tuple</span><span class="p">([(</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">canon</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">instval</span><span class="p">)</span> \
                            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">instval</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">depkey</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">tinst</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> 
                            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">typemap</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">typemap</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">type_aliases</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">delmemo</span><span class="p">(</span><span class="s">&#39;canon&#39;</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">resotype</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">tinst</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">depkey</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">canon</span><span class="p">(</span><span class="n">depval</span><span class="p">),</span> <span class="p">(</span><span class="n">tname</span><span class="p">,)</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">([(</span><span class="n">kname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">canon</span><span class="p">(</span><span class="n">ktype</span><span class="p">),</span>
                <span class="n">instval</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">kname</span><span class="p">,</span> <span class="n">ktype</span><span class="p">),</span> <span class="n">instval</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">depkey</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">tinst</span><span class="p">[</span><span class="mi">1</span><span class="p">:])])</span>

    <span class="nd">@memoize_method</span>
<div class="viewcode-block" id="TypeSystem.canon"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.TypeSystem.canon">[docs]</a>    <span class="k">def</span> <span class="nf">canon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Turns the type into its canonical form. See module docs for more information.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_types</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">t</span>
            <span class="k">elif</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">type_aliases</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">canon</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type_aliases</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">refined_types</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canon</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refined_types</span><span class="p">[</span><span class="n">t</span><span class="p">]),</span> <span class="n">t</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">isdependent</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_dependent_type</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_raise_type_error</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
                <span class="c"># BELOW this would be for complicated string representations,</span>
                <span class="c"># such as &#39;char *&#39; or &#39;map&lt;nucid, double&gt;&#39;.  Would need to write</span>
                <span class="c"># the parse_type() function and that might be a lot of work.</span>
                <span class="c">#parse_type(t)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">):</span>
            <span class="n">t0</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">tlen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">==</span> <span class="n">tlen</span><span class="p">:</span>
                <span class="n">_raise_type_error</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="n">last_val</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">tlen</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">):</span>
                <span class="n">_raise_type_error</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isdependent</span><span class="p">(</span><span class="n">t0</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_dependent_type</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">t0</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">template_types</span><span class="p">:</span>
                <span class="n">templen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">template_types</span><span class="p">[</span><span class="n">t0</span><span class="p">])</span>
                <span class="n">last_val</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">tlen</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">templen</span> <span class="k">else</span> <span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">filledt</span> <span class="o">=</span> <span class="p">[</span><span class="n">t0</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="o">+</span><span class="n">templen</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>  <span class="c"># includes bool!</span>
                        <span class="n">filledt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tt</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">canontt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canon</span><span class="p">(</span><span class="n">tt</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                            <span class="n">canontt</span> <span class="o">=</span> <span class="n">tt</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="k">raise</span>
                        <span class="n">filledt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">canontt</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">):</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tt</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">tt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">Arg</span><span class="p">:</span>
                            <span class="n">filledt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canon</span><span class="p">(</span><span class="n">tt</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">filledt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canon</span><span class="p">(</span><span class="n">tt</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">_raise_type_error</span><span class="p">(</span><span class="n">tt</span><span class="p">)</span>
                <span class="n">filledt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">last_val</span><span class="p">)</span>
                <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">filledt</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canon</span><span class="p">(</span><span class="n">t0</span><span class="p">),</span> <span class="n">last_val</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_raise_type_error</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</div>
    <span class="nd">@memoize_method</span>
<div class="viewcode-block" id="TypeSystem.strip_predicates"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.TypeSystem.strip_predicates">[docs]</a>    <span class="k">def</span> <span class="nf">strip_predicates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Removes all outer predicates from a type.&quot;&quot;&quot;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canon</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">t</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">):</span>
            <span class="n">tlen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">tlen</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">sp0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">strip_predicates</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">sp0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">sp0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">t</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">0</span><span class="p">,)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_raise_type_error</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</div>
    <span class="nd">@memoize_method</span>
<div class="viewcode-block" id="TypeSystem.basename"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.TypeSystem.basename">[docs]</a>    <span class="k">def</span> <span class="nf">basename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieves basename from a type, e.g. &#39;map&#39; in (&#39;map&#39;, &#39;int&#39;, &#39;float&#39;).&quot;&quot;&quot;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canon</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">t</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">):</span>
            <span class="n">t0</span> <span class="o">=</span> <span class="n">t</span>
            <span class="k">while</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
                <span class="n">t0</span> <span class="o">=</span> <span class="n">t0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">t0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_raise_type_error</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

    <span class="c">###########################   C/C++ Methods   #############################</span>
</div>
    <span class="k">def</span> <span class="nf">_cpp_type_add_predicate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">last</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds a predicate to a C++ type&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">last</span> <span class="o">==</span> <span class="s">&#39;const&#39;</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">last</span><span class="p">,</span> <span class="n">t</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">t</span><span class="p">,</span> <span class="n">last</span>
        <span class="k">return</span> <span class="s">&#39;{0} {1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cpp_var_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">):</span>
        <span class="n">ns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variable_namespace</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">ns</span> <span class="o">+</span> <span class="s">&quot;::&quot;</span> <span class="o">+</span> <span class="n">var</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">var</span>
        <span class="k">return</span> <span class="n">name</span>

    <span class="nd">@memoize_method</span>
<div class="viewcode-block" id="TypeSystem.cpp_type"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.TypeSystem.cpp_type">[docs]</a>    <span class="k">def</span> <span class="nf">cpp_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Given a type t, returns the corresponding C++ type declaration.&quot;&quot;&quot;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canon</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="k">if</span>  <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_types</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpp_types</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="c"># must be tuple below this line</span>
        <span class="n">tlen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">if</span> <span class="mi">2</span> <span class="o">==</span> <span class="n">tlen</span><span class="p">:</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">==</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpp_type</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">isrefinement</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpp_types</span><span class="p">:</span>
                    <span class="n">subtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpp_types</span><span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">subtype</span><span class="p">):</span>
                        <span class="n">subtype</span> <span class="o">=</span> <span class="n">subtype</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">subtype</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpp_type</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">last</span> <span class="o">=</span> <span class="s">&#39;[{0}]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cpp_type_add_predicate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cpp_type</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">last</span><span class="p">)</span>
        <span class="k">elif</span> <span class="mi">3</span> <span class="o">&lt;=</span> <span class="n">tlen</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">template_types</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">template_types</span><span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span> <span class="o">+</span> <span class="mi">2</span>
            <span class="n">template_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpp_types</span><span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="k">assert</span> <span class="n">template_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">NotImplemented</span>
            <span class="n">template_filling</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">kinds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">argument_kinds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="p">((</span><span class="n">Arg</span><span class="o">.</span><span class="n">NONE</span><span class="p">,),)</span><span class="o">*</span><span class="p">(</span><span class="n">tlen</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">kind</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">kinds</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">kind</span> <span class="ow">is</span> <span class="n">Arg</span><span class="o">.</span><span class="n">LIT</span><span class="p">:</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpp_literal</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">kind</span> <span class="ow">is</span> <span class="n">Arg</span><span class="o">.</span><span class="n">TYPE</span><span class="p">:</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpp_type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">kind</span> <span class="ow">is</span> <span class="n">Arg</span><span class="o">.</span><span class="n">VAR</span><span class="p">:</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cpp_var_name</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpp_types</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpp_type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c"># Guess it is a type?</span>
                    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cpp_var_name</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c"># Guess it is a variable</span>
                <span class="n">template_filling</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">cppt</span> <span class="o">=</span> <span class="s">&#39;{0}&lt; {1} &gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">template_name</span><span class="p">,</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">template_filling</span><span class="p">))</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">!=</span> <span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">last</span> <span class="o">=</span> <span class="s">&#39;[{0}]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">cppt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cpp_type_add_predicate</span><span class="p">(</span><span class="n">cppt</span><span class="p">,</span> <span class="n">last</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">cppt</span>
</div>
    <span class="nd">@memoize_method</span>
<div class="viewcode-block" id="TypeSystem.cpp_literal"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.TypeSystem.cpp_literal">[docs]</a>    <span class="k">def</span> <span class="nf">cpp_literal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lit</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Converts a literal value to it C++ form.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lit</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="n">cpp_lit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpp_types</span><span class="p">[</span><span class="n">lit</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lit</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
            <span class="n">cpp_lit</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">lit</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lit</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="n">cpp_lit</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">lit</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cpp_lit</span>
</div>
    <span class="nd">@memoize_method</span>
<div class="viewcode-block" id="TypeSystem.cpp_funcname"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.TypeSystem.cpp_funcname">[docs]</a>    <span class="k">def</span> <span class="nf">cpp_funcname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">argkinds</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This returns a name for a function based on its name, rather than</span>
<span class="sd">        its type.  The name may be either a string or a tuple of the form </span>
<span class="sd">        (&#39;name&#39;, template_arg1, template_arg2, ...). The argkinds argument here </span>
<span class="sd">        refers only to the template arguments, not the function signature default </span>
<span class="sd">        arguments. This is not meant to replace cpp_type(), but complement it.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">name</span>
        <span class="k">if</span> <span class="n">argkinds</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">argkinds</span> <span class="o">=</span> <span class="p">[(</span><span class="n">Arg</span><span class="o">.</span><span class="n">NONE</span><span class="p">,</span> <span class="bp">None</span><span class="p">)]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">cts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">argkind</span><span class="p">,</span> <span class="n">argvalue</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">argkinds</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">argkind</span> <span class="ow">is</span> <span class="n">Arg</span><span class="o">.</span><span class="n">TYPE</span><span class="p">:</span>
                <span class="n">ct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpp_type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">argkind</span> <span class="ow">is</span> <span class="n">Arg</span><span class="o">.</span><span class="n">LIT</span><span class="p">:</span>
                <span class="n">ct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpp_literal</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
                <span class="n">ct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpp_literal</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">ct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpp_type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c"># guess it is a type</span>
                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                    <span class="n">ct</span> <span class="o">=</span> <span class="n">x</span>  <span class="c"># guess it is a variable</span>
            <span class="n">cts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ct</span><span class="p">)</span>
        <span class="n">fname</span> <span class="o">+=</span> <span class="s">&#39;&#39;</span> <span class="k">if</span> <span class="mi">0</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">cts</span><span class="p">)</span> <span class="k">else</span> <span class="s">&quot;&lt; &quot;</span> <span class="o">+</span> <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cts</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot; &gt;&quot;</span>
        <span class="k">return</span> <span class="n">fname</span>
</div>
    <span class="nd">@memoize_method</span>
<div class="viewcode-block" id="TypeSystem.gccxml_type"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.TypeSystem.gccxml_type">[docs]</a>    <span class="k">def</span> <span class="nf">gccxml_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Given a type t, returns the corresponding GCC-XML type name.&quot;&quot;&quot;</span>
        <span class="n">cppt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpp_type</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="n">gxt</span> <span class="o">=</span> <span class="n">cppt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&lt; &#39;</span><span class="p">,</span> <span class="s">&#39;&lt;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &gt;&#39;</span><span class="p">,</span> <span class="s">&#39;&gt;&#39;</span><span class="p">)</span><span class="o">.</span>\
                   <span class="n">replace</span><span class="p">(</span><span class="s">&#39;&gt;&gt;&#39;</span><span class="p">,</span> <span class="s">&#39;&gt; &gt;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;, &#39;</span><span class="p">,</span> <span class="s">&#39;,&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">gxt</span>
</div>
    <span class="nd">@memoize_method</span>
<div class="viewcode-block" id="TypeSystem.cython_nptype"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.TypeSystem.cython_nptype">[docs]</a>    <span class="k">def</span> <span class="nf">cython_nptype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Given a type t, returns the corresponding numpy type.  If depth is</span>
<span class="sd">        greater than 0 then this returns of a list of numpy types for all internal</span>
<span class="sd">        template types, ie the float in (&#39;vector&#39;, &#39;float&#39;, 0).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">&#39;np.NPY_OBJECT&#39;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canon</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">numpy_types</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="k">if</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">numpy_types</span> <span class="k">else</span> <span class="s">&#39;np.NPY_OBJECT&#39;</span>
        <span class="c"># must be tuple below this line</span>
        <span class="n">tlen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">numpy_types</span> <span class="ow">and</span> <span class="n">depth</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">numpy_types</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="k">elif</span> <span class="mi">2</span> <span class="o">==</span> <span class="n">tlen</span><span class="p">:</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">==</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_nptype</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">isrefinement</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_nptype</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># FIXME last is ignored for strings, but what about other types?</span>
                <span class="c">#last = &#39;[{0}]&#39;.format(t[-1]) if isinstance(t[-1], int) else t[-1]</span>
                <span class="c">#return cython_pytype(t[0]) + &#39; {0}&#39;.format(last)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_nptype</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">elif</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">depth</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">istemplate</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="n">depth</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cython_nptype</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="p">)</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">elif</span> <span class="mi">3</span> <span class="o">==</span> <span class="n">tlen</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">istemplate</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_nptype</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c">#elif 3 &lt;= tlen:</span>
            <span class="k">return</span> <span class="s">&#39;np.NPY_OBJECT&#39;</span>

    <span class="c">#########################   Cython Functions   ############################</span>
</div>
    <span class="k">def</span> <span class="nf">_cython_ctype_add_predicate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">last</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds a predicate to a ctype&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">last</span> <span class="o">==</span> <span class="s">&#39;const&#39;</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">last</span><span class="p">,</span> <span class="n">t</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">t</span><span class="p">,</span> <span class="n">last</span>
        <span class="k">return</span> <span class="s">&#39;{0} {1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="nd">@memoize_method</span>
<div class="viewcode-block" id="TypeSystem.cython_ctype"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.TypeSystem.cython_ctype">[docs]</a>    <span class="k">def</span> <span class="nf">cython_ctype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Given a type t, returns the corresponding Cython C/C++ type declaration.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canon</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_ctypes</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_ctypes</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_types</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_ctypes</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="c"># must be tuple below this line</span>
        <span class="n">tlen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">if</span> <span class="mi">2</span> <span class="o">==</span> <span class="n">tlen</span><span class="p">:</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">==</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_ctype</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">isrefinement</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_ctypes</span><span class="p">:</span>
                    <span class="n">subtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_ctypes</span><span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">subtype</span><span class="p">):</span>
                        <span class="n">subtype</span> <span class="o">=</span> <span class="n">subtype</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">subtype</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_ctype</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">last</span> <span class="o">=</span> <span class="s">&#39;[{0}]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cython_ctype_add_predicate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cython_ctype</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">last</span><span class="p">)</span>
        <span class="k">elif</span> <span class="mi">3</span> <span class="o">&lt;=</span> <span class="n">tlen</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">template_types</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">template_types</span><span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span> <span class="o">+</span> <span class="mi">2</span>
            <span class="n">template_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_ctypes</span><span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="k">assert</span> <span class="n">template_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">NotImplemented</span>
            <span class="n">template_filling</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="c">#if isinstance(x, bool):</span>
                <span class="c">#    x = _cython_ctypes[x]</span>
                <span class="c">#elif isinstance(x, Number):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_ctype</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="n">template_filling</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">cyct</span> <span class="o">=</span> <span class="s">&#39;{0}[{1}]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">template_name</span><span class="p">,</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">template_filling</span><span class="p">))</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">!=</span> <span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">last</span> <span class="o">=</span> <span class="s">&#39;[{0}]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">cyct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cython_ctype_add_predicate</span><span class="p">(</span><span class="n">cyct</span><span class="p">,</span> <span class="n">last</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">cyct</span>
</div>
    <span class="nd">@memoize_method</span>
    <span class="k">def</span> <span class="nf">_fill_cycyt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cycyt</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Helper for cython_cytype().&quot;&quot;&quot;</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">template_types</span><span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
                <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_classnames</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
                <span class="n">val</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_types</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_classnames</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">val</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fill_cycyt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cython_classnames</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">x</span><span class="p">)</span>
            <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">return</span> <span class="n">cycyt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">d</span><span class="p">),</span> <span class="n">t</span>

    <span class="k">def</span> <span class="nf">_cython_cytype_add_predicate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">last</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds a predicate to a cytype&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">last</span> <span class="o">==</span> <span class="s">&#39;*&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;{0} {1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">last</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">last</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">last</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;{0} [{1}]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">last</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">t</span>

    <span class="nd">@memoize_method</span>
<div class="viewcode-block" id="TypeSystem.cython_cytype"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.TypeSystem.cython_cytype">[docs]</a>    <span class="k">def</span> <span class="nf">cython_cytype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Given a type t, returns the corresponding Cython type.&quot;&quot;&quot;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canon</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="c">#        if t in self.cython_cytypes:</span>
<span class="c">#            return self.cython_cytypes[t]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_types</span> <span class="ow">or</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_cytypes</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_cytypes</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="c"># must be tuple below this line</span>
        <span class="n">tlen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">if</span> <span class="mi">2</span> <span class="o">==</span> <span class="n">tlen</span><span class="p">:</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">==</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_cytype</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">isrefinement</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_cytypes</span><span class="p">:</span>
                    <span class="n">subtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_cytypes</span><span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">subtype</span><span class="p">):</span>
                        <span class="n">subtype</span> <span class="o">=</span> <span class="n">subtype</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">subtype</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_cytype</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cython_cytype_add_predicate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cython_cytype</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> 
                                                         <span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">elif</span> <span class="mi">3</span> <span class="o">&lt;=</span> <span class="n">tlen</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_cytypes</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_cytypes</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
            <span class="k">assert</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">template_types</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">template_types</span><span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span> <span class="o">+</span> <span class="mi">2</span>
            <span class="n">template_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_cytypes</span><span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="k">assert</span> <span class="n">template_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">NotImplemented</span>
            <span class="n">cycyt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_cytypes</span><span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">cycyt</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fill_cycyt</span><span class="p">(</span><span class="n">cycyt</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
            <span class="n">cycyt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cython_cytype_add_predicate</span><span class="p">(</span><span class="n">cycyt</span><span class="p">,</span> <span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">cycyt</span>
</div>
    <span class="nd">@memoize_method</span>
    <span class="k">def</span> <span class="nf">_fill_cypyt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cypyt</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Helper for cython_pytype().&quot;&quot;&quot;</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">template_types</span><span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
                <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_classnames</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
                <span class="n">val</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_types</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_classnames</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">val</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fill_cypyt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cython_classnames</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">x</span><span class="p">)</span>
            <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">return</span> <span class="n">cypyt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">d</span><span class="p">),</span> <span class="n">t</span>

    <span class="nd">@memoize_method</span>
<div class="viewcode-block" id="TypeSystem.cython_pytype"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.TypeSystem.cython_pytype">[docs]</a>    <span class="k">def</span> <span class="nf">cython_pytype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Given a type t, returns the corresponding Python type.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canon</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_pytypes</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_pytypes</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_types</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_pytypes</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="c"># must be tuple below this line</span>
        <span class="n">tlen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">if</span> <span class="mi">2</span> <span class="o">==</span> <span class="n">tlen</span><span class="p">:</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">==</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_pytype</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">isrefinement</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_pytype</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># FIXME last is ignored for strings, but what about other types?</span>
                <span class="c">#last = &#39;[{0}]&#39;.format(t[-1]) if isinstance(t[-1], int) else t[-1]</span>
                <span class="c">#return cython_pytype(t[0]) + &#39; {0}&#39;.format(last)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_pytype</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">elif</span> <span class="mi">3</span> <span class="o">&lt;=</span> <span class="n">tlen</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_pytypes</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_pytypes</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
            <span class="k">assert</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">template_types</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">template_types</span><span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span> <span class="o">+</span> <span class="mi">2</span>
            <span class="n">template_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_pytypes</span><span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="k">assert</span> <span class="n">template_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">NotImplemented</span>
            <span class="n">cypyt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_pytypes</span><span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">cypyt</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fill_cypyt</span><span class="p">(</span><span class="n">cypyt</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
            <span class="c"># FIXME last is ignored for strings, but what about other types?</span>
            <span class="c">#if 0 != t[-1]:</span>
            <span class="c">#    last = &#39;[{0}]&#39;.format(t[-1]) if isinstance(t[-1], int) else t[-1]</span>
            <span class="c">#    cypyt += &#39; {0}&#39;.format(last)</span>
            <span class="k">return</span> <span class="n">cypyt</span>
</div>
    <span class="nd">@memoize_method</span>
<div class="viewcode-block" id="TypeSystem.cython_cimport_tuples"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.TypeSystem.cython_cimport_tuples">[docs]</a>    <span class="k">def</span> <span class="nf">cython_cimport_tuples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">seen</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">inc</span><span class="o">=</span><span class="nb">frozenset</span><span class="p">([</span><span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="s">&#39;cy&#39;</span><span class="p">])):</span>
        <span class="sd">&quot;&quot;&quot;Given a type t, and possibly previously seen cimport tuples (set),</span>
<span class="sd">        return the set of all seen cimport tuples.  These tuple have four possible</span>
<span class="sd">        interpretations based on the length and values:</span>

<span class="sd">        * ``(module-name,)`` becomes ``cimport {module-name}``</span>
<span class="sd">        * ``(module-name, var-or-mod)`` becomes</span>
<span class="sd">          ``from {module-name} cimport {var-or-mod}``</span>
<span class="sd">        * ``(module-name, var-or-mod, alias)`` becomes</span>
<span class="sd">          ``from {module-name} cimport {var-or-mod} as {alias}``</span>
<span class="sd">        * ``(module-name, &#39;as&#39;, alias)`` becomes ``cimport {module-name} as {alias}``</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canon</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">seen</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">seen</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_types</span><span class="p">:</span>
                <span class="k">if</span> <span class="s">&#39;c&#39;</span> <span class="ow">in</span> <span class="n">inc</span><span class="p">:</span>
                    <span class="n">seen</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cython_cimports</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
                <span class="k">if</span> <span class="s">&#39;cy&#39;</span> <span class="ow">in</span> <span class="n">inc</span><span class="p">:</span>
                    <span class="n">seen</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cython_cyimports</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
                <span class="n">seen</span> <span class="o">-=</span> <span class="nb">set</span><span class="p">((</span><span class="bp">None</span><span class="p">,</span> <span class="p">(</span><span class="bp">None</span><span class="p">,)))</span>
                <span class="k">return</span> <span class="n">seen</span>
        <span class="c"># must be tuple below this line</span>
        <span class="n">tlen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">if</span> <span class="mi">2</span> <span class="o">==</span> <span class="n">tlen</span><span class="p">:</span>
            <span class="k">if</span> <span class="s">&#39;c&#39;</span> <span class="ow">in</span> <span class="n">inc</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isrefinement</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">and</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_cimports</span><span class="p">:</span>
                    <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_cimports</span><span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
                        <span class="n">f</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="p">,</span> <span class="n">seen</span><span class="p">)</span>
                <span class="n">seen</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cython_cimports</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="bp">None</span><span class="p">,)))</span>
                <span class="n">seen</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cython_cimports</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="bp">None</span><span class="p">,)))</span>
            <span class="k">if</span> <span class="s">&#39;cy&#39;</span> <span class="ow">in</span> <span class="n">inc</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isrefinement</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">and</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_cyimports</span><span class="p">:</span>
                    <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_cyimports</span><span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
                        <span class="n">f</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="p">,</span> <span class="n">seen</span><span class="p">)</span>
                <span class="n">seen</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cython_cyimports</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="bp">None</span><span class="p">,)))</span>
                <span class="n">seen</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cython_cyimports</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="bp">None</span><span class="p">,)))</span>
            <span class="n">seen</span> <span class="o">-=</span> <span class="nb">set</span><span class="p">((</span><span class="bp">None</span><span class="p">,</span> <span class="p">(</span><span class="bp">None</span><span class="p">,)))</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_cimport_tuples</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">seen</span><span class="p">,</span> <span class="n">inc</span><span class="p">)</span>
        <span class="k">elif</span> <span class="mi">3</span> <span class="o">&lt;=</span> <span class="n">tlen</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">template_types</span>
            <span class="k">if</span> <span class="s">&#39;c&#39;</span> <span class="ow">in</span> <span class="n">inc</span><span class="p">:</span>
                <span class="n">seen</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cython_cimports</span><span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="k">if</span> <span class="s">&#39;cy&#39;</span> <span class="ow">in</span> <span class="n">inc</span><span class="p">:</span>
                <span class="n">seen</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cython_cyimports</span><span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">)</span> <span class="ow">and</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_cimports</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cython_cimport_tuples</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">seen</span><span class="p">,</span> <span class="n">inc</span><span class="p">)</span>
            <span class="n">seen</span> <span class="o">-=</span> <span class="nb">set</span><span class="p">((</span><span class="bp">None</span><span class="p">,</span> <span class="p">(</span><span class="bp">None</span><span class="p">,)))</span>
            <span class="k">return</span> <span class="n">seen</span>
</div>
    <span class="n">_cython_cimport_cases</span> <span class="o">=</span> <span class="p">{</span>
        <span class="mi">1</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">tup</span><span class="p">:</span> <span class="s">&quot;cimport {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">tup</span><span class="p">),</span>
        <span class="mi">2</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">tup</span><span class="p">:</span> <span class="s">&quot;from {0} cimport {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">tup</span><span class="p">),</span>
        <span class="mi">3</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">tup</span><span class="p">:</span> <span class="p">(</span><span class="s">&quot;cimport {0} as {2}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">tup</span><span class="p">)</span> <span class="k">if</span> <span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;as&#39;</span> <span class="k">else</span> \
                        <span class="s">&quot;from {0} cimport {1} as {2}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">tup</span><span class="p">)),</span>
        <span class="p">}</span>

    <span class="nd">@memoize_method</span>
<div class="viewcode-block" id="TypeSystem.cython_cimport_lines"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.TypeSystem.cython_cimport_lines">[docs]</a>    <span class="k">def</span> <span class="nf">cython_cimport_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">inc</span><span class="o">=</span><span class="nb">frozenset</span><span class="p">([</span><span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="s">&#39;cy&#39;</span><span class="p">])):</span>
        <span class="sd">&quot;&quot;&quot;Returns the cimport lines associated with a type or a set of seen tuples.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Set</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_cimport_tuples</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">inc</span><span class="o">=</span><span class="n">inc</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_cython_cimport_cases</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">tup</span><span class="p">)](</span><span class="n">tup</span><span class="p">)</span> <span class="k">for</span> <span class="n">tup</span> <span class="ow">in</span> <span class="n">x</span> \
                                                              <span class="k">if</span> <span class="mi">0</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tup</span><span class="p">)])</span>
</div>
    <span class="nd">@memoize_method</span>
<div class="viewcode-block" id="TypeSystem.cython_import_tuples"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.TypeSystem.cython_import_tuples">[docs]</a>    <span class="k">def</span> <span class="nf">cython_import_tuples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">seen</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Given a type t, and possibly previously seen import tuples (set),</span>
<span class="sd">        return the set of all seen import tuples.  These tuple have four possible</span>
<span class="sd">        interpretations based on the length and values:</span>

<span class="sd">        * ``(module-name,)`` becomes ``import {module-name}``</span>
<span class="sd">        * ``(module-name, var-or-mod)`` becomes </span>
<span class="sd">          ``from {module-name} import {var-or-mod}``</span>
<span class="sd">        * ``(module-name, var-or-mod, alias)`` becomes </span>
<span class="sd">          ``from {module-name} import {var-or-mod} as {alias}``</span>
<span class="sd">        * ``(module-name, &#39;as&#39;, alias)`` becomes ``import {module-name} as {alias}``</span>

<span class="sd">        Any of these may be used.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canon</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">seen</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">seen</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_types</span><span class="p">:</span>
                <span class="n">seen</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cython_pyimports</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
                <span class="n">seen</span> <span class="o">-=</span> <span class="nb">set</span><span class="p">((</span><span class="bp">None</span><span class="p">,</span> <span class="p">(</span><span class="bp">None</span><span class="p">,)))</span>
                <span class="k">return</span> <span class="n">seen</span>
        <span class="c"># must be tuple below this line</span>
        <span class="n">tlen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">if</span> <span class="mi">2</span> <span class="o">==</span> <span class="n">tlen</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isrefinement</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">and</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_pyimports</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_pyimports</span><span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
                <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
                    <span class="n">f</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="p">,</span> <span class="n">seen</span><span class="p">)</span>
            <span class="n">seen</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cython_pyimports</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="bp">None</span><span class="p">,)))</span>
            <span class="n">seen</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cython_pyimports</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="bp">None</span><span class="p">,)))</span>
            <span class="n">seen</span> <span class="o">-=</span> <span class="nb">set</span><span class="p">((</span><span class="bp">None</span><span class="p">,</span> <span class="p">(</span><span class="bp">None</span><span class="p">,)))</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_import_tuples</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">seen</span><span class="p">)</span>
        <span class="k">elif</span> <span class="mi">3</span> <span class="o">&lt;=</span> <span class="n">tlen</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">template_types</span>
            <span class="n">seen</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cython_pyimports</span><span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">)</span> <span class="ow">and</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_cimports</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cython_import_tuples</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">seen</span><span class="p">)</span>
            <span class="n">seen</span> <span class="o">-=</span> <span class="nb">set</span><span class="p">((</span><span class="bp">None</span><span class="p">,</span> <span class="p">(</span><span class="bp">None</span><span class="p">,)))</span>
            <span class="k">return</span> <span class="n">seen</span>
</div>
    <span class="n">_cython_import_cases</span> <span class="o">=</span> <span class="p">{</span>
        <span class="mi">1</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">tup</span><span class="p">:</span> <span class="s">&quot;import {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">tup</span><span class="p">),</span>
        <span class="mi">2</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">tup</span><span class="p">:</span> <span class="s">&quot;from {0} import {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">tup</span><span class="p">),</span>
        <span class="mi">3</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">tup</span><span class="p">:</span> <span class="p">(</span><span class="s">&quot;import {0} as {2}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">tup</span><span class="p">)</span> <span class="k">if</span> <span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;as&#39;</span> <span class="k">else</span> \
                        <span class="s">&quot;from {0} import {1} as {2}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">tup</span><span class="p">)),</span>
        <span class="p">}</span>

    <span class="nd">@memoize_method</span>
<div class="viewcode-block" id="TypeSystem.cython_import_lines"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.TypeSystem.cython_import_lines">[docs]</a>    <span class="k">def</span> <span class="nf">cython_import_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the import lines associated with a type or a set of seen tuples.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Set</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_import_tuples</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">tup</span> <span class="k">for</span> <span class="n">tup</span> <span class="ow">in</span> <span class="n">x</span> <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">tup</span><span class="p">)]</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_cython_import_cases</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">tup</span><span class="p">)](</span><span class="n">tup</span><span class="p">)</span> <span class="k">for</span> <span class="n">tup</span> <span class="ow">in</span> <span class="n">x</span><span class="p">])</span>
</div>
    <span class="nd">@memoize_method</span>
<div class="viewcode-block" id="TypeSystem.cython_literal"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.TypeSystem.cython_literal">[docs]</a>    <span class="k">def</span> <span class="nf">cython_literal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lit</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Converts a literal to a Cython compatible form.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lit</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
            <span class="n">cy_lit</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">lit</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">,</span> <span class="s">&#39;Neg&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;+&#39;</span><span class="p">,</span> <span class="s">&#39;Pos&#39;</span><span class="p">)</span>\
                             <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="s">&#39;point&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lit</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="n">cy_lit</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">lit</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cy_lit</span>
    
</div>
    <span class="nd">@memoize_method</span>
<div class="viewcode-block" id="TypeSystem.cython_funcname"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.TypeSystem.cython_funcname">[docs]</a>    <span class="k">def</span> <span class="nf">cython_funcname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">argkinds</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This returns a name for a function based on its name, rather than</span>
<span class="sd">        its type.  The name may be either a string or a tuple of the form </span>
<span class="sd">        (&#39;name&#39;, template_arg1, template_arg2, ...). The argkinds argument here </span>
<span class="sd">        refers only to the template arguments, not the function signature default </span>
<span class="sd">        arguments. This is not meant to replace cython_functionname(), but </span>
<span class="sd">        complement it.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">name</span>
        <span class="k">if</span> <span class="n">argkinds</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">argkinds</span> <span class="o">=</span> <span class="p">[(</span><span class="n">Arg</span><span class="o">.</span><span class="n">NONE</span><span class="p">,</span> <span class="bp">None</span><span class="p">)]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> 
        <span class="n">cfs</span> <span class="o">=</span> <span class="p">[]</span> 
        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">argkind</span><span class="p">,</span> <span class="n">argvalue</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">argkinds</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">argkind</span> <span class="ow">is</span> <span class="n">Arg</span><span class="o">.</span><span class="n">TYPE</span><span class="p">:</span>
                <span class="n">cf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_functionname</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">argkind</span> <span class="ow">is</span> <span class="n">Arg</span><span class="o">.</span><span class="n">LIT</span><span class="p">:</span>
                <span class="n">cf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_literal</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">argkind</span> <span class="ow">is</span> <span class="n">Arg</span><span class="o">.</span><span class="n">VAR</span><span class="p">:</span>
                <span class="n">cf</span> <span class="o">=</span> <span class="n">x</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
                <span class="n">cf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_literal</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">cf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_functionname</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>  <span class="c"># guess type</span>
                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                    <span class="n">cf</span> <span class="o">=</span> <span class="n">x</span>  <span class="c"># guess variable</span>
            <span class="n">cfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cf</span><span class="p">)</span> 
        <span class="n">fname</span> <span class="o">+=</span> <span class="s">&#39;&#39;</span> <span class="k">if</span> <span class="mi">0</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">cfs</span><span class="p">)</span> <span class="k">else</span> <span class="s">&quot;_&quot;</span> <span class="o">+</span> <span class="s">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cfs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fname</span>
</div>
    <span class="nd">@memoize_method</span>
<div class="viewcode-block" id="TypeSystem.cython_functionname"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.TypeSystem.cython_functionname">[docs]</a>    <span class="k">def</span> <span class="nf">cython_functionname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">cycyt</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Computes variable or function names for cython types.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">cycyt</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canon</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_functionnames</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_types</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_functionnames</span><span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_functionname</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_functionnames</span><span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">template_types</span><span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
                <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_functionnames</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_functionnames</span> \
                                                   <span class="k">else</span> <span class="n">x</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
                <span class="n">val</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">,</span> <span class="s">&#39;Neg&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;+&#39;</span><span class="p">,</span> <span class="s">&#39;Pos&#39;</span><span class="p">)</span>\
                            <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="s">&#39;point&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_types</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_functionnames</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_functionname</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_functionnames</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">return</span> <span class="n">t</span><span class="p">,</span> <span class="n">cycyt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">d</span><span class="p">)</span>
</div>
    <span class="n">cython_variablename</span> <span class="o">=</span> <span class="n">cython_functionname</span>

    <span class="nd">@memoize_method</span>
<div class="viewcode-block" id="TypeSystem.cython_classname"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.TypeSystem.cython_classname">[docs]</a>    <span class="k">def</span> <span class="nf">cython_classname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">cycyt</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Computes classnames for cython types.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">cycyt</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canon</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_classnames</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_types</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_classnames</span><span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_classname</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_classnames</span><span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">template_types</span><span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
                <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_classnames</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_classnames</span> <span class="k">else</span> <span class="n">x</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
                <span class="n">val</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">,</span> <span class="s">&#39;Neg&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;+&#39;</span><span class="p">,</span> <span class="s">&#39;Pos&#39;</span><span class="p">)</span>\
                            <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="s">&#39;point&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_types</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_classnames</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_classname</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_classnames</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">return</span> <span class="n">t</span><span class="p">,</span> <span class="n">cycyt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">d</span><span class="p">)</span>
</div>
    <span class="nd">@memoize_method</span>
<div class="viewcode-block" id="TypeSystem.cython_c2py_getitem"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.TypeSystem.cython_c2py_getitem">[docs]</a>    <span class="k">def</span> <span class="nf">cython_c2py_getitem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Helps find the approriate c2py value for a given concrete type key.&quot;&quot;&quot;</span>
        <span class="n">tkey</span> <span class="o">=</span> <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canon</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">tkey</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_c2py_conv</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tkey</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="c">#tkey = tkey[0]</span>
            <span class="n">tkey</span> <span class="o">=</span> <span class="n">tkey</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">tkey</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">isrefinement</span><span class="p">(</span><span class="n">tkey</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="k">else</span> \
                                                                             <span class="n">tkey</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">tkey</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_c2py_conv</span><span class="p">:</span>
            <span class="n">tkey</span> <span class="o">=</span> <span class="n">t</span>
            <span class="k">while</span> <span class="n">tkey</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_c2py_conv</span> <span class="ow">and</span> \
                       <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tkey</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
                <span class="n">tkey</span> <span class="o">=</span> <span class="n">tkey</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">c2pyt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_c2py_conv</span><span class="p">[</span><span class="n">tkey</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">c2pyt</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cython_c2py_conv</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">c2pyt</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="n">c2pyt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_c2py_conv</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">c2pyt</span>
</div>
    <span class="nd">@memoize_method</span>
<div class="viewcode-block" id="TypeSystem.cython_c2py"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.TypeSystem.cython_c2py">[docs]</a>    <span class="k">def</span> <span class="nf">cython_c2py</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">view</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">inst_name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
                    <span class="n">proxy_name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">cache_name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">cache_prefix</span><span class="o">=</span><span class="s">&#39;self&#39;</span><span class="p">,</span> 
                    <span class="n">existing_name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Given a varibale name and type, returns cython code (declaration, body,</span>
<span class="sd">        and return statements) to convert the variable from C/C++ to Python.&quot;&quot;&quot;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canon</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="n">c2pyt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_c2py_getitem</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">view</span><span class="p">)</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">cached</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cached</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">view</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;cached views require view=True.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">c2pyt</span> <span class="ow">is</span> <span class="bp">NotImplemented</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s">&#39;conversion from C/C++ to Python for &#39;</span> <span class="o">+</span> \
                                      <span class="n">t</span> <span class="o">+</span> <span class="s">&#39;has not been implemented for when &#39;</span> <span class="o">+</span> \
                                      <span class="s">&#39;view={0}, cached={1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">cached</span><span class="p">))</span>
        <span class="n">var</span> <span class="o">=</span> <span class="n">name</span> <span class="k">if</span> <span class="n">inst_name</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="s">&quot;{0}.{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inst_name</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">var</span> <span class="o">=</span> <span class="n">existing_name</span> <span class="ow">or</span> <span class="n">var</span>
        <span class="n">cache_name</span> <span class="o">=</span> <span class="s">&quot;_{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">if</span> <span class="n">cache_name</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">cache_name</span>
        <span class="n">cache_name</span> <span class="o">=</span> <span class="n">cache_name</span> <span class="k">if</span> <span class="n">cache_prefix</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="s">&quot;{0}.{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                                            <span class="n">cache_prefix</span><span class="p">,</span> <span class="n">cache_name</span><span class="p">)</span>
        <span class="n">proxy_name</span> <span class="o">=</span> <span class="s">&quot;{0}_proxy&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">if</span> <span class="n">proxy_name</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">proxy_name</span>
        <span class="n">iscached</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">tstr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">typestr</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">template_kw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">var</span><span class="o">=</span><span class="n">var</span><span class="p">,</span> <span class="n">cache_name</span><span class="o">=</span><span class="n">cache_name</span><span class="p">,</span> <span class="n">proxy_name</span><span class="o">=</span><span class="n">proxy_name</span><span class="p">,</span> 
                           <span class="n">t</span><span class="o">=</span><span class="n">tstr</span><span class="p">)</span>
<span class="c">#        if callable(c2pyt):</span>
<span class="c">#            import pdb; pdb.set_trace()</span>
        <span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">c2pyt</span><span class="p">)</span> <span class="ow">or</span> <span class="n">ind</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">decl</span> <span class="o">=</span> <span class="n">body</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">rtn</span> <span class="o">=</span> <span class="n">c2pyt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">template_kw</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ind</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">decl</span> <span class="o">=</span> <span class="s">&quot;cdef {0} {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tstr</span><span class="o">.</span><span class="n">cython_cytype</span><span class="p">,</span> <span class="n">proxy_name</span><span class="p">)</span>
            <span class="n">body</span> <span class="o">=</span> <span class="n">c2pyt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">template_kw</span><span class="p">)</span>
            <span class="n">rtn</span> <span class="o">=</span> <span class="n">proxy_name</span>
        <span class="k">elif</span> <span class="n">ind</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">decl</span> <span class="o">=</span> <span class="s">&quot;cdef {0} {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tstr</span><span class="o">.</span><span class="n">cython_cytype</span><span class="p">,</span> <span class="n">proxy_name</span><span class="p">)</span>
            <span class="n">body</span> <span class="o">=</span> <span class="n">c2pyt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">template_kw</span><span class="p">)</span>
            <span class="n">rtn</span> <span class="o">=</span> <span class="n">cache_name</span>
            <span class="n">iscached</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="n">body</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="s">&#39;np.npy_intp&#39;</span> <span class="ow">in</span> <span class="n">body</span><span class="p">:</span>
            <span class="n">decl</span> <span class="o">=</span> <span class="n">decl</span> <span class="ow">or</span> <span class="s">&#39;&#39;</span>
            <span class="n">decl</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">cdef np.npy_intp {proxy_name}_shape[1]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                                                <span class="n">proxy_name</span><span class="o">=</span><span class="n">proxy_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">decl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">body</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">newdecl</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">l</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">body</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span> \
                                              <span class="k">if</span> <span class="n">l</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;cdef&#39;</span><span class="p">)])</span>
            <span class="n">body</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">l</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">body</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span> \
                                              <span class="k">if</span> <span class="ow">not</span> <span class="n">l</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;cdef&#39;</span><span class="p">)])</span>
            <span class="n">proxy_in_newdecl</span> <span class="o">=</span> <span class="n">proxy_name</span> <span class="ow">in</span> <span class="p">[</span><span class="n">l</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> \
                                              <span class="n">newdecl</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span> <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span>
            <span class="k">if</span> <span class="n">proxy_in_newdecl</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">decl</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">proxy_name</span><span class="p">:</span>
                        <span class="n">newdecl</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">d</span>
                <span class="n">decl</span> <span class="o">=</span> <span class="n">newdecl</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">decl</span> <span class="o">+=</span> <span class="n">newdecl</span>
        <span class="k">return</span> <span class="n">decl</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">rtn</span><span class="p">,</span> <span class="n">iscached</span>
</div>
    <span class="nd">@memoize_method</span>
<div class="viewcode-block" id="TypeSystem.cython_py2c"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.TypeSystem.cython_py2c">[docs]</a>    <span class="k">def</span> <span class="nf">cython_py2c</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">inst_name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">proxy_name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Given a varibale name and type, returns cython code (declaration, body,</span>
<span class="sd">        and return statement) to convert the variable from Python to C/C++.&quot;&quot;&quot;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canon</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">0</span> <span class="o">==</span> <span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">isrefinement</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">last</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">last</span> <span class="o">=</span> <span class="s">&#39; [{0}]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">last</span> <span class="o">=</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">tkey</span> <span class="o">=</span> <span class="n">t</span>
        <span class="n">tinst</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">while</span> <span class="n">tkey</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_py2c_conv</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tkey</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="n">tinst</span> <span class="o">=</span> <span class="n">tkey</span>
            <span class="n">tkey</span> <span class="o">=</span> <span class="n">tkey</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">tkey</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">isrefinement</span><span class="p">(</span><span class="n">tkey</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="k">else</span> <span class="n">tkey</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">tkey</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_py2c_conv</span><span class="p">:</span>
            <span class="n">tkey</span> <span class="o">=</span> <span class="n">t</span>
            <span class="k">while</span> <span class="n">tkey</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_py2c_conv</span> <span class="ow">and</span> \
                       <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tkey</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
                <span class="n">tkey</span> <span class="o">=</span> <span class="n">tkey</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">py2ct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_py2c_conv</span><span class="p">[</span><span class="n">tkey</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">py2ct</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cython_py2c_conv</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">py2ct</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="n">py2ct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_py2c_conv</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">py2ct</span> <span class="ow">is</span> <span class="bp">NotImplemented</span> <span class="ow">or</span> <span class="n">py2ct</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s">&#39;conversion from Python to C/C++ for &#39;</span> <span class="o">+</span> \
                                  <span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; has not been implemented.&#39;</span><span class="p">)</span>
        <span class="n">body_template</span><span class="p">,</span> <span class="n">rtn_template</span> <span class="o">=</span> <span class="n">py2ct</span>
        <span class="n">var</span> <span class="o">=</span> <span class="n">name</span> <span class="k">if</span> <span class="n">inst_name</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="s">&quot;{0}.{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inst_name</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">proxy_name</span> <span class="o">=</span> <span class="s">&quot;{0}_proxy&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">if</span> <span class="n">proxy_name</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">proxy_name</span>
        <span class="n">tstr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">typestr</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">template_kw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">var</span><span class="o">=</span><span class="n">var</span><span class="p">,</span> <span class="n">proxy_name</span><span class="o">=</span><span class="n">proxy_name</span><span class="p">,</span> <span class="n">last</span><span class="o">=</span><span class="n">last</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">tstr</span><span class="p">)</span>
        <span class="n">nested</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isdependent</span><span class="p">(</span><span class="n">tkey</span><span class="p">):</span>
            <span class="n">tsig</span> <span class="o">=</span> <span class="p">[</span><span class="n">ts</span> <span class="k">for</span> <span class="n">ts</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">refined_types</span> <span class="k">if</span> <span class="n">ts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">tkey</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">ts</span><span class="p">,</span> <span class="n">ti</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">tsig</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">tinst</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
                    <span class="n">template_kw</span><span class="p">[</span><span class="n">ts</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_ctype</span><span class="p">(</span><span class="n">ti</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">template_kw</span><span class="p">[</span><span class="n">ti</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">ti</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">vartype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refined_types</span><span class="p">[</span><span class="n">tsig</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">vartype</span> <span class="ow">in</span> <span class="n">tsig</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="n">vartype</span> <span class="o">=</span> <span class="n">tinst</span><span class="p">[</span><span class="n">tsig</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">vartype</span><span class="p">)][</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isrefinement</span><span class="p">(</span><span class="n">vartype</span><span class="p">):</span>
                <span class="n">nested</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">vdecl</span><span class="p">,</span> <span class="n">vbody</span><span class="p">,</span> <span class="n">vrtn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_py2c</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">vartype</span><span class="p">)</span>
                <span class="n">template_kw</span><span class="p">[</span><span class="s">&#39;var&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vrtn</span>
        <span class="n">body_filled</span> <span class="o">=</span> <span class="n">body_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">template_kw</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rtn_template</span><span class="p">:</span>
            <span class="k">if</span> <span class="s">&#39;{t.cython_ctype}&#39;</span><span class="ow">in</span> <span class="n">body_template</span><span class="p">:</span>
                <span class="n">deft</span> <span class="o">=</span> <span class="n">tstr</span><span class="o">.</span><span class="n">cython_ctype</span>
            <span class="k">elif</span> <span class="s">&#39;{t.cython_ctype_nopred}&#39;</span><span class="ow">in</span> <span class="n">body_template</span><span class="p">:</span>
                <span class="n">deft</span> <span class="o">=</span> <span class="n">tstr</span><span class="o">.</span><span class="n">cython_ctype_nopred</span>
            <span class="k">elif</span> <span class="s">&#39;{t.cython_cytype_nopred}&#39;</span><span class="ow">in</span> <span class="n">body_template</span><span class="p">:</span>
                <span class="n">deft</span> <span class="o">=</span> <span class="n">tstr</span><span class="o">.</span><span class="n">cython_cytype_nopred</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">deft</span> <span class="o">=</span> <span class="n">tstr</span><span class="o">.</span><span class="n">cython_cytype</span>
            <span class="n">decl</span> <span class="o">=</span> <span class="s">&quot;cdef {0} {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">deft</span><span class="p">,</span> <span class="n">proxy_name</span><span class="p">)</span>
            <span class="n">body</span> <span class="o">=</span> <span class="n">body_filled</span>
            <span class="n">rtn</span> <span class="o">=</span> <span class="n">rtn_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">template_kw</span><span class="p">)</span>
            <span class="n">decl</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">l</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">body</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span> \
                                            <span class="k">if</span> <span class="n">l</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;cdef&#39;</span><span class="p">)])</span>
            <span class="n">body</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">l</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">body</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span> \
                                      <span class="k">if</span> <span class="ow">not</span> <span class="n">l</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;cdef&#39;</span><span class="p">)])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">decl</span> <span class="o">=</span> <span class="n">body</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">rtn</span> <span class="o">=</span> <span class="n">body_filled</span>
        <span class="k">if</span> <span class="n">nested</span><span class="p">:</span>
            <span class="n">decl</span> <span class="o">=</span> <span class="s">&#39;&#39;</span> <span class="k">if</span> <span class="n">decl</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">decl</span>
            <span class="n">vdecl</span> <span class="o">=</span> <span class="s">&#39;&#39;</span> <span class="k">if</span> <span class="n">vdecl</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">vdecl</span>
            <span class="n">decl</span> <span class="o">=</span> <span class="p">(</span><span class="n">vdecl</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">decl</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">decl</span> <span class="o">=</span> <span class="bp">None</span> <span class="k">if</span> <span class="mi">0</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">decl</span><span class="p">)</span> <span class="k">else</span> <span class="n">decl</span>
            <span class="n">body</span> <span class="o">=</span> <span class="s">&#39;&#39;</span> <span class="k">if</span> <span class="n">body</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">body</span>
            <span class="n">vbody</span> <span class="o">=</span> <span class="s">&#39;&#39;</span> <span class="k">if</span> <span class="n">vbody</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">vbody</span>
            <span class="n">body</span> <span class="o">=</span> <span class="p">(</span><span class="n">vbody</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">body</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">body</span> <span class="o">=</span> <span class="bp">None</span> <span class="k">if</span> <span class="mi">0</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">body</span><span class="p">)</span> <span class="k">else</span> <span class="n">body</span>
        <span class="k">return</span> <span class="n">decl</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">rtn</span>

    <span class="c">#################  Some utility functions for the typesystem #############</span>
</div>
<div class="viewcode-block" id="TypeSystem.register_class"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.TypeSystem.register_class">[docs]</a>    <span class="k">def</span> <span class="nf">register_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">template_args</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">cython_c_type</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                       <span class="n">cython_cimport</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">cython_cy_type</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">cython_py_type</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                       <span class="n">cython_template_class_name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
                       <span class="n">cython_template_function_name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">cython_cyimport</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
                       <span class="n">cython_pyimport</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">cython_c2py</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
                       <span class="n">cython_py2c</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">cpp_type</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">human_name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
                       <span class="n">from_pytype</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Classes are user specified types.  This function will add a class to </span>
<span class="sd">        the type system so that it may be used normally with the rest of the </span>
<span class="sd">        type system.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># register the class name</span>
        <span class="n">isbase</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="n">template_args</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">base_types</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>  <span class="c"># normal class</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">template_args</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">):</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">template_args</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">base_types</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>  <span class="c"># normal class</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">template_args</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
                <span class="n">_raise_type_error</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">template_types</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">template_args</span><span class="p">)</span>  <span class="c"># templated class...</span>
                <span class="n">isbase</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="c"># Register with Cython C/C++ types</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">cython_c_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cython_ctypes</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">cython_c_type</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">cython_cy_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cython_cytypes</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">cython_cy_type</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">cython_py_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cython_pytypes</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">cython_py_type</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">from_pytype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">from_pytypes</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">from_pytype</span>
        <span class="k">if</span> <span class="n">cpp_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpp_types</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">cpp_type</span>
        <span class="k">if</span> <span class="n">human_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">humannames</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">human_name</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">cython_cimport</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="n">cython_cimport</span> <span class="o">=</span> <span class="n">_ensure_importable</span><span class="p">(</span><span class="n">cython_cimport</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cython_cimports</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">cython_cimport</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">cython_cyimport</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="n">cython_cyimport</span> <span class="o">=</span> <span class="n">_ensure_importable</span><span class="p">(</span><span class="n">cython_cyimport</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cython_cyimports</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">cython_cyimport</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">cython_pyimport</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="n">cython_pyimport</span> <span class="o">=</span> <span class="n">_ensure_importable</span><span class="p">(</span><span class="n">cython_pyimport</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cython_pyimports</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">cython_pyimport</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">cython_c2py</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cython_c2py</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
                <span class="n">cython_c2py</span> <span class="o">=</span> <span class="p">(</span><span class="n">cython_c2py</span><span class="p">,)</span>
            <span class="n">cython_c2py</span> <span class="o">=</span> <span class="bp">None</span> <span class="k">if</span> <span class="n">cython_c2py</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">cython_c2py</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cython_c2py_conv</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">cython_c2py</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">cython_py2c</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cython_py2c</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
                <span class="n">cython_py2c</span> <span class="o">=</span> <span class="p">(</span><span class="n">cython_py2c</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cython_py2c_conv</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">cython_py2c</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">cython_template_class_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cython_classnames</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">cython_template_class_name</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">cython_template_function_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cython_functionnames</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">cython_template_function_name</span>
</div>
<div class="viewcode-block" id="TypeSystem.deregister_class"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.TypeSystem.deregister_class">[docs]</a>    <span class="k">def</span> <span class="nf">deregister_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function will remove a previously registered class from </span>
<span class="sd">        the type system.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">isbase</span> <span class="o">=</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">base_types</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">isbase</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">template_types</span><span class="p">:</span>
            <span class="n">_raise_type_error</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">isbase</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">base_types</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">template_types</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cython_ctypes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cython_cytypes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cython_pytypes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">from_pytypes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpp_types</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">humannames</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cython_cimports</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cython_cyimports</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cython_pyimports</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cython_c2py_conv</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cython_py2c_conv</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cython_classnames</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">clearmemo</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="TypeSystem.register_classname"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.TypeSystem.register_classname">[docs]</a>    <span class="k">def</span> <span class="nf">register_classname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">classname</span><span class="p">,</span> <span class="n">package</span><span class="p">,</span> <span class="n">pxd_base</span><span class="p">,</span> <span class="n">cpppxd_base</span><span class="p">,</span> 
                           <span class="n">cpp_classname</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">make_dtypes</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Registers a class with the type system from only its name, </span>
<span class="sd">        and relevant header file information.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        classname : str or tuple</span>
<span class="sd">        package : str</span>
<span class="sd">            Package name where headers live.</span>
<span class="sd">        pxd_base : str</span>
<span class="sd">            Base name of the pxd file to cimport.</span>
<span class="sd">        cpppxd_base : str</span>
<span class="sd">            Base name of the cpppxd file to cimport.</span>
<span class="sd">        cpp_classname : str or tuple, optional</span>
<span class="sd">            Name of class in C++, equiv. to apiname.srcname. Defaults to classname.</span>
<span class="sd">        make_dtypes : bool, optional</span>
<span class="sd">            Flag for registering dtypes for this class simeltaneously with </span>
<span class="sd">            registering the class itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># target classname</span>
        <span class="n">baseclassname</span> <span class="o">=</span> <span class="n">classname</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">classname</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="n">template_args</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">templateclassname</span> <span class="o">=</span> <span class="n">baseclassname</span>
            <span class="n">templatefuncname</span> <span class="o">=</span> <span class="n">baseclassname</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">template_args</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;T{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">classname</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">)]</span>
            <span class="n">template_args</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">template_args</span><span class="p">)</span>
            <span class="k">while</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">baseclassname</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
                <span class="n">baseclassname</span> <span class="o">=</span> <span class="n">baseclassname</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c"># hack version of ts.basename()</span>
            <span class="n">templateclassname</span> <span class="o">=</span> <span class="n">baseclassname</span>
            <span class="n">templateclassname</span> <span class="o">=</span> <span class="n">templateclassname</span> <span class="o">+</span> \
                                <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&quot;{&quot;</span><span class="o">+</span><span class="n">targ</span><span class="o">+</span><span class="s">&quot;}&quot;</span> <span class="k">for</span> <span class="n">targ</span> <span class="ow">in</span> <span class="n">template_args</span><span class="p">])</span>
            <span class="n">templatefuncname</span> <span class="o">=</span> <span class="n">baseclassname</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;_&#39;</span> <span class="o">+</span> \
                               <span class="s">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&quot;{&quot;</span><span class="o">+</span><span class="n">targ</span><span class="o">+</span><span class="s">&quot;}&quot;</span> <span class="k">for</span> <span class="n">targ</span> <span class="ow">in</span> <span class="n">template_args</span><span class="p">])</span>

        <span class="c"># source classname</span>
        <span class="k">if</span> <span class="n">cpp_classname</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">cpp_classname</span> <span class="o">=</span> <span class="n">classname</span>
        <span class="n">cpp_baseclassname</span> <span class="o">=</span> <span class="n">cpp_classname</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cpp_classname</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="k">while</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cpp_baseclassname</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
                <span class="n">cpp_baseclassname</span> <span class="o">=</span> <span class="n">cpp_baseclassname</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">template_args</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">template_args</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;T{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cpp_classname</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">)]</span>
                <span class="n">template_args</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">template_args</span><span class="p">)</span>

        <span class="c"># register regular class</span>
        <span class="n">class_c2py</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;{t.cython_pytype}({var})&#39;</span><span class="p">,</span>
                      <span class="p">(</span><span class="s">&#39;{proxy_name} = {t.cython_pytype}()</span><span class="se">\n</span><span class="s">&#39;</span>
                       <span class="s">&#39;(&lt;{t.cython_ctype_nopred} *&gt; {proxy_name}._inst)[0] = {var}&#39;</span><span class="p">),</span>
                      <span class="p">(</span><span class="s">&#39;if {cache_name} is None:</span><span class="se">\n</span><span class="s">&#39;</span>
                       <span class="s">&#39;    {proxy_name} = {t.cython_pytype}()</span><span class="se">\n</span><span class="s">&#39;</span>
                       <span class="s">&#39;    {proxy_name}._free_inst = False</span><span class="se">\n</span><span class="s">&#39;</span>
                       <span class="s">&#39;    {proxy_name}._inst = &amp;{var}</span><span class="se">\n</span><span class="s">&#39;</span>
                       <span class="s">&#39;    {cache_name} = {proxy_name}</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                     <span class="p">)</span>
        <span class="n">class_py2c</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;{proxy_name} = &lt;{t.cython_cytype_nopred}&gt; {var}&#39;</span><span class="p">,</span>
                      <span class="s">&#39;(&lt;{t.cython_ctype_nopred} *&gt; {proxy_name}._inst)[0]&#39;</span><span class="p">)</span>
        <span class="n">class_cimport</span> <span class="o">=</span> <span class="p">((</span><span class="n">package</span><span class="p">,</span> <span class="n">cpppxd_base</span><span class="p">),)</span>
        <span class="n">kwclass</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">baseclassname</span><span class="p">,</span>                              <span class="c"># FCComp</span>
            <span class="n">template_args</span><span class="o">=</span><span class="n">template_args</span><span class="p">,</span>
            <span class="n">cython_c_type</span><span class="o">=</span><span class="n">cpppxd_base</span> <span class="o">+</span> <span class="s">&#39;.&#39;</span> <span class="o">+</span> <span class="n">cpp_baseclassname</span><span class="p">,</span> <span class="c"># cpp_fccomp.FCComp</span>
            <span class="n">cython_cimport</span><span class="o">=</span><span class="n">class_cimport</span><span class="p">,</span>
            <span class="n">cython_cy_type</span><span class="o">=</span><span class="n">pxd_base</span> <span class="o">+</span> <span class="s">&#39;.&#39;</span> <span class="o">+</span> <span class="n">baseclassname</span><span class="p">,</span>      <span class="c"># fccomp.FCComp   </span>
            <span class="n">cython_py_type</span><span class="o">=</span><span class="n">pxd_base</span> <span class="o">+</span> <span class="s">&#39;.&#39;</span> <span class="o">+</span> <span class="n">baseclassname</span><span class="p">,</span>      <span class="c"># fccomp.FCComp   </span>
            <span class="n">from_pytype</span><span class="o">=</span><span class="p">[</span><span class="n">pxd_base</span> <span class="o">+</span> <span class="s">&#39;.&#39;</span> <span class="o">+</span> <span class="n">baseclassname</span><span class="p">],</span>      <span class="c"># fccomp.FCComp   </span>
            <span class="n">cpp_type</span><span class="o">=</span><span class="n">cpp_baseclassname</span><span class="p">,</span>
            <span class="n">human_name</span><span class="o">=</span><span class="n">templateclassname</span><span class="p">,</span>
            <span class="n">cython_template_class_name</span><span class="o">=</span><span class="n">templateclassname</span><span class="p">,</span>
            <span class="n">cython_template_function_name</span><span class="o">=</span><span class="n">templatefuncname</span><span class="p">,</span>
            <span class="n">cython_cyimport</span><span class="o">=</span><span class="p">((</span><span class="n">pxd_base</span><span class="p">,),),</span>                       <span class="c"># fccomp</span>
            <span class="n">cython_pyimport</span><span class="o">=</span><span class="p">((</span><span class="n">pxd_base</span><span class="p">,),),</span>                       <span class="c"># fccomp</span>
            <span class="n">cython_c2py</span><span class="o">=</span><span class="n">class_c2py</span><span class="p">,</span>
            <span class="n">cython_py2c</span><span class="o">=</span><span class="n">class_py2c</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_class</span><span class="p">(</span><span class="o">**</span><span class="n">kwclass</span><span class="p">)</span>
        <span class="n">canonname</span> <span class="o">=</span> <span class="n">classname</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">classname</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">)</span> \
                              <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">canon</span><span class="p">(</span><span class="n">classname</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">template_args</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">specname</span> <span class="o">=</span> <span class="n">classname</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">classname</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">)</span> \
                                 <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_classname</span><span class="p">(</span><span class="n">classname</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">kwclassspec</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">classname</span><span class="p">,</span>
                <span class="n">cython_c_type</span><span class="o">=</span><span class="n">cpppxd_base</span> <span class="o">+</span> <span class="s">&#39;.&#39;</span> <span class="o">+</span> <span class="n">specname</span><span class="p">,</span>
                <span class="n">cython_cy_type</span><span class="o">=</span><span class="n">pxd_base</span> <span class="o">+</span> <span class="s">&#39;.&#39;</span> <span class="o">+</span> <span class="n">specname</span><span class="p">,</span>
                <span class="n">cython_py_type</span><span class="o">=</span><span class="n">pxd_base</span> <span class="o">+</span> <span class="s">&#39;.&#39;</span> <span class="o">+</span> <span class="n">specname</span><span class="p">,</span>
                <span class="n">cpp_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cpp_type</span><span class="p">(</span><span class="n">cpp_classname</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">register_class</span><span class="p">(</span><span class="o">**</span><span class="n">kwclassspec</span><span class="p">)</span>
            <span class="n">kwclassspec</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">canonname</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">register_class</span><span class="p">(</span><span class="o">**</span><span class="n">kwclassspec</span><span class="p">)</span>
            <span class="n">kwclassspec</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canon</span><span class="p">(</span><span class="n">cpp_classname</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">register_class</span><span class="p">(</span><span class="o">**</span><span class="n">kwclassspec</span><span class="p">)</span>
        <span class="c"># register numpy type</span>
        <span class="k">if</span> <span class="n">make_dtypes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">register_numpy_dtype</span><span class="p">(</span><span class="n">classname</span><span class="p">,</span>
                <span class="n">cython_cimport</span><span class="o">=</span><span class="n">class_cimport</span><span class="p">,</span>
                <span class="n">cython_cyimport</span><span class="o">=</span><span class="n">pxd_base</span><span class="p">,</span>
                <span class="n">cython_pyimport</span><span class="o">=</span><span class="n">pxd_base</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="c"># register vector</span>
        <span class="n">class_vector_py2c</span> <span class="o">=</span> <span class="p">((</span>
            <span class="s">&#39;# {var} is a {t.type}</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="s">&#39;cdef int i{var}</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="s">&#39;cdef int {var}_size</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="s">&#39;cdef {t.cython_npctypes[0]} * {var}_data</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="s">&#39;{var}_size = len({var})</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="s">&#39;if isinstance({var}, np.ndarray) and (&lt;np.ndarray&gt; {var}).descr.type_num == {t.cython_nptype}:</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="s">&#39;    {var}_data = &lt;{t.cython_npctypes[0]} *&gt; np.PyArray_DATA(&lt;np.ndarray&gt; {var})</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="s">&#39;    {proxy_name} = {t.cython_ctype_nopred}(&lt;size_t&gt; {var}_size)</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="s">&#39;    for i{var} in range({var}_size):</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="s">&#39;        {proxy_name}[i{var}] = {var}_data[i{var}]</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="s">&#39;else:</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="s">&#39;    {proxy_name} = {t.cython_ctype_nopred}(&lt;size_t&gt; {var}_size)</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="s">&#39;    for i{var} in range({var}_size):</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="s">&#39;        {proxy_name}[i{var}] = (&lt;{t.cython_npctypes_nopred[0]} *&gt; (&lt;{t.cython_npcytypes_nopred[0]}&gt; {var}[i{var}])._inst)[0]</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">),</span>
            <span class="s">&#39;{proxy_name}&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_class</span><span class="p">((</span><span class="s">&#39;vector&#39;</span><span class="p">,</span> <span class="n">canonname</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">cython_py2c</span><span class="o">=</span><span class="n">class_vector_py2c</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_class</span><span class="p">((</span><span class="s">&#39;vector&#39;</span><span class="p">,</span> <span class="n">classname</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">cython_py2c</span><span class="o">=</span><span class="n">class_vector_py2c</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_class</span><span class="p">(((</span><span class="s">&#39;vector&#39;</span><span class="p">,</span> <span class="n">canonname</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="s">&#39;&amp;&#39;</span><span class="p">),</span> <span class="n">cython_py2c</span><span class="o">=</span><span class="n">class_vector_py2c</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_class</span><span class="p">(((</span><span class="s">&#39;vector&#39;</span><span class="p">,</span> <span class="n">classname</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="s">&#39;&amp;&#39;</span><span class="p">),</span> <span class="n">cython_py2c</span><span class="o">=</span><span class="n">class_vector_py2c</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_class</span><span class="p">((((</span><span class="s">&#39;vector&#39;</span><span class="p">,</span> <span class="n">canonname</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="s">&#39;const&#39;</span><span class="p">),</span> <span class="s">&#39;&amp;&#39;</span><span class="p">),</span> <span class="n">cython_py2c</span><span class="o">=</span><span class="n">class_vector_py2c</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_class</span><span class="p">((((</span><span class="s">&#39;vector&#39;</span><span class="p">,</span> <span class="n">classname</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="s">&#39;const&#39;</span><span class="p">),</span> <span class="s">&#39;&amp;&#39;</span><span class="p">),</span> <span class="n">cython_py2c</span><span class="o">=</span><span class="n">class_vector_py2c</span><span class="p">)</span>
        <span class="c"># register pointer to class</span>
        <span class="n">class_ptr_c2py</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;{t.cython_pytype}({var})&#39;</span><span class="p">,</span>
                         <span class="p">(</span><span class="s">&#39;cdef {t.cython_pytype} {proxy_name} = {t.cython_pytype}()</span><span class="se">\n</span><span class="s">&#39;</span>
                          <span class="s">&#39;if {proxy_name}._free_inst:</span><span class="se">\n</span><span class="s">&#39;</span>
                          <span class="s">&#39;    free({proxy_name}._inst)</span><span class="se">\n</span><span class="s">&#39;</span>
                          <span class="s">&#39;(&lt;{t.cython_ctype}&gt; {proxy_name}._inst) = {var}&#39;</span><span class="p">),</span>
                         <span class="p">(</span><span class="s">&#39;if {cache_name} is None:</span><span class="se">\n</span><span class="s">&#39;</span>
                          <span class="s">&#39;    {proxy_name} = {t.cython_pytype}()</span><span class="se">\n</span><span class="s">&#39;</span>
                          <span class="s">&#39;    {proxy_name}._free_inst = False</span><span class="se">\n</span><span class="s">&#39;</span>
                          <span class="s">&#39;    {proxy_name}._inst = {var}</span><span class="se">\n</span><span class="s">&#39;</span>
                          <span class="s">&#39;    {cache_name} = {proxy_name}</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                          <span class="p">)</span>
        <span class="n">class_ptr_py2c</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;{proxy_name} = &lt;{t.cython_cytype_nopred}&gt; {var}&#39;</span><span class="p">,</span>
                          <span class="s">&#39;(&lt;{t.cython_ctype_nopred} *&gt; {proxy_name}._inst)&#39;</span><span class="p">)</span>
        <span class="n">kwclassptr</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="p">(</span><span class="n">classname</span><span class="p">,</span> <span class="s">&#39;*&#39;</span><span class="p">),</span>
            <span class="n">template_args</span><span class="o">=</span><span class="n">template_args</span><span class="p">,</span>
            <span class="n">cython_py_type</span><span class="o">=</span><span class="n">pxd_base</span> <span class="o">+</span> <span class="s">&#39;.&#39;</span> <span class="o">+</span> <span class="n">baseclassname</span><span class="p">,</span>
            <span class="n">cython_cy_type</span><span class="o">=</span><span class="n">pxd_base</span> <span class="o">+</span> <span class="s">&#39;.&#39;</span> <span class="o">+</span> <span class="n">baseclassname</span><span class="p">,</span>
            <span class="n">cpp_type</span><span class="o">=</span><span class="n">cpp_baseclassname</span><span class="p">,</span>
            <span class="n">cython_c2py</span><span class="o">=</span><span class="n">class_ptr_c2py</span><span class="p">,</span>
            <span class="n">cython_py2c</span><span class="o">=</span><span class="n">class_ptr_py2c</span><span class="p">,</span>
            <span class="n">cython_cimport</span><span class="o">=</span><span class="n">kwclass</span><span class="p">[</span><span class="s">&#39;cython_cimport&#39;</span><span class="p">]</span> <span class="p">,</span>
            <span class="n">cython_cyimport</span><span class="o">=</span><span class="n">kwclass</span><span class="p">[</span><span class="s">&#39;cython_cyimport&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">((</span><span class="s">&#39;libc.stdlib&#39;</span><span class="p">,</span><span class="s">&#39;free&#39;</span><span class="p">),),</span>
            <span class="n">cython_pyimport</span><span class="o">=</span><span class="n">kwclass</span><span class="p">[</span><span class="s">&#39;cython_pyimport&#39;</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_class</span><span class="p">(</span><span class="o">**</span><span class="n">kwclassptr</span><span class="p">)</span>
        <span class="n">kwclassref</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">kwclassptr</span><span class="p">)</span>
        <span class="c"># Register reference to class</span>
        <span class="n">kwclassref</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">classname</span><span class="p">,</span> <span class="s">&#39;&amp;&#39;</span><span class="p">)</span>
        <span class="n">kwclassref</span><span class="p">[</span><span class="s">&#39;cython_c2py&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">class_c2py</span>
        <span class="n">kwclassref</span><span class="p">[</span><span class="s">&#39;cython_py2c&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">class_py2c</span>
        <span class="c">#ts.register_class(**kwclassref)</span>
        <span class="c"># register doublepointer to class</span>
        <span class="n">class_dblptr_c2py</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;{t.cython_pytype}({var})&#39;</span><span class="p">,</span>
                            <span class="p">(</span><span class="s">&#39;{proxy_name} = {proxy_name}_obj._inst</span><span class="se">\n</span><span class="s">&#39;</span>
                             <span class="s">&#39;(&lt;{t.cython_ctype} *&gt; {proxy_name}._inst) = {var}&#39;</span><span class="p">),</span>
                            <span class="p">(</span><span class="s">&#39;if {cache_name} is None:</span><span class="se">\n</span><span class="s">&#39;</span>
                             <span class="s">&#39;    {proxy_name} = {t.cython_pytype}()</span><span class="se">\n</span><span class="s">&#39;</span>
                             <span class="s">&#39;    {proxy_name}._free_inst = False</span><span class="se">\n</span><span class="s">&#39;</span>
                             <span class="s">&#39;    {proxy_name}._inst = {var}</span><span class="se">\n</span><span class="s">&#39;</span>
                             <span class="s">&#39;    {proxy_name}_list = [{proxy_name}]</span><span class="se">\n</span><span class="s">&#39;</span>
                             <span class="s">&#39;    {cache_name} = {proxy_name}_list</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                             <span class="p">)</span>
        <span class="n">class_dblptr_py2c</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;{proxy_name} = &lt;{t.cython_cytype_nopred}&gt; {var}[0]&#39;</span><span class="p">,</span>
                             <span class="s">&#39;(&lt;{t.cython_ctype_nopred} **&gt; {proxy_name}._inst)&#39;</span><span class="p">)</span>
        <span class="n">kwclassdblptr</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="p">((</span><span class="n">classname</span><span class="p">,</span> <span class="s">&#39;*&#39;</span><span class="p">),</span> <span class="s">&#39;*&#39;</span><span class="p">),</span>
            <span class="n">template_args</span><span class="o">=</span><span class="n">template_args</span><span class="p">,</span>
            <span class="n">cython_c2py</span><span class="o">=</span><span class="n">class_dblptr_c2py</span><span class="p">,</span>
            <span class="n">cython_py2c</span><span class="o">=</span><span class="n">class_dblptr_py2c</span><span class="p">,</span>
            <span class="n">cython_cimport</span><span class="o">=</span><span class="n">kwclass</span><span class="p">[</span><span class="s">&#39;cython_cimport&#39;</span><span class="p">],</span>
            <span class="n">cython_cyimport</span><span class="o">=</span><span class="n">kwclass</span><span class="p">[</span><span class="s">&#39;cython_cyimport&#39;</span><span class="p">],</span>
            <span class="n">cython_pyimport</span><span class="o">=</span><span class="n">kwclass</span><span class="p">[</span><span class="s">&#39;cython_pyimport&#39;</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_class</span><span class="p">(</span><span class="o">**</span><span class="n">kwclassdblptr</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TypeSystem.register_refinement"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.TypeSystem.register_refinement">[docs]</a>    <span class="k">def</span> <span class="nf">register_refinement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">refinementof</span><span class="p">,</span> <span class="n">cython_cimport</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
                            <span class="n">cython_cyimport</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">cython_pyimport</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
                            <span class="n">cython_c2py</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">cython_py2c</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function will add a refinement to the type system so that it </span>
<span class="sd">        may be used normally with the rest of the type system.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refined_types</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">refinementof</span>

        <span class="n">cyci</span> <span class="o">=</span> <span class="n">_ensure_importable</span><span class="p">(</span><span class="n">cython_cimport</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cython_cimports</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">cyci</span>

        <span class="n">cycyi</span> <span class="o">=</span> <span class="n">_ensure_importable</span><span class="p">(</span><span class="n">cython_cyimport</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cython_cyimports</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">cycyi</span>

        <span class="n">cypyi</span> <span class="o">=</span> <span class="n">_ensure_importable</span><span class="p">(</span><span class="n">cython_pyimport</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cython_pyimports</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">cypyi</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cython_c2py</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="n">cython_c2py</span> <span class="o">=</span> <span class="p">(</span><span class="n">cython_c2py</span><span class="p">,)</span>
        <span class="n">cython_c2py</span> <span class="o">=</span> <span class="bp">None</span> <span class="k">if</span> <span class="n">cython_c2py</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">cython_c2py</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cython_c2py</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cython_c2py_conv</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">cython_c2py</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cython_py2c</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="n">cython_py2c</span> <span class="o">=</span> <span class="p">(</span><span class="n">cython_py2c</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cython_py2c</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cython_py2c_conv</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">cython_py2c</span>
</div>
<div class="viewcode-block" id="TypeSystem.deregister_refinement"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.TypeSystem.deregister_refinement">[docs]</a>    <span class="k">def</span> <span class="nf">deregister_refinement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function will remove a previously registered refinement from </span>
<span class="sd">        the type system.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refined_types</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cython_c2py_conv</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cython_py2c_conv</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cython_cimports</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cython_cyimports</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cython_pyimports</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clearmemo</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="TypeSystem.register_specialization"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.TypeSystem.register_specialization">[docs]</a>    <span class="k">def</span> <span class="nf">register_specialization</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">cython_c_type</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">cython_cy_type</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                                <span class="n">cython_py_type</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">cython_cimport</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                                <span class="n">cython_cyimport</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">cython_pyimport</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function will add a template specialization so that it may be used</span>
<span class="sd">        normally with the rest of the type system.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canon</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cython_c_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cython_ctypes</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">cython_c_type</span>
        <span class="k">if</span> <span class="n">cython_cy_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cython_cytypes</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">cython_cy_type</span>
        <span class="k">if</span> <span class="n">cython_py_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cython_pytypes</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">cython_py_type</span>
        <span class="k">if</span> <span class="n">cython_cimport</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cython_cimports</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">cython_cimport</span>
        <span class="k">if</span> <span class="n">cython_cyimport</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cython_cyimports</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">cython_cyimport</span>
        <span class="k">if</span> <span class="n">cython_pyimport</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cython_pyimports</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">cython_pyimport</span>
</div>
<div class="viewcode-block" id="TypeSystem.deregister_specialization"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.TypeSystem.deregister_specialization">[docs]</a>    <span class="k">def</span> <span class="nf">deregister_specialization</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function will remove previously registered template specialization.&quot;&quot;&quot;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canon</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cython_ctypes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cython_cytypes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cython_pytypes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cython_cimports</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cython_cyimports</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cython_pyimports</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clearmemo</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="TypeSystem.register_numpy_dtype"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.TypeSystem.register_numpy_dtype">[docs]</a>    <span class="k">def</span> <span class="nf">register_numpy_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">cython_cimport</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">cython_cyimport</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
                             <span class="n">cython_pyimport</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function will add a type to the system as numpy dtype that lives in</span>
<span class="sd">        the dtypes module.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canon</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">numpy_types</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">varname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_variablename</span><span class="p">(</span><span class="n">t</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">numpy_types</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;{dtypes}xd_&#39;</span> <span class="o">+</span> <span class="n">varname</span> <span class="o">+</span> <span class="s">&#39;.num&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type_aliases</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">numpy_types</span><span class="p">[</span><span class="n">t</span><span class="p">]]</span> <span class="o">=</span> <span class="n">t</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type_aliases</span><span class="p">[</span><span class="s">&#39;xd_&#39;</span> <span class="o">+</span> <span class="n">varname</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type_aliases</span><span class="p">[</span><span class="s">&#39;xd_&#39;</span> <span class="o">+</span> <span class="n">varname</span> <span class="o">+</span> <span class="s">&#39;.num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type_aliases</span><span class="p">[</span><span class="s">&#39;{dtypes}xd_&#39;</span> <span class="o">+</span> <span class="n">varname</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type_aliases</span><span class="p">[</span><span class="s">&#39;{dtypes}xd_&#39;</span> <span class="o">+</span> <span class="n">varname</span> <span class="o">+</span> <span class="s">&#39;.num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span>
        <span class="k">if</span> <span class="n">cython_cimport</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">_ensure_importable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cython_cimports</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">_ensure_importable</span><span class="p">(</span><span class="n">cython_cimport</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cython_cimports</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
        <span class="c"># cython imports</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">((</span><span class="s">&#39;{dtypes}&#39;</span><span class="p">,),)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">_ensure_importable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cython_cyimports</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">_ensure_importable</span><span class="p">(</span><span class="n">cython_cyimport</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cython_cyimports</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
        <span class="c"># python imports</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">((</span><span class="s">&#39;{dtypes}&#39;</span><span class="p">,),)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">_ensure_importable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cython_pyimports</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">_ensure_importable</span><span class="p">(</span><span class="n">cython_pyimport</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cython_pyimports</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
</div>
<div class="viewcode-block" id="TypeSystem.register_argument_kinds"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.TypeSystem.register_argument_kinds">[docs]</a>    <span class="k">def</span> <span class="nf">register_argument_kinds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">argkinds</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Registers an argument kind tuple into the type system for a template type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canon</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">argument_kinds</span><span class="p">:</span>
            <span class="n">old</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">argument_kinds</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">old</span> <span class="o">!=</span> <span class="n">argkinds</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;overwriting argument kinds for type {0}:</span><span class="se">\n</span><span class="s">&quot;</span>
                       <span class="s">&quot;  old: {1}</span><span class="se">\n</span><span class="s">&quot;</span>
                       <span class="s">&quot;  new: {2}&quot;</span><span class="p">)</span>
                <span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">argkinds</span><span class="p">),</span> <span class="ne">RuntimeWarning</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">argument_kinds</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">argkinds</span>
</div>
<div class="viewcode-block" id="TypeSystem.deregister_argument_kinds"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.TypeSystem.deregister_argument_kinds">[docs]</a>    <span class="k">def</span> <span class="nf">deregister_argument_kinds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Removes a type and its argument kind tuple from the type system.&quot;&quot;&quot;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canon</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">argument_kinds</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">argument_kinds</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="TypeSystem.register_variable_namespace"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.TypeSystem.register_variable_namespace">[docs]</a>    <span class="k">def</span> <span class="nf">register_variable_namespace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Registers a variable and its namespace in the typesystem.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variable_namespace</span><span class="p">:</span>
            <span class="n">old</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variable_namespace</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">old</span> <span class="o">!=</span> <span class="n">namespace</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;overwriting namespace for variable {0}:</span><span class="se">\n</span><span class="s">&quot;</span>
                       <span class="s">&quot;  old: {1}</span><span class="se">\n</span><span class="s">&quot;</span>
                       <span class="s">&quot;  new: {2}&quot;</span><span class="p">)</span>
                <span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">namespace</span><span class="p">),</span> <span class="ne">RuntimeWarning</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variable_namespace</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">namespace</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isenum</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canon</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">register_variable_namespace</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
        

    <span class="c">#################### Type system helpers ###################################</span>
</div>
<div class="viewcode-block" id="TypeSystem.clearmemo"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.TypeSystem.clearmemo">[docs]</a>    <span class="k">def</span> <span class="nf">clearmemo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clears all method memoizations on this type system instance.&quot;&quot;&quot;</span>
        <span class="c"># see utils.memozie_method</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;_cache&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="TypeSystem.delmemo"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.TypeSystem.delmemo">[docs]</a>    <span class="k">def</span> <span class="nf">delmemo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meth</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Deletes a single key from a method on this type system instance.&quot;&quot;&quot;</span>
        <span class="c"># see utils.memozie_method</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;_cache&#39;</span><span class="p">):</span>
            <span class="n">meth</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meth</span> <span class="p">)</span><span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">meth</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">)</span> <span class="k">else</span> <span class="n">meth</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">meth</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="n">meth</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()))]</span>
</div>
    <span class="nd">@contextmanager</span>
<div class="viewcode-block" id="TypeSystem.swap_dtypes"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.TypeSystem.swap_dtypes">[docs]</a>    <span class="k">def</span> <span class="nf">swap_dtypes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A context manager for temporarily swapping out the dtypes value</span>
<span class="sd">        with a new value and replacing the original value before exiting.&quot;&quot;&quot;</span>
        <span class="n">old</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtypes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtypes</span> <span class="o">=</span> <span class="n">s</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clearmemo</span><span class="p">()</span>
        <span class="k">yield</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clearmemo</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtypes</span> <span class="o">=</span> <span class="n">old</span>
</div>
    <span class="nd">@contextmanager</span>
<div class="viewcode-block" id="TypeSystem.swap_stlcontainers"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.TypeSystem.swap_stlcontainers">[docs]</a>    <span class="k">def</span> <span class="nf">swap_stlcontainers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A context manager for temporarily swapping out the stlcontainer value</span>
<span class="sd">        with a new value and replacing the original value before exiting.&quot;&quot;&quot;</span>
        <span class="n">old</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stlcontainers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stlcontainers</span> <span class="o">=</span> <span class="n">s</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clearmemo</span><span class="p">()</span>
        <span class="k">yield</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clearmemo</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stlcontainers</span> <span class="o">=</span> <span class="n">old</span>
</div>
    <span class="nd">@contextmanager</span>
<div class="viewcode-block" id="TypeSystem.local_classes"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.TypeSystem.local_classes">[docs]</a>    <span class="k">def</span> <span class="nf">local_classes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">classnames</span><span class="p">,</span> <span class="n">typesets</span><span class="o">=</span><span class="nb">frozenset</span><span class="p">([</span><span class="s">&#39;cy&#39;</span><span class="p">,</span> <span class="s">&#39;py&#39;</span><span class="p">])):</span>
        <span class="sd">&quot;&quot;&quot;A context manager for making sure the given classes are local.&quot;&quot;&quot;</span>
        <span class="n">saved</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">classnames</span><span class="p">:</span>
            <span class="k">if</span> <span class="s">&#39;c&#39;</span> <span class="ow">in</span> <span class="n">typesets</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_ctypes</span><span class="p">:</span>
                <span class="n">saved</span><span class="p">[</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_undot_class_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_ctypes</span><span class="p">)</span>
            <span class="k">if</span> <span class="s">&#39;cy&#39;</span> <span class="ow">in</span> <span class="n">typesets</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_cytypes</span><span class="p">:</span>
                <span class="n">saved</span><span class="p">[</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;cy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_undot_class_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_cytypes</span><span class="p">)</span>
            <span class="k">if</span> <span class="s">&#39;py&#39;</span> <span class="ow">in</span> <span class="n">typesets</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_pytypes</span><span class="p">:</span>
                <span class="n">saved</span><span class="p">[</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;py&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_undot_class_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_pytypes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clearmemo</span><span class="p">()</span>
        <span class="k">yield</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">classnames</span><span class="p">:</span>
            <span class="k">if</span> <span class="s">&#39;c&#39;</span> <span class="ow">in</span> <span class="n">typesets</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_ctypes</span><span class="p">:</span>
                <span class="n">_redot_class_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_ctypes</span><span class="p">,</span> <span class="n">saved</span><span class="p">[</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="s">&#39;cy&#39;</span> <span class="ow">in</span> <span class="n">typesets</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_cytypes</span><span class="p">:</span>
                <span class="n">_redot_class_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_cytypes</span><span class="p">,</span> <span class="n">saved</span><span class="p">[</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;cy&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="s">&#39;py&#39;</span> <span class="ow">in</span> <span class="n">typesets</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_pytypes</span><span class="p">:</span>
                <span class="n">_redot_class_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_pytypes</span><span class="p">,</span> <span class="n">saved</span><span class="p">[</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;py&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clearmemo</span><span class="p">()</span>

<span class="c">#################### Type System Above This Line ##############################</span>

<span class="c">################### Type Matching #############################################o</span>
</div></div>
<div class="viewcode-block" id="MatchAny"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.MatchAny">[docs]</a><span class="k">class</span> <span class="nc">MatchAny</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A singleton helper class for matching any portion of a type.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;MatchAny&quot;</span>

    <span class="k">def</span> <span class="nf">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># give consistent hash value across executions</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
</div>
<span class="n">MatchAny</span> <span class="o">=</span> <span class="n">MatchAny</span><span class="p">()</span>
<span class="sd">&quot;&quot;&quot;A singleton helper class for matching any portion of a type.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="TypeMatcher"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.TypeMatcher">[docs]</a><span class="k">class</span> <span class="nc">TypeMatcher</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A class that is used for checking whether a type matches a given pattern.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pattern : nested tuples, str, int</span>
<span class="sd">            This is a type-like entity that may have certain elements replaced</span>
<span class="sd">            by MatchAny, indicating that any value in a concrete type may match</span>
<span class="sd">            this pattern.  For example (&#39;float64&#39;, MatchAny) will match the</span>
<span class="sd">            following::</span>

<span class="sd">                (&#39;float64&#39;, 0)</span>
<span class="sd">                (&#39;float64&#39;, &#39;*&#39;)</span>
<span class="sd">                (&#39;float64&#39;, &#39;&amp;&#39;)</span>
<span class="sd">                (&#39;float64&#39;, &#39;const&#39;)</span>

<span class="sd">            but will not match::</span>

<span class="sd">                &#39;float64&#39;</span>
<span class="sd">                ((&#39;float64&#39;, &#39;const&#39;), &#39;&amp;&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pattern</span> <span class="o">=</span> <span class="n">pattern</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="TypeMatcher.pattern"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.TypeMatcher.pattern">[docs]</a>    <span class="k">def</span> <span class="nf">pattern</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The pattern to match.&quot;&quot;&quot;</span>
        <span class="c"># Make this field read-only to prevent hashing errors</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pattern</span>
</div>
    <span class="k">def</span> <span class="nf">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># needed so that class can be dict key</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="p">)</span>

<div class="viewcode-block" id="TypeMatcher.matches"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.TypeMatcher.matches">[docs]</a>    <span class="k">def</span> <span class="nf">matches</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Tests that a type matches the pattern, returns True or False.&quot;&quot;&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span>
        <span class="k">if</span> <span class="n">pattern</span> <span class="ow">is</span> <span class="n">MatchAny</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="n">t</span> <span class="ow">is</span> <span class="n">pattern</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="n">pattern</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="n">pattern</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="c">#return t == pattern if isinstance(t, basestring) else False</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="ow">or</span> \
           <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="c"># now we know both pattern and t should be different non-string sequences,</span>
        <span class="c"># nominally tuples or lists</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pattern</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="n">submatcher</span> <span class="o">=</span> <span class="n">TypeMatcher</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">subt</span><span class="p">,</span> <span class="n">subpattern</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">pattern</span><span class="p">):</span>
            <span class="n">submatcher</span><span class="o">.</span><span class="n">_pattern</span> <span class="o">=</span> <span class="n">subpattern</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">submatcher</span><span class="o">.</span><span class="n">matches</span><span class="p">(</span><span class="n">subt</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="TypeMatcher.flatmatches"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.TypeMatcher.flatmatches">[docs]</a>    <span class="k">def</span> <span class="nf">flatmatches</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Flattens t and then sees if any part of it matches self.pattern.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c"># See if user gave entire type</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">matches</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">True</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="c"># This might fail, if it does just move on</span>
            <span class="k">pass</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">matches</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
                <span class="k">return</span> <span class="nb">any</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">matches</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">flatten</span><span class="p">(</span><span class="n">t</span><span class="p">)])</span>
</div>
    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">TypeMatcher</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pattern</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">_pattern</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pattern</span> <span class="o">==</span> <span class="n">other</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;{0}({1!s})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pattern</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;{0}({1!r})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pattern</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="matches"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.matches">[docs]</a><span class="k">def</span> <span class="nf">matches</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Indicates whether a type t matches a pattern. See TypeMatcher for more details.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tm</span> <span class="o">=</span> <span class="n">TypeMatcher</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tm</span><span class="o">.</span><span class="n">matches</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

<span class="c">#################### Lazy Configuration ###################################</span>
</div>
<span class="k">class</span> <span class="nc">_LazyConfigDict</span><span class="p">(</span><span class="n">MutableMapping</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">items</span><span class="p">,</span> <span class="n">ts</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_d</span> <span class="o">=</span> <span class="n">items</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">MutableMapping</span><span class="p">)</span> <span class="k">else</span> <span class="nb">dict</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ts</span> <span class="o">=</span> <span class="n">ts</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">k</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="n">kw</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;extra_types&#39;</span><span class="p">:</span> <span class="n">_ensuremoddot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ts</span><span class="o">.</span><span class="n">extra_types</span><span class="p">),</span>
              <span class="s">&#39;dtypes&#39;</span><span class="p">:</span> <span class="n">_ensuremoddot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ts</span><span class="o">.</span><span class="n">dtypes</span><span class="p">),</span>
              <span class="s">&#39;stlcontainers&#39;</span><span class="p">:</span> <span class="n">_ensuremoddot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ts</span><span class="o">.</span><span class="n">stlcontainers</span><span class="p">),</span> <span class="p">}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kw</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">_recurse_replace</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&#39;{&#39;</span> <span class="o">+</span> <span class="n">k</span> <span class="o">+</span> <span class="s">&#39;}&#39;</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">toup</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">toup</span><span class="p">,</span> <span class="n">_LazyConfigDict</span><span class="p">):</span>
                <span class="n">toup</span> <span class="o">=</span> <span class="n">toup</span><span class="o">.</span><span class="n">_d</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">toup</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;invalid update signature.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">toup</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">pformat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span> <span class="o">+</span> <span class="s">&quot;(&quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;, TypeSystem())&quot;</span>

<span class="k">class</span> <span class="nc">_LazyImportDict</span><span class="p">(</span><span class="n">MutableMapping</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">items</span><span class="p">,</span> <span class="n">ts</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_d</span> <span class="o">=</span> <span class="n">items</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">MutableMapping</span><span class="p">)</span> <span class="k">else</span> <span class="nb">dict</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ts</span> <span class="o">=</span> <span class="n">ts</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">k</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="n">kw</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;extra_types&#39;</span><span class="p">:</span> <span class="n">_ensuremod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ts</span><span class="o">.</span><span class="n">extra_types</span><span class="p">),</span>
              <span class="s">&#39;dtypes&#39;</span><span class="p">:</span> <span class="n">_ensuremod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ts</span><span class="o">.</span><span class="n">dtypes</span><span class="p">),</span>
              <span class="s">&#39;stlcontainers&#39;</span><span class="p">:</span> <span class="n">_ensuremod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ts</span><span class="o">.</span><span class="n">stlcontainers</span><span class="p">),}</span>
        <span class="n">newvalue</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">imp</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span> \
                            <span class="k">for</span> <span class="n">imp</span> <span class="ow">in</span> <span class="n">value</span> <span class="k">if</span> <span class="n">imp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">None</span><span class="p">,)</span>
        <span class="k">return</span> <span class="n">newvalue</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">toup</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">toup</span><span class="p">,</span> <span class="n">_LazyImportDict</span><span class="p">):</span>
                <span class="n">toup</span> <span class="o">=</span> <span class="n">toup</span><span class="o">.</span><span class="n">_d</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">toup</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;invalid update signature.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">toup</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">pformat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span> <span class="o">+</span> <span class="s">&quot;(&quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;, TypeSystem())&quot;</span>

<span class="k">class</span> <span class="nc">_LazyConverterDict</span><span class="p">(</span><span class="n">MutableMapping</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">items</span><span class="p">,</span> <span class="n">ts</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_d</span> <span class="o">=</span> <span class="n">items</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">MutableMapping</span><span class="p">)</span> <span class="k">else</span> <span class="nb">dict</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tms</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">TypeMatcher</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ts</span> <span class="o">=</span> <span class="n">ts</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>  <span class="c"># Check if key is present</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># check if any TypeMatcher keys actually match</span>
            <span class="k">for</span> <span class="n">tm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tms</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">tm</span><span class="o">.</span><span class="n">matches</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
                    <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="p">[</span><span class="n">tm</span><span class="p">]</span>
                    <span class="k">return</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">k</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>  <span class="c"># Check if key is present</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># check if any TypeMatcher keys actually match</span>
            <span class="k">for</span> <span class="n">tm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tms</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">tm</span><span class="o">.</span><span class="n">matches</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="p">[</span><span class="n">tm</span><span class="p">]</span>
                    <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s">&quot;{0} not found&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">value</span> <span class="ow">is</span> <span class="bp">NotImplemented</span> <span class="ow">or</span> <span class="nb">callable</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="n">kw</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;extra_types&#39;</span><span class="p">:</span> <span class="n">_ensuremoddot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ts</span><span class="o">.</span><span class="n">extra_types</span><span class="p">),</span>
              <span class="s">&#39;dtypes&#39;</span><span class="p">:</span> <span class="n">_ensuremoddot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ts</span><span class="o">.</span><span class="n">dtypes</span><span class="p">),</span>
              <span class="s">&#39;stlcontainers&#39;</span><span class="p">:</span> <span class="n">_ensuremoddot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ts</span><span class="o">.</span><span class="n">stlcontainers</span><span class="p">),}</span>
        <span class="n">newvalue</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
            <span class="n">newx</span> <span class="o">=</span> <span class="n">x</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">newx</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kw</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">newx</span> <span class="o">=</span> <span class="n">newx</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;{&#39;</span> <span class="o">+</span> <span class="n">k</span> <span class="o">+</span> <span class="s">&#39;}&#39;</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
            <span class="n">newvalue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newx</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">newvalue</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">TypeMatcher</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tms</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">TypeMatcher</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tms</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">toup</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">toup</span><span class="p">,</span> <span class="n">_LazyConverterDict</span><span class="p">):</span>
                <span class="n">toup</span> <span class="o">=</span> <span class="n">toup</span><span class="o">.</span><span class="n">_d</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">toup</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;invalid update signature.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">toup</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tms</span><span class="o">.</span><span class="n">update</span><span class="p">([</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">toup</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">TypeMatcher</span><span class="p">)])</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">pformat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span> <span class="o">+</span> <span class="s">&quot;(&quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_d</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;, TypeSystem())&quot;</span>

<span class="c">#################### Type string for formatting ################################</span>

<div class="viewcode-block" id="typestr"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.typestr">[docs]</a><span class="k">class</span> <span class="nc">typestr</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This is class whose attributes are properties that expose various </span>
<span class="sd">    string representations of a type.  This is useful for the Python string</span>
<span class="sd">    formatting mini-language where attributes of an object may be accessed.</span>
<span class="sd">    For example:</span>

<span class="sd">        &quot;This is the Cython C/C++ type: {t.cython_ctype}&quot;.format(t=typestr(t, ts))</span>

<span class="sd">    This mechanism is used for accessing type information in conversion strings.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">ts</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        t : str or tuple</span>
<span class="sd">            A valid repesentation of a type in the type systems</span>
<span class="sd">        ts : TypeSystem</span>
<span class="sd">            A type system to generate the string representations with.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ts</span> <span class="o">=</span> <span class="n">ts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">canon</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t_nopred</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">strip_predicates</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

    <span class="n">_type</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="typestr.type"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.typestr.type">[docs]</a>    <span class="k">def</span> <span class="nf">type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This is a repr string of the raw type (self.t), mostly useful for </span>
<span class="sd">        comments.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span>
</div>
    <span class="n">_cython_ctype</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="typestr.cython_ctype"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.typestr.cython_ctype">[docs]</a>    <span class="k">def</span> <span class="nf">cython_ctype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The Cython C/C++ representation of the type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cython_ctype</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cython_ctype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">cython_ctype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cython_ctype</span>
</div>
    <span class="n">_cython_cytype</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="typestr.cython_cytype"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.typestr.cython_cytype">[docs]</a>    <span class="k">def</span> <span class="nf">cython_cytype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The Cython Cython representation of the type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cython_cytype</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cython_cytype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">cython_cytype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cython_cytype</span>
</div>
    <span class="n">_cython_pytype</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="typestr.cython_pytype"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.typestr.cython_pytype">[docs]</a>    <span class="k">def</span> <span class="nf">cython_pytype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The Cython Python representation of the type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cython_pytype</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cython_pytype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">cython_pytype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cython_pytype</span>
</div>
    <span class="n">_cython_nptype</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="typestr.cython_nptype"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.typestr.cython_nptype">[docs]</a>    <span class="k">def</span> <span class="nf">cython_nptype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The Cython NumPy representation of the type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cython_nptype</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cython_nptype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">cython_nptype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cython_nptype</span>
</div>
    <span class="n">_cython_npctype</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="typestr.cython_npctype"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.typestr.cython_npctype">[docs]</a>    <span class="k">def</span> <span class="nf">cython_npctype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The Cython C/C++ representation of NumPy type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cython_npctype</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">npt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">cython_nptype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
            <span class="n">npct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">cython_ctype</span><span class="p">(</span><span class="n">npt</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cython_npctype</span> <span class="o">=</span> <span class="n">npct</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cython_npctype</span>
</div>
    <span class="n">_cython_npcytype</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="typestr.cython_npcytype"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.typestr.cython_npcytype">[docs]</a>    <span class="k">def</span> <span class="nf">cython_npcytype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The Cython Cython representation of NumPy type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cython_npcytype</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">npt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">cython_nptype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
            <span class="n">npcyt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">cython_cytype</span><span class="p">(</span><span class="n">npt</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cython_npcytype</span> <span class="o">=</span> <span class="n">npcyt</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cython_npcytype</span>
</div>
    <span class="n">_cython_nppytype</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="typestr.cython_nppytype"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.typestr.cython_nppytype">[docs]</a>    <span class="k">def</span> <span class="nf">cython_nppytype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The Cython Python representation of NumPy type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cython_nppytype</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">npt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">cython_nptype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
            <span class="n">nppyt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">cython_pytype</span><span class="p">(</span><span class="n">npt</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cython_nppytype</span> <span class="o">=</span> <span class="n">nppyt</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cython_nppytype</span>
</div>
    <span class="n">_cython_nptypes</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="typestr.cython_nptypes"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.typestr.cython_nptypes">[docs]</a>    <span class="k">def</span> <span class="nf">cython_nptypes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The expanded Cython NumPy representation of the type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cython_nptypes</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">npts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">cython_nptype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">npts</span> <span class="o">=</span> <span class="p">[</span><span class="n">npts</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">npts</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">)</span> <span class="k">else</span> <span class="n">npts</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cython_nptypes</span> <span class="o">=</span> <span class="n">npts</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cython_nptypes</span>
</div>
    <span class="n">_cython_npctypes</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="typestr.cython_npctypes"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.typestr.cython_npctypes">[docs]</a>    <span class="k">def</span> <span class="nf">cython_npctypes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The expanded Cython C/C++ representation of the NumPy types.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cython_npctypes</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">npts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">cython_nptype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">npts</span> <span class="o">=</span> <span class="p">[</span><span class="n">npts</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">npts</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">)</span> <span class="k">else</span> <span class="n">npts</span>
            <span class="n">npcts</span> <span class="o">=</span> <span class="n">_maprecurse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">cython_ctype</span><span class="p">,</span> <span class="n">npts</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cython_npctypes</span> <span class="o">=</span> <span class="n">npcts</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cython_npctypes</span>
</div>
    <span class="n">_cython_npcytypes</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="typestr.cython_npcytypes"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.typestr.cython_npcytypes">[docs]</a>    <span class="k">def</span> <span class="nf">cython_npcytypes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The expanded Cython Cython representation of the NumPy types.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cython_npcytypes</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">npts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">cython_nptype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">npts</span> <span class="o">=</span> <span class="p">[</span><span class="n">npts</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">npts</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">)</span> <span class="k">else</span> <span class="n">npts</span>
            <span class="n">npcyts</span> <span class="o">=</span> <span class="n">_maprecurse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">cython_cytype</span><span class="p">,</span> <span class="n">npts</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cython_npcytypes</span> <span class="o">=</span> <span class="n">npcyts</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cython_npcytypes</span>
</div>
    <span class="n">_cython_nppytypes</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="typestr.cython_nppytypes"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.typestr.cython_nppytypes">[docs]</a>    <span class="k">def</span> <span class="nf">cython_nppytypes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The expanded Cython Cython representation of the NumPy types.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cython_nppytypes</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">npts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">cython_nptype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">npts</span> <span class="o">=</span> <span class="p">[</span><span class="n">npts</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">npts</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">)</span> <span class="k">else</span> <span class="n">npts</span>
            <span class="n">nppyts</span> <span class="o">=</span> <span class="n">_maprecurse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">cython_pytype</span><span class="p">,</span> <span class="n">npts</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cython_nppytypes</span> <span class="o">=</span> <span class="n">nppyts</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cython_nppytypes</span>
</div>
    <span class="n">_type_nopred</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="typestr.type_nopred"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.typestr.type_nopred">[docs]</a>    <span class="k">def</span> <span class="nf">type_nopred</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This is a repr string of the raw type (self.t) without predicates.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type_nopred</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_type_nopred</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_nopred</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type_nopred</span>
</div>
    <span class="n">_cython_ctype_nopred</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="typestr.cython_ctype_nopred"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.typestr.cython_ctype_nopred">[docs]</a>    <span class="k">def</span> <span class="nf">cython_ctype_nopred</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The Cython C/C++ representation of the type without predicates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cython_ctype_nopred</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cython_ctype_nopred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">cython_ctype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_nopred</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cython_ctype_nopred</span>
</div>
    <span class="n">_cython_cytype_nopred</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="typestr.cython_cytype_nopred"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.typestr.cython_cytype_nopred">[docs]</a>    <span class="k">def</span> <span class="nf">cython_cytype_nopred</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The Cython Cython representation of the type without predicates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cython_cytype_nopred</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cython_cytype_nopred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">cython_cytype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_nopred</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cython_cytype_nopred</span>
</div>
    <span class="n">_cython_pytype_nopred</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="typestr.cython_pytype_nopred"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.typestr.cython_pytype_nopred">[docs]</a>    <span class="k">def</span> <span class="nf">cython_pytype_nopred</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The Cython Python representation of the type without predicates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cython_pytype_nopred</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cython_pytype_nopred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">cython_pytype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_nopred</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cython_pytype_nopred</span>
</div>
    <span class="n">_cython_nptype_nopred</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="typestr.cython_nptype_nopred"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.typestr.cython_nptype_nopred">[docs]</a>    <span class="k">def</span> <span class="nf">cython_nptype_nopred</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The Cython NumPy representation of the type without predicates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cython_nptype_nopred</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cython_nptype_nopred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">cython_nptype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_nopred</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cython_nptype_nopred</span>
</div>
    <span class="n">_cython_npctype_nopred</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="typestr.cython_npctype_nopred"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.typestr.cython_npctype_nopred">[docs]</a>    <span class="k">def</span> <span class="nf">cython_npctype_nopred</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The Cython C/C++ representation of the NumPy type without predicates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cython_npctype_nopred</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">npt_nopred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">cython_nptype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_nopred</span><span class="p">)</span>
            <span class="n">npct_nopred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_ctype</span><span class="p">(</span><span class="n">npt_nopred</span><span class="p">)</span>            
            <span class="bp">self</span><span class="o">.</span><span class="n">_cython_npctype_nopred</span> <span class="o">=</span> <span class="n">npct_nopred</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cython_npctype_nopred</span>
</div>
    <span class="n">_cython_npcytype_nopred</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="typestr.cython_npcytype_nopred"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.typestr.cython_npcytype_nopred">[docs]</a>    <span class="k">def</span> <span class="nf">cython_npcytype_nopred</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The Cython Cython representation of the NumPy type without predicates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cython_npcytype_nopred</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">npt_nopred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">cython_nptype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_nopred</span><span class="p">)</span>
            <span class="n">npcyt_nopred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_cytype</span><span class="p">(</span><span class="n">npt_nopred</span><span class="p">)</span>            
            <span class="bp">self</span><span class="o">.</span><span class="n">_cython_npcytype_nopred</span> <span class="o">=</span> <span class="n">npcyt_nopred</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cython_npcytype_nopred</span>
</div>
    <span class="n">_cython_nppytype_nopred</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="typestr.cython_nppytype_nopred"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.typestr.cython_nppytype_nopred">[docs]</a>    <span class="k">def</span> <span class="nf">cython_nppytype_nopred</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The Cython Python representation of the NumPy type without predicates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cython_nppytype_nopred</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">npt_nopred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">cython_nptype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_nopred</span><span class="p">)</span>
            <span class="n">nppyt_nopred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cython_pytype</span><span class="p">(</span><span class="n">npt_nopred</span><span class="p">)</span>            
            <span class="bp">self</span><span class="o">.</span><span class="n">_cython_nppytype_nopred</span> <span class="o">=</span> <span class="n">nppyt_nopred</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cython_nppytype_nopred</span>
</div>
    <span class="n">_cython_nptypes_nopred</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="typestr.cython_nptypes_nopred"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.typestr.cython_nptypes_nopred">[docs]</a>    <span class="k">def</span> <span class="nf">cython_nptypes_nopred</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The Cython NumPy representation of the types without predicates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cython_nptypes_nopred</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cython_nptypes_nopred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">cython_nptype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_nopred</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cython_nptypes_nopred</span>
</div>
    <span class="n">_cython_npctypes_nopred</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="typestr.cython_npctypes_nopred"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.typestr.cython_npctypes_nopred">[docs]</a>    <span class="k">def</span> <span class="nf">cython_npctypes_nopred</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The Cython C/C++ representation of the NumPy types without predicates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cython_npctypes_nopred</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">npts_nopred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">cython_nptype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_nopred</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">npts_nopred</span> <span class="o">=</span> <span class="p">[</span><span class="n">npts_nopred</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">npts_nopred</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">)</span> \
                                        <span class="k">else</span> <span class="n">npts_nopred</span>
            <span class="n">npcts_nopred</span> <span class="o">=</span> <span class="n">_maprecurse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">cython_ctype</span><span class="p">,</span> <span class="n">npts_nopred</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cython_npctypes_nopred</span> <span class="o">=</span> <span class="n">npcts_nopred</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cython_npctypes_nopred</span>
</div>
    <span class="n">_cython_npcytypes_nopred</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="typestr.cython_npcytypes_nopred"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.typestr.cython_npcytypes_nopred">[docs]</a>    <span class="k">def</span> <span class="nf">cython_npcytypes_nopred</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The Cython Cython representation of the NumPy types without predicates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cython_npcytypes_nopred</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">npts_nopred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">cython_nptype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_nopred</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">npts_nopred</span> <span class="o">=</span> <span class="p">[</span><span class="n">npts_nopred</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">npts_nopred</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">)</span> \
                                        <span class="k">else</span> <span class="n">npts_nopred</span>
            <span class="n">npcyts_nopred</span> <span class="o">=</span> <span class="n">_maprecurse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">cython_cytype</span><span class="p">,</span> <span class="n">npts_nopred</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cython_npcytypes_nopred</span> <span class="o">=</span> <span class="n">npcyts_nopred</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cython_npcytypes_nopred</span>
</div>
    <span class="n">_cython_nppytypes_nopred</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="typestr.cython_nppytypes_nopred"><a class="viewcode-back" href="../../libref/typesystem.html#xdress.typesystem.typestr.cython_nppytypes_nopred">[docs]</a>    <span class="k">def</span> <span class="nf">cython_nppytypes_nopred</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The Cython Python representation of the NumPy types without predicates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cython_nppytypes_nopred</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">npts_nopred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">cython_nptype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_nopred</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">npts_nopred</span> <span class="o">=</span> <span class="p">[</span><span class="n">npts_nopred</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">npts_nopred</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">)</span> \
                                        <span class="k">else</span> <span class="n">npts_nopred</span>
            <span class="n">nppyts_nopred</span> <span class="o">=</span> <span class="n">_maprecurse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">cython_pytype</span><span class="p">,</span> <span class="n">npts_nopred</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cython_nppytypes_nopred</span> <span class="o">=</span> <span class="n">nppyts_nopred</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cython_nppytypes_nopred</span>


<span class="c">#################### Type system helpers #######################################</span>
</div></div>
<span class="k">def</span> <span class="nf">_raise_type_error</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;type of {0!r} could not be determined&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>

<span class="n">_ensuremod</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="s">&#39;&#39;</span>
<span class="n">_ensuremoddot</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="s">&#39;.&#39;</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="s">&#39;&#39;</span>

<span class="k">def</span> <span class="nf">_recurse_replace</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">_recurse_replace</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span>

<span class="k">def</span> <span class="nf">_undot_class_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
    <span class="k">if</span> <span class="s">&#39;.&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">&#39;&#39;</span>
    <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">d</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">v2</span>
    <span class="k">return</span> <span class="n">v1</span>

<span class="k">def</span> <span class="nf">_redot_class_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="k">if</span> <span class="mi">0</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="k">return</span>
    <span class="n">d</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span> <span class="o">+</span> <span class="s">&#39;.&#39;</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">_maprecurse</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span>
    <span class="c">#return [_maprecurse(f, y) for y in x]</span>
    <span class="n">l</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
        <span class="n">l</span> <span class="o">+=</span> <span class="n">_maprecurse</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">l</span>

<span class="k">def</span> <span class="nf">_ensure_importable</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">)</span> <span class="ow">or</span> <span class="n">x</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="p">((</span><span class="n">x</span><span class="p">,),)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">basestring</span><span class="p">)</span> <span class="ow">or</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">x</span>
    <span class="k">return</span> <span class="n">r</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
        <p class="logo"><a href="../../index.html">
          <img class="logo" src="../../_static/HooverJoven.jpg" alt="Logo"/>
        </a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="../../np-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
    <li><a href="../../index.html">xdress 0.4-dev documentation</a> &raquo;</li>

          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    </div>

    <div class="footer">
        &copy; Copyright 2013, Anthony Scopatz.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div><script type="text/javascript">
    if(ga_enabled){
        document.write("<div class=\"footer\">This page uses <a href=\"http://analytics.google.com\">Google Analytics</a> to collect statistics. ");
        document.write("Click <button title=\"set cookie to disable analytics for this site\" class=\"link\" onclick=\"$.cookie('disable-ga', 'true', {expires: 3650, path: '/'}); window.location.reload(); return false; \">here</button> to disable analytics for this site.");
        document.write("</div>");
    }else{
        document.write("<div class=\"footer\">Google Analytics has been disabled. ");
        document.write("Click <button title=\"set cookie to re-enable analytics for this site\" class=\"link\" onclick=\"$.cookie('disable-ga', null, {path: '/'}); window.location.reload(); return false; \">here</button> to re-enable analytics for this site.");
    };
</script>
    <!-- cloud_sptheme 1.4 -->
  </body>
</html>